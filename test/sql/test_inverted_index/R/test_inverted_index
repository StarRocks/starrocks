-- name: test_basic_create_index @slow
ADMIN SET FRONTEND CONFIG("enable_experimental_gin" = "true");
-- result:
-- !result
set low_cardinality_optimize_v2 = false;
-- result:
-- !result
set cbo_enable_low_cardinality_optimize = false;
-- result:
-- !result
CREATE TABLE `t_test_basic_create_index_pk` (
  `id1` bigint(20) NOT NULL COMMENT "",
  `id2` bigint(20) NOT NULL COMMENT "",
  `id3` bigint(20) NOT NULL COMMENT ""
) ENGINE=OLAP 
PRIMARY KEY(`id1`)
DISTRIBUTED BY HASH(`id1`) BUCKETS 1 
PROPERTIES (
"replication_num" = "1",
"enable_persistent_index" = "true",
"replicated_storage" = "false",
"compression" = "LZ4"
);
-- result:
-- !result
CREATE INDEX index_1 ON t_test_basic_create_index_pk (id2) USING BITMAP;
-- result:
-- !result
function: wait_alter_table_finish()
-- result:
None
-- !result
CREATE INDEX index_2 ON t_test_basic_create_index_pk (id3) USING BITMAP;
-- result:
-- !result
function: wait_alter_table_finish()
-- result:
None
-- !result
CREATE TABLE `t_test_basic_create_index_dup` (
  `id1` bigint(20) NOT NULL COMMENT "",
  `id2` bigint(20) NOT NULL COMMENT "",
  `id3` bigint(20) NOT NULL COMMENT "",
  `id4` string NOT NULL COMMENT "",
  `id5` string NOT NULL COMMENT "",
  `id6` bigint(20) NOT NULL COMMENT "",
  `id7` string NOT NULL COMMENT ""
) ENGINE=OLAP 
DUPLICATE KEY(`id1`)
DISTRIBUTED BY HASH(`id1`) BUCKETS 1 
PROPERTIES (
"replication_num" = "1",
"enable_persistent_index" = "true",
"replicated_storage" = "false",
"compression" = "LZ4"
);
-- result:
-- !result
CREATE INDEX index_1 ON t_test_basic_create_index_dup (id2) USING BITMAP;
-- result:
-- !result
function: wait_alter_table_finish()
-- result:
None
-- !result
CREATE INDEX index_2 ON t_test_basic_create_index_dup (id3) USING BITMAP;
-- result:
-- !result
function: wait_alter_table_finish()
-- result:
None
-- !result
CREATE INDEX index_3 ON t_test_basic_create_index_dup (id4) USING GIN;
-- result:
-- !result
function: wait_alter_table_finish()
-- result:
None
-- !result
CREATE INDEX index_4 ON t_test_basic_create_index_dup (id5) USING GIN;
-- result:
-- !result
function: wait_alter_table_finish()
-- result:
None
-- !result
CREATE INDEX index_5 ON t_test_basic_create_index_dup (id6) USING BITMAP;
-- result:
-- !result
function: wait_alter_table_finish()
-- result:
None
-- !result
CREATE INDEX index_6 ON t_test_basic_create_index_dup (id7) USING GIN;
-- result:
-- !result
function: wait_alter_table_finish()
-- result:
None
-- !result
CREATE TABLE `t_test_basic_create_index_replicated` (
  `id1` bigint(20) NOT NULL COMMENT "",
  `id2` bigint(20) NOT NULL COMMENT "",
  `id3` bigint(20) NOT NULL COMMENT "",
  `id4` string NOT NULL COMMENT "",
  `id5` string NOT NULL COMMENT "",
  `id6` bigint(20) NOT NULL COMMENT "",
  `id7` string NOT NULL COMMENT "",
  INDEX `gin_id4` (`id4`) USING GIN ("parser" = "none") COMMENT ''
) ENGINE=OLAP
DUPLICATE KEY(`id1`)
DISTRIBUTED BY HASH(`id1`) BUCKETS 1
PROPERTIES (
"replication_num" = "1",
"enable_persistent_index" = "true",
"replicated_storage" = "true",
"compression" = "LZ4"
);
-- result:
E: (1064, 'Getting analyzing error. Detail message: GIN does not support replicated mode.')
-- !result
DROP TABLE t_test_basic_create_index_pk;
-- result:
-- !result
DROP TABLE t_test_basic_create_index_dup;
-- result:
-- !result
-- name: test_query_gin_index
ADMIN SET FRONTEND CONFIG("enable_experimental_gin" = "true");
-- result:
-- !result
set low_cardinality_optimize_v2 = false;
-- result:
-- !result
set cbo_enable_low_cardinality_optimize = false;
-- result:
-- !result
CREATE TABLE `t_test_gin_index_query` (
  `id1` bigint(20) NOT NULL COMMENT "",
  `query_none_analyzer` varchar(255) NOT NULL COMMENT "",
  `query_english` varchar(255) NOT NULL COMMENT "",
  `query_chinese` varchar(255) NOT NULL COMMENT "",
   INDEX gin_none (`query_none_analyzer`) USING GIN ("parser" = "none") COMMENT 'whole line index',
   INDEX gin_english (`query_english`) USING GIN ("parser" = "english") COMMENT 'english index',
   INDEX gin_chinese (`query_chinese`) USING GIN ("parser" = "chinese") COMMENT 'chinese index'
) ENGINE=OLAP
DUPLICATE KEY(`id1`)
DISTRIBUTED BY HASH(`id1`) BUCKETS 1
PROPERTIES (
"replication_num" = "1",
"enable_persistent_index" = "true",
"replicated_storage" = "false",
"compression" = "LZ4"
);
-- result:
-- !result
insert into t_test_gin_index_query values
(1, 'starrocks', 'hello starrocks', '极速分析'),
(2, 'starrocks', 'hello world', '你好世界'),
(3, 'lakehouse', 'hello lakehouse', '湖仓一体'),
(4, 'materialized view', 'materialized view', '物化视图'),
(5, '中文测试', 'chinese test', '中文测试');
-- result:
-- !result
select count(*) from t_test_gin_index_query where query_none_analyzer = 'starrocks';
-- result:
2
-- !result
select count(*) from t_test_gin_index_query where query_english match 'hello';
-- result:
3
-- !result
select count(*) from t_test_gin_index_query where query_english not match 'hello' and id1 > 4;
-- result:
1
-- !result
select count(*) from t_test_gin_index_query where query_english match 'hello' and query_none_analyzer = 'lakehouse';
-- result:
1
-- !result
select count(*) from t_test_gin_index_query where query_none_analyzer like '%ed vi%';
-- result:
1
-- !result
select count(*) from t_test_gin_index_query where query_english match '%ed vi%';
-- result:
0
-- !result
select count(*) from t_test_gin_index_query where query_english match '%teria%';
-- result:
1
-- !result
drop table t_test_gin_index_query;
-- result:
-- !result
-- name: test_gin_index_single_predicate_none
ADMIN SET FRONTEND CONFIG("enable_experimental_gin" = "true");
-- result:
-- !result
set low_cardinality_optimize_v2 = false;
-- result:
-- !result
set cbo_enable_low_cardinality_optimize = false;
-- result:
-- !result
CREATE TABLE `t_gin_index_single_predicate_none` (
  `id1` bigint(20) NOT NULL COMMENT "",
  `text_column` varchar(255) NULL COMMENT "",
  INDEX gin_none (`text_column`) USING GIN ("parser" = "none") COMMENT 'whole line index'
) ENGINE=OLAP
DUPLICATE KEY(`id1`)
DISTRIBUTED BY HASH(`id1`) BUCKETS 1
PROPERTIES (
"replication_num" = "1",
"enable_persistent_index" = "true",
"replicated_storage" = "false",
"compression" = "LZ4"
);
-- result:
-- !result
INSERT INTO t_gin_index_single_predicate_none VALUES
(1, "ABC"),
(2, "abc"),
(3, "ABD"),
(4, "This is Gin Index"),
(5, NULL);
-- result:
-- !result
SELECT * FROM t_gin_index_single_predicate_none WHERE text_column = "ABC";
-- result:
1	ABC
-- !result
SELECT * FROM t_gin_index_single_predicate_none WHERE text_column != "ABC";
-- result:
2	abc
3	ABD
4	This is Gin Index
5	None
-- !result
SELECT * FROM t_gin_index_single_predicate_none WHERE text_column IS NULL;
-- result:
5	None
-- !result
SELECT * FROM t_gin_index_single_predicate_none WHERE text_column IS NOT NULL;
-- result:
1	ABC
2	abc
3	ABD
4	This is Gin Index
-- !result
SELECT * FROM t_gin_index_single_predicate_none WHERE text_column <= "AB";
-- result:
5	None
-- !result
SELECT * FROM t_gin_index_single_predicate_none WHERE text_column >= "AB";
-- result:
1	ABC
2	abc
3	ABD
4	This is Gin Index
-- !result
SELECT * FROM t_gin_index_single_predicate_none WHERE text_column IN ("ABC");
-- result:
1	ABC
-- !result
SELECT * FROM t_gin_index_single_predicate_none WHERE text_column IN ("ABC", "ABD");
-- result:
1	ABC
3	ABD
-- !result
SELECT * FROM t_gin_index_single_predicate_none WHERE text_column NOT IN ("ABC");
-- result:
2	abc
3	ABD
4	This is Gin Index
5	None
-- !result
SELECT * FROM t_gin_index_single_predicate_none WHERE text_column NOT IN ("ABC", "ABD");
-- result:
2	abc
4	This is Gin Index
5	None
-- !result
SELECT * FROM t_gin_index_single_predicate_none WHERE text_column LIKE "ABC";
-- result:
1	ABC
-- !result
SELECT * FROM t_gin_index_single_predicate_none WHERE text_column LIKE "%ABC%";
-- result:
1	ABC
-- !result
SELECT * FROM t_gin_index_single_predicate_none WHERE text_column LIKE "%BC";
-- result:
1	ABC
-- !result
SELECT * FROM t_gin_index_single_predicate_none WHERE text_column LIKE "AB%";
-- result:
1	ABC
3	ABD
-- !result
SELECT * FROM t_gin_index_single_predicate_none WHERE text_column match "AB%";
-- result:
1	ABC
3	ABD
-- !result
DROP TABLE t_gin_index_single_predicate_none;
-- result:
-- !result
-- name: test_gin_index_single_predicate_english
ADMIN SET FRONTEND CONFIG("enable_experimental_gin" = "true");
-- result:
-- !result
set low_cardinality_optimize_v2 = false;
-- result:
-- !result
set cbo_enable_low_cardinality_optimize = false;
-- result:
-- !result
CREATE TABLE `t_gin_index_single_predicate_english` (
  `id1` bigint(20) NOT NULL COMMENT "",
  `text_column` varchar(255) NULL COMMENT "",
  INDEX gin_english (`text_column`) USING GIN ("parser" = "english") COMMENT 'english index'
) ENGINE=OLAP
DUPLICATE KEY(`id1`)
DISTRIBUTED BY HASH(`id1`) BUCKETS 1
PROPERTIES (
"replication_num" = "1",
"enable_persistent_index" = "true",
"replicated_storage" = "false",
"compression" = "LZ4"
);
-- result:
-- !result
INSERT INTO t_gin_index_single_predicate_english VALUES
(1, "ABC"),
(2, "abc"),
(3, "ABD"),
(4, "This is Gin Index"),
(5, NULL);
-- result:
-- !result
SELECT * FROM t_gin_index_single_predicate_english WHERE text_column = "This is Gin Index";
-- result:
4	This is Gin Index
-- !result
SELECT * FROM t_gin_index_single_predicate_english WHERE text_column match "This";
-- result:
-- !result
SELECT * FROM t_gin_index_single_predicate_english WHERE text_column match "this";
-- result:
4	This is Gin Index
-- !result
SELECT * FROM t_gin_index_single_predicate_english WHERE text_column match "thi%";
-- result:
4	This is Gin Index
-- !result
SELECT * FROM t_gin_index_single_predicate_english WHERE text_column not match "this";
-- result:
1	ABC
2	abc
3	ABD
5	None
-- !result
SELECT * FROM t_gin_index_single_predicate_english WHERE text_column <= "this";
-- result:
1	ABC
2	abc
3	ABD
4	This is Gin Index
-- !result
SELECT * FROM t_gin_index_single_predicate_english WHERE text_column >= "this";
-- result:
-- !result
SELECT * FROM t_gin_index_single_predicate_english WHERE text_column IN ("this");
-- result:
-- !result
SELECT * FROM t_gin_index_single_predicate_english WHERE text_column IN ("this", "is");
-- result:
-- !result
SELECT * FROM t_gin_index_single_predicate_english WHERE text_column NOT IN ("this");
-- result:
1	ABC
2	abc
3	ABD
4	This is Gin Index
-- !result
SELECT * FROM t_gin_index_single_predicate_english WHERE text_column NOT IN ("this", "is");
-- result:
1	ABC
2	abc
3	ABD
4	This is Gin Index
-- !result
SELECT * FROM t_gin_index_single_predicate_english WHERE text_column LIKE "this";
-- result:
-- !result
SELECT * FROM t_gin_index_single_predicate_english WHERE text_column LIKE "%this%";
-- result:
-- !result
SELECT * FROM t_gin_index_single_predicate_english WHERE text_column LIKE "%his";
-- result:
-- !result
SELECT * FROM t_gin_index_single_predicate_english WHERE text_column LIKE "thi%";
-- result:
-- !result
DROP TABLE t_gin_index_single_predicate_english;
-- result:
-- !result
-- name: test_gin_index_multiple_predicate_none
ADMIN SET FRONTEND CONFIG("enable_experimental_gin" = "true");
-- result:
-- !result
set low_cardinality_optimize_v2 = false;
-- result:
-- !result
set cbo_enable_low_cardinality_optimize = false;
-- result:
-- !result
CREATE TABLE `t_gin_index_multiple_predicate_none` (
  `id1` bigint(20) NOT NULL COMMENT "",
  `text_column` varchar(255) NULL COMMENT "",
  INDEX gin_none (`text_column`) USING GIN ("parser" = "none") COMMENT 'whole line index'
) ENGINE=OLAP
DUPLICATE KEY(`id1`)
DISTRIBUTED BY HASH(`id1`) BUCKETS 1
PROPERTIES (
"replication_num" = "1",
"enable_persistent_index" = "true",
"replicated_storage" = "false",
"compression" = "LZ4"
);
-- result:
-- !result
INSERT INTO t_gin_index_multiple_predicate_none VALUES
(1, "ABC"),
(2, "abc"),
(3, "ABD"),
(4, "This is Gin Index"),
(5, NULL);
-- result:
-- !result
SELECT * FROM t_gin_index_multiple_predicate_none WHERE text_column = "ABC" OR text_column = "ABD";
-- result:
1	ABC
3	ABD
-- !result
SELECT * FROM t_gin_index_multiple_predicate_none WHERE text_column != "ABC" AND text_column != "ABD";
-- result:
2	abc
4	This is Gin Index
5	None
-- !result
SELECT * FROM t_gin_index_multiple_predicate_none WHERE text_column IS NOT NULL AND text_column != "ABC";
-- result:
2	abc
3	ABD
4	This is Gin Index
-- !result
SELECT * FROM t_gin_index_multiple_predicate_none WHERE text_column <= "ABD" OR text_column >= "This is Gin Index";
-- result:
1	ABC
2	abc
3	ABD
4	This is Gin Index
-- !result
SELECT * FROM t_gin_index_multiple_predicate_none WHERE text_column >= "AB" AND text_column <= "This is Gin Index";
-- result:
1	ABC
3	ABD
4	This is Gin Index
-- !result
SELECT * FROM t_gin_index_multiple_predicate_none WHERE text_column IN ("ABC") OR text_column IN ("ABD");
-- result:
1	ABC
3	ABD
-- !result
SELECT * FROM t_gin_index_multiple_predicate_none WHERE text_column IN ("ABC", "ABD") OR text_column IN ("abc");
-- result:
1	ABC
2	abc
3	ABD
-- !result
SELECT * FROM t_gin_index_multiple_predicate_none WHERE text_column NOT IN ("ABC") OR text_column NOT IN ("ABD");
-- result:
1	ABC
2	abc
3	ABD
4	This is Gin Index
-- !result
SELECT * FROM t_gin_index_multiple_predicate_none WHERE text_column LIKE "ABC" OR text_column LIKE "ABD";
-- result:
1	ABC
3	ABD
-- !result
SELECT * FROM t_gin_index_multiple_predicate_none WHERE text_column LIKE "AB%" AND text_column LIKE "%C";
-- result:
1	ABC
-- !result
SELECT * FROM t_gin_index_multiple_predicate_none WHERE text_column match "ABC" OR text_column match "ABD";
-- result:
[REGEX].*Match can only used as a pushdown predicate on column with GIN in a single query.*
-- !result
SELECT * FROM t_gin_index_multiple_predicate_none WHERE text_column match "AB%" AND text_column match "%C";
-- result:
1	ABC
-- !result
DROP TABLE t_gin_index_multiple_predicate_none;
-- result:
-- !result
-- name: test_gin_index_multiple_predicate_english
ADMIN SET FRONTEND CONFIG("enable_experimental_gin" = "true");
-- result:
-- !result
set low_cardinality_optimize_v2 = false;
-- result:
-- !result
set cbo_enable_low_cardinality_optimize = false;
-- result:
-- !result
CREATE TABLE `t_gin_index_multiple_predicate_english` (
  `id1` bigint(20) NOT NULL COMMENT "",
  `text_column` varchar(255) NULL COMMENT "",
  INDEX gin_english (`text_column`) USING GIN ("parser" = "english") COMMENT 'english index'
) ENGINE=OLAP
DUPLICATE KEY(`id1`)
DISTRIBUTED BY HASH(`id1`) BUCKETS 1
PROPERTIES (
"replication_num" = "1",
"enable_persistent_index" = "true",
"replicated_storage" = "false",
"compression" = "LZ4"
);
-- result:
-- !result
INSERT INTO t_gin_index_multiple_predicate_english VALUES
(1, "ABC"),
(2, "abc"),
(3, "ABD"),
(4, "This is Gin Index"),
(5, NULL);
-- result:
-- !result
SELECT * FROM t_gin_index_multiple_predicate_english WHERE text_column match "this" OR text_column match "abc";
-- result:
[REGEX].*Match can only used as a pushdown predicate on column with GIN in a single query.*
-- !result
SELECT * FROM t_gin_index_multiple_predicate_english WHERE text_column not match "this" AND text_column not match "abc";
-- result:
3	ABD
5	None
-- !result
SELECT * FROM t_gin_index_multiple_predicate_english WHERE text_column LIKE "this" OR text_column LIKE "abc";
-- result:
2	abc
-- !result
SELECT * FROM t_gin_index_multiple_predicate_english WHERE text_column LIKE "%this%" AND text_column LIKE "%is%";
-- result:
-- !result
DROP TABLE t_gin_index_multiple_predicate_english;
-- result:
-- !result
-- name: test_gin_index_compaction
ADMIN SET FRONTEND CONFIG("enable_experimental_gin" = "true");
-- result:
-- !result
set low_cardinality_optimize_v2 = false;
-- result:
-- !result
set cbo_enable_low_cardinality_optimize = false;
-- result:
-- !result
CREATE TABLE `t_gin_index_compaction_none_base` (
  `id1` bigint(20) NOT NULL COMMENT "",
  `text_column` varchar(255) NULL COMMENT "",
  INDEX gin_none (`text_column`) USING GIN ("parser" = "none") COMMENT 'whole line index'
) ENGINE=OLAP
DUPLICATE KEY(`id1`)
DISTRIBUTED BY HASH(`id1`) BUCKETS 1
PROPERTIES (
"replication_num" = "1",
"enable_persistent_index" = "true",
"replicated_storage" = "false",
"compression" = "LZ4"
);
-- result:
-- !result
INSERT INTO t_gin_index_compaction_none_base VALUES (1, "abc");
-- result:
-- !result
INSERT INTO t_gin_index_compaction_none_base VALUES (2, "ABC");
-- result:
-- !result
INSERT INTO t_gin_index_compaction_none_base VALUES (3, "bcd");
-- result:
-- !result
INSERT INTO t_gin_index_compaction_none_base VALUES (4, "BCD");
-- result:
-- !result
ALTER TABLE t_gin_index_compaction_none_base BASE COMPACT;
-- result:
-- !result
CREATE TABLE `t_gin_index_compaction_none_cumu` (
  `id1` bigint(20) NOT NULL COMMENT "",
  `text_column` varchar(255) NULL COMMENT "",
  INDEX gin_none (`text_column`) USING GIN ("parser" = "none") COMMENT 'whole line index'
) ENGINE=OLAP
DUPLICATE KEY(`id1`)
DISTRIBUTED BY HASH(`id1`) BUCKETS 1
PROPERTIES (
"replication_num" = "1",
"enable_persistent_index" = "true",
"replicated_storage" = "false",
"compression" = "LZ4"
);
-- result:
-- !result
INSERT INTO t_gin_index_compaction_none_cumu VALUES (1, "abc");
-- result:
-- !result
INSERT INTO t_gin_index_compaction_none_cumu VALUES (2, "ABC");
-- result:
-- !result
INSERT INTO t_gin_index_compaction_none_cumu VALUES (3, "bcd");
-- result:
-- !result
INSERT INTO t_gin_index_compaction_none_cumu VALUES (4, "BCD");
-- result:
-- !result
ALTER TABLE t_gin_index_compaction_none_cumu CUMULATIVE COMPACT;
-- result:
-- !result
SELECT sleep(10);
-- result:
1
-- !result
SELECT * FROM t_gin_index_compaction_none_base;
-- result:
1	abc
2	ABC
3	bcd
4	BCD
-- !result
SELECT * FROM t_gin_index_compaction_none_cumu;
-- result:
1	abc
2	ABC
3	bcd
4	BCD
-- !result
DROP TABLE t_gin_index_compaction_none_base;
-- result:
-- !result
DROP TABLE t_gin_index_compaction_none_cumu;
-- result:
-- !result
CREATE TABLE `t_gin_index_compaction_english_base` (
  `id1` bigint(20) NOT NULL COMMENT "",
  `text_column` varchar(255) NULL COMMENT "",
  INDEX gin_english (`text_column`) USING GIN ("parser" = "english") COMMENT 'english index'
) ENGINE=OLAP
DUPLICATE KEY(`id1`)
DISTRIBUTED BY HASH(`id1`) BUCKETS 1
PROPERTIES (
"replication_num" = "1",
"enable_persistent_index" = "true",
"replicated_storage" = "false",
"compression" = "LZ4"
);
-- result:
-- !result
INSERT INTO t_gin_index_compaction_english_base VALUES (1, "This is Gin Index");
-- result:
-- !result
INSERT INTO t_gin_index_compaction_english_base VALUES (2, "This is Not Gin Index");
-- result:
-- !result
INSERT INTO t_gin_index_compaction_english_base VALUES (3, "Gin Index");
-- result:
-- !result
ALTER TABLE t_gin_index_compaction_english_base BASE COMPACT;
-- result:
-- !result
CREATE TABLE `t_gin_index_compaction_english_cumu` (
  `id1` bigint(20) NOT NULL COMMENT "",
  `text_column` varchar(255) NULL COMMENT "",
  INDEX gin_english (`text_column`) USING GIN ("parser" = "english") COMMENT 'english index'
) ENGINE=OLAP
DUPLICATE KEY(`id1`)
DISTRIBUTED BY HASH(`id1`) BUCKETS 1
PROPERTIES (
"replication_num" = "1",
"enable_persistent_index" = "true",
"replicated_storage" = "false",
"compression" = "LZ4"
);
-- result:
-- !result
INSERT INTO t_gin_index_compaction_english_cumu VALUES (1, "This is Gin Index");
-- result:
-- !result
INSERT INTO t_gin_index_compaction_english_cumu VALUES (2, "This is Not Gin Index");
-- result:
-- !result
INSERT INTO t_gin_index_compaction_english_cumu VALUES (3, "Gin Index");
-- result:
-- !result
ALTER TABLE t_gin_index_compaction_english_cumu CUMULATIVE COMPACT;
-- result:
-- !result
SELECT sleep(10);
-- result:
1
-- !result
SELECT * FROM t_gin_index_compaction_english_base;
-- result:
1	This is Gin Index
2	This is Not Gin Index
3	Gin Index
-- !result
SELECT * FROM t_gin_index_compaction_english_cumu;
-- result:
1	This is Gin Index
2	This is Not Gin Index
3	Gin Index
-- !result
DROP TABLE t_gin_index_compaction_english_base;
-- result:
-- !result
DROP TABLE t_gin_index_compaction_english_cumu;
-- result:
-- !result
-- name: test_gin_index_type
ADMIN SET FRONTEND CONFIG("enable_experimental_gin" = "true");
-- result:
-- !result
set low_cardinality_optimize_v2 = false;
-- result:
-- !result
set cbo_enable_low_cardinality_optimize = false;
-- result:
-- !result
CREATE TABLE `t_gin_index_type_1` (
  `id1` bigint(20) NOT NULL COMMENT "",
  `test_column` varchar(255) NULL COMMENT "",
  INDEX gin_none (`test_column`) USING GIN ("parser" = "none") COMMENT 'whole line index'
) ENGINE=OLAP
DUPLICATE KEY(`id1`)
DISTRIBUTED BY HASH(`id1`) BUCKETS 1
PROPERTIES (
"replication_num" = "1",
"enable_persistent_index" = "true",
"replicated_storage" = "false",
"compression" = "LZ4"
);
-- result:
-- !result
CREATE TABLE `t_gin_index_type_2` (
  `id1` bigint(20) NOT NULL COMMENT "",
  `test_column` String NULL COMMENT "",
  INDEX gin_none (`test_column`) USING GIN ("parser" = "none") COMMENT 'whole line index'
) ENGINE=OLAP
DUPLICATE KEY(`id1`)
DISTRIBUTED BY HASH(`id1`) BUCKETS 1
PROPERTIES (
"replication_num" = "1",
"enable_persistent_index" = "true",
"replicated_storage" = "false",
"compression" = "LZ4"
);
-- result:
-- !result
CREATE TABLE `t_gin_index_type_3` (
  `id1` bigint(20) NOT NULL COMMENT "",
  `test_column` CHAR NULL COMMENT "",
  INDEX gin_none (`test_column`) USING GIN ("parser" = "none") COMMENT 'whole line index'
) ENGINE=OLAP
DUPLICATE KEY(`id1`)
DISTRIBUTED BY HASH(`id1`) BUCKETS 1
PROPERTIES (
"replication_num" = "1",
"enable_persistent_index" = "true",
"replicated_storage" = "false",
"compression" = "LZ4"
);
-- result:
-- !result
CREATE TABLE `t_gin_index_type_4` (
  `id1` bigint(20) NOT NULL COMMENT "",
  `test_column` BIGINT NULL COMMENT "",
  INDEX gin_none (`test_column`) USING GIN ("parser" = "none") COMMENT 'whole line index'
) ENGINE=OLAP
DUPLICATE KEY(`id1`)
DISTRIBUTED BY HASH(`id1`) BUCKETS 1
PROPERTIES (
"replication_num" = "1",
"enable_persistent_index" = "true",
"replicated_storage" = "false",
"compression" = "LZ4"
);
-- result:
E: (1064, 'Getting analyzing error. Detail message: The inverted index can only be build on column with type of CHAR/STRING/VARCHAR type..')
-- !result
CREATE TABLE `t_gin_index_type_5` (
  `id1` bigint(20) NOT NULL COMMENT "",
  `test_column` DOUBLE NULL COMMENT "",
  INDEX gin_none (`test_column`) USING GIN ("parser" = "none") COMMENT 'whole line index'
) ENGINE=OLAP
DUPLICATE KEY(`id1`)
DISTRIBUTED BY HASH(`id1`) BUCKETS 1
PROPERTIES (
"replication_num" = "1",
"enable_persistent_index" = "true",
"replicated_storage" = "false",
"compression" = "LZ4"
);
-- result:
E: (1064, 'Getting analyzing error. Detail message: The inverted index can only be build on column with type of CHAR/STRING/VARCHAR type..')
-- !result
CREATE TABLE `t_gin_index_type_6` (
  `id1` bigint(20) NOT NULL COMMENT "",
  `test_column` DATETIME NULL COMMENT "",
  INDEX gin_none (`test_column`) USING GIN ("parser" = "none") COMMENT 'whole line index'
) ENGINE=OLAP
DUPLICATE KEY(`id1`)
DISTRIBUTED BY HASH(`id1`) BUCKETS 1
PROPERTIES (
"replication_num" = "1",
"enable_persistent_index" = "true",
"replicated_storage" = "false",
"compression" = "LZ4"
);
-- result:
E: (1064, 'Getting analyzing error. Detail message: The inverted index can only be build on column with type of CHAR/STRING/VARCHAR type..')
-- !result
CREATE TABLE `t_gin_index_type_7` (
  `id1` bigint(20) NOT NULL COMMENT "",
  `test_column` DATE NULL COMMENT "",
  INDEX gin_none (`test_column`) USING GIN ("parser" = "none") COMMENT 'whole line index'
) ENGINE=OLAP
DUPLICATE KEY(`id1`)
DISTRIBUTED BY HASH(`id1`) BUCKETS 1
PROPERTIES (
"replication_num" = "1",
"enable_persistent_index" = "true",
"replicated_storage" = "false",
"compression" = "LZ4"
);
-- result:
E: (1064, 'Getting analyzing error. Detail message: The inverted index can only be build on column with type of CHAR/STRING/VARCHAR type..')
-- !result
-- name: test_clone_for_gin
ADMIN SET FRONTEND CONFIG("enable_experimental_gin" = "true");
-- result:
-- !result
set low_cardinality_optimize_v2 = false;
-- result:
-- !result
set cbo_enable_low_cardinality_optimize = false;
-- result:
-- !result
CREATE TABLE `t_clone_for_gin` (
  `id1` bigint(20) NOT NULL COMMENT "",
  `text_column_1` varchar(255) NULL COMMENT "",
  `text_column_2` varchar(255) NULL COMMENT "",
  `text_column_3` varchar(255) NULL COMMENT "",
  `text_column_4` varchar(255) NULL COMMENT "",
  INDEX gin_none_1 (`text_column_1`) USING GIN ("parser" = "none") COMMENT 'whole line index',
  INDEX gin_none_2 (`text_column_2`) USING BITMAP,
  INDEX gin_none_3 (`text_column_3`) USING GIN ("parser" = "none") COMMENT 'whole line index',
  INDEX gin_none_4 (`text_column_4`) USING BITMAP
) ENGINE=OLAP
DUPLICATE KEY(`id1`)
DISTRIBUTED BY HASH(`id1`) BUCKETS 1
PROPERTIES (
"replication_num" = "2",
"enable_persistent_index" = "true",
"replicated_storage" = "false",
"compression" = "LZ4"
);
-- result:
-- !result
INSERT INTO t_clone_for_gin VALUES (1, "abc","abc","abc","abc"),(2, "ABC","ABC","ABC","ABC");
-- result:
-- !result
SELECT * FROM t_clone_for_gin ORDER BY id1;
-- result:
1	abc	abc	abc	abc
2	ABC	ABC	ABC	ABC
-- !result
function: set_first_tablet_bad_and_recover("t_clone_for_gin")
-- result:
None
-- !result
SELECT * FROM t_clone_for_gin ORDER BY id1;
-- result:
1	abc	abc	abc	abc
2	ABC	ABC	ABC	ABC
-- !result
-- name: test_complex_predicate_for_gin
ADMIN SET FRONTEND CONFIG("enable_experimental_gin" = "true");
-- result:
-- !result
set low_cardinality_optimize_v2 = false;
-- result:
-- !result
set cbo_enable_low_cardinality_optimize = false;
-- result:
-- !result
CREATE TABLE `t_complex_predicate_for_gin_none` (
  `id1` bigint(20) NOT NULL COMMENT "",
  `text_column` varchar(255) NULL COMMENT "",
  INDEX gin_none (`text_column`) USING GIN ("parser" = "none") COMMENT ''
) ENGINE=OLAP
DUPLICATE KEY(`id1`)
DISTRIBUTED BY HASH(`id1`) BUCKETS 1
PROPERTIES (
"replication_num" = "1",
"enable_persistent_index" = "true",
"replicated_storage" = "false",
"compression" = "LZ4"
);
-- result:
-- !result
CREATE TABLE `t_complex_predicate_for_gin_english` (
  `id1` bigint(20) NOT NULL COMMENT "",
  `text_column` varchar(255) NULL COMMENT "",
  INDEX gin_english (`text_column`) USING GIN ("parser" = "english") COMMENT ''
) ENGINE=OLAP
DUPLICATE KEY(`id1`)
DISTRIBUTED BY HASH(`id1`) BUCKETS 1
PROPERTIES (
"replication_num" = "1",
"enable_persistent_index" = "true",
"replicated_storage" = "false",
"compression" = "LZ4"
);
-- result:
-- !result
INSERT INTO t_complex_predicate_for_gin_none VALUES (1, "abc cbd");
-- result:
-- !result
INSERT INTO t_complex_predicate_for_gin_none VALUES (2, "cbd edf");
-- result:
-- !result
SELECT * FROM t_complex_predicate_for_gin_none WHERE upper(text_column) LIKE "%CBD%";
-- result:
1	abc cbd
2	cbd edf
-- !result
SELECT * FROM t_complex_predicate_for_gin_none WHERE lower(text_column) LIKE "%cbd%";
-- result:
1	abc cbd
2	cbd edf
-- !result
SELECT * FROM t_complex_predicate_for_gin_none WHERE CAST(id1 as STRING) LIKE "abc";
-- result:
-- !result
SELECT * FROM t_complex_predicate_for_gin_none WHERE CAST(id1 as STRING) LIKE "%abc%";
-- result:
-- !result
SELECT * FROM t_complex_predicate_for_gin_none WHERE text_column LIKE CONCAT("ab", "c");
-- result:
-- !result
SELECT * FROM t_complex_predicate_for_gin_none WHERE text_column LIKE CONCAT("ab", "%");
-- result:
1	abc cbd
-- !result
SELECT * FROM t_complex_predicate_for_gin_none WHERE upper(text_column) match "%CBD%";
-- result:
E: (1064, 'Getting analyzing error. Detail message: left operand of MATCH must be column ref.')
-- !result
SELECT * FROM t_complex_predicate_for_gin_none WHERE lower(text_column) match "%cbd%";
-- result:
E: (1064, 'Getting analyzing error. Detail message: left operand of MATCH must be column ref.')
-- !result
SELECT * FROM t_complex_predicate_for_gin_none WHERE CAST(id1 as STRING) match "abc";
-- result:
E: (1064, 'Getting analyzing error. Detail message: left operand of MATCH must be column ref.')
-- !result
SELECT * FROM t_complex_predicate_for_gin_none WHERE CAST(id1 as STRING) match "%abc%";
-- result:
E: (1064, 'Getting analyzing error. Detail message: left operand of MATCH must be column ref.')
-- !result
SELECT * FROM t_complex_predicate_for_gin_none WHERE text_column match CONCAT("ab", "c");
-- result:
E: (1064, 'Getting analyzing error. Detail message: right operand of MATCH must be of type StringLiteral with NOT NULL.')
-- !result
SELECT * FROM t_complex_predicate_for_gin_none WHERE text_column match CONCAT("ab", "%");
-- result:
E: (1064, 'Getting analyzing error. Detail message: right operand of MATCH must be of type StringLiteral with NOT NULL.')
-- !result
SELECT * FROM t_complex_predicate_for_gin_none WHERE text_column match "";
-- result:
-- !result
SELECT * FROM t_complex_predicate_for_gin_none WHERE text_column match NULL;
-- result:
E: (1064, 'Getting analyzing error. Detail message: right operand of MATCH must be of type StringLiteral with NOT NULL.')
-- !result
INSERT INTO t_complex_predicate_for_gin_english VALUES (1, "abc cbd");
-- result:
-- !result
INSERT INTO t_complex_predicate_for_gin_english VALUES (2, "cbd edf");
-- result:
-- !result
SELECT * FROM t_complex_predicate_for_gin_english WHERE upper(text_column) LIKE "%CBD%";
-- result:
1	abc cbd
2	cbd edf
-- !result
SELECT * FROM t_complex_predicate_for_gin_english WHERE lower(text_column) LIKE "%cbd%";
-- result:
1	abc cbd
2	cbd edf
-- !result
SELECT * FROM t_complex_predicate_for_gin_english WHERE CAST(id1 as STRING) LIKE "abc";
-- result:
-- !result
SELECT * FROM t_complex_predicate_for_gin_english WHERE CAST(id1 as STRING) LIKE "%abc%";
-- result:
-- !result
SELECT * FROM t_complex_predicate_for_gin_english WHERE text_column LIKE CONCAT("ab", "c");
-- result:
-- !result
SELECT * FROM t_complex_predicate_for_gin_english WHERE text_column LIKE CONCAT("ab", "%");
-- result:
1	abc cbd
-- !result
SELECT * FROM t_complex_predicate_for_gin_english WHERE upper(text_column) match "%CBD%";
-- result:
E: (1064, 'Getting analyzing error. Detail message: left operand of MATCH must be column ref.')
-- !result
SELECT * FROM t_complex_predicate_for_gin_english WHERE lower(text_column) match "%cbd%";
-- result:
E: (1064, 'Getting analyzing error. Detail message: left operand of MATCH must be column ref.')
-- !result
SELECT * FROM t_complex_predicate_for_gin_english WHERE CAST(id1 as STRING) match "abc";
-- result:
E: (1064, 'Getting analyzing error. Detail message: left operand of MATCH must be column ref.')
-- !result
SELECT * FROM t_complex_predicate_for_gin_english WHERE CAST(id1 as STRING) match "%abc%";
-- result:
E: (1064, 'Getting analyzing error. Detail message: left operand of MATCH must be column ref.')
-- !result
SELECT * FROM t_complex_predicate_for_gin_english WHERE text_column match CONCAT("ab", "c");
-- result:
E: (1064, 'Getting analyzing error. Detail message: right operand of MATCH must be of type StringLiteral with NOT NULL.')
-- !result
SELECT * FROM t_complex_predicate_for_gin_english WHERE text_column match CONCAT("ab", "%");
-- result:
E: (1064, 'Getting analyzing error. Detail message: right operand of MATCH must be of type StringLiteral with NOT NULL.')
-- !result
SELECT * FROM t_complex_predicate_for_gin_english WHERE text_column match "";
-- result:
-- !result
SELECT * FROM t_complex_predicate_for_gin_none WHERE text_column match NULL;
-- result:
E: (1064, 'Getting analyzing error. Detail message: right operand of MATCH must be of type StringLiteral with NOT NULL.')
-- !result
DROP TABLE t_complex_predicate_for_gin_none;
-- result:
-- !result
DROP TABLE t_complex_predicate_for_gin_english;
-- result:
-- !result
-- name: test_delete_and_column_prune
ADMIN SET FRONTEND CONFIG("enable_experimental_gin" = "true");
-- result:
-- !result
CREATE TABLE `t_delete_and_column_prune` (
  `id1` bigint(20) NOT NULL COMMENT "",
  `text_column` varchar(255) NULL COMMENT "",
  INDEX gin_none (`text_column`) USING GIN ("parser" = "english") COMMENT 'whole line index'
) ENGINE=OLAP
DUPLICATE KEY(`id1`)
DISTRIBUTED BY HASH(`id1`) BUCKETS 1
PROPERTIES (
"replication_num" = "1",
"enable_persistent_index" = "true",
"replicated_storage" = "false",
"compression" = "LZ4"
);
-- result:
-- !result
INSERT INTO t_delete_and_column_prune VALUES (1, "b"),(2, "b"),(3, "b");
-- result:
-- !result
SELECT id1 FROM t_delete_and_column_prune WHERE text_column MATCH "b";
-- result:
1
2
3
-- !result
DELETE FROM t_delete_and_column_prune WHERE id1 = 2;
-- result:
-- !result
SELECT id1 FROM t_delete_and_column_prune WHERE text_column MATCH "b";
-- result:
1
3
-- !result
DROP TABLE t_delete_and_column_prune;
-- result:
-- !result
-- name: test_upper_case_column_name
ADMIN SET FRONTEND CONFIG("enable_experimental_gin" = "true");
-- result:
-- !result
set low_cardinality_optimize_v2 = false;
-- result:
-- !result
set cbo_enable_low_cardinality_optimize = false;
-- result:
-- !result
CREATE TABLE `t_upper_case_column_name` (
  `id1` bigint(20) NOT NULL COMMENT "",
  `TeXt` varchar(255) NULL COMMENT "",
  INDEX gin_none (`TeXt`) USING GIN ("parser" = "english") COMMENT 'whole line index'
) ENGINE=OLAP
DUPLICATE KEY(`id1`)
DISTRIBUTED BY HASH(`id1`) BUCKETS 1
PROPERTIES (
"replication_num" = "1",
"enable_persistent_index" = "true",
"replicated_storage" = "false",
"compression" = "LZ4"
);
-- result:
-- !result
INSERT INTO t_upper_case_column_name VALUES (1, "b"),(2, "b"),(3, "b");
-- result:
-- !result
SELECT id1 FROM t_upper_case_column_name WHERE `TeXt` MATCH "b";
-- result:
1
2
3
-- !result
SELECT id1 FROM t_upper_case_column_name WHERE `Text` MATCH "b";
-- result:
1
2
3
-- !result
SELECT id1 FROM t_upper_case_column_name WHERE `TEXT` MATCH "b";
-- result:
1
2
3
-- !result
SELECT id1 FROM t_upper_case_column_name WHERE `text` MATCH "b";
-- result:
1
2
3
-- !result
DROP TABLE t_upper_case_column_name;
-- result:
-- !result
-- name: test_alter_replicated_storage
ADMIN SET FRONTEND CONFIG("enable_experimental_gin" = "true");
-- result:
-- !result
CREATE TABLE `t_alter_replicated_storage` (
  `id` bigint(20) NOT NULL COMMENT "",
  `text` varchar(255) NULL COMMENT "",
  INDEX gin_none (`text`) USING GIN ("parser" = "english")
) ENGINE=OLAP
DUPLICATE KEY(`id`)
DISTRIBUTED BY HASH(`id`) BUCKETS 1
PROPERTIES (
"replication_num" = "1",
"enable_persistent_index" = "true",
"replicated_storage" = "false",
"compression" = "LZ4"
);
-- result:
-- !result
ALTER TABLE t_alter_replicated_storage SET ("replicated_storage" = "true");
-- result:
E: (5507, 'Getting analyzing error. Detail message: Can not enable replicated storage when the table has GIN.')
-- !result
SHOW CREATE TABLE t_alter_replicated_storage;
-- result:
t_alter_replicated_storage	CREATE TABLE `t_alter_replicated_storage` (
  `id` bigint(20) NOT NULL COMMENT "",
  `text` varchar(255) NULL COMMENT "",
  INDEX gin_none (`text`) USING GIN("imp_lib" = "clucene", "parser" = "english") COMMENT ''
) ENGINE=OLAP 
DUPLICATE KEY(`id`)
DISTRIBUTED BY HASH(`id`) BUCKETS 1 
PROPERTIES (
"compression" = "LZ4",
"fast_schema_evolution" = "true",
"replicated_storage" = "false",
"replication_num" = "1"
);
-- !result
DROP TABLE t_alter_replicated_storage;
-- result:
-- !result
-- name: test_disable_global_dict_rewrite
ADMIN SET FRONTEND CONFIG("enable_experimental_gin" = "true");
-- result:
-- !result
CREATE TABLE `t_disable_global_dict_rewrite` (
  `id` bigint(20) NOT NULL COMMENT "",
  `v1` varchar(255) NULL COMMENT "",
  `v2` varchar(255) NULL COMMENT "",
  INDEX gin_none (`v1`) USING GIN ("parser" = "english")
) ENGINE=OLAP
DUPLICATE KEY(`id`)
DISTRIBUTED BY HASH(`id`) BUCKETS 1
PROPERTIES (
"replication_num" = "1",
"enable_persistent_index" = "true",
"replicated_storage" = "false",
"compression" = "LZ4"
);
-- result:
-- !result
INSERT INTO t_disable_global_dict_rewrite VALUES (1, "abc", "bcd"), (2, "cbd", "dbs");
-- result:
-- !result
SELECT * FROM t_disable_global_dict_rewrite;
-- result:
1	abc	bcd
2	cbd	dbs
-- !result
SELECT SLEEP(5);
-- result:
1
-- !result
SELECT id FROM t_disable_global_dict_rewrite WHERE v1 MATCH "abc" AND v1 = "abc";
-- result:
1
-- !result
SELECT id FROM t_disable_global_dict_rewrite WHERE v1 MATCH "abc" AND v1 LIKE "%abc%";
-- result:
1
-- !result
SELECT id FROM t_disable_global_dict_rewrite WHERE v1 MATCH "abc" AND v1 IN ("abc", "ab");
-- result:
1
-- !result
SELECT id FROM t_disable_global_dict_rewrite WHERE upper(v2) = "BCD" AND v1 MATCH "abc";
-- result:
1
-- !result
SELECT id FROM t_disable_global_dict_rewrite WHERE upper(v2) = "BCD" AND v1 MATCH "abc";
-- result:
1
-- !result
SELECT id FROM t_disable_global_dict_rewrite WHERE upper(v2) = "BCD" AND v1 MATCH "abc";
-- result:
1
-- !result
SELECT sum(id) FROM t_disable_global_dict_rewrite WHERE v1 MATCH "abc" GROUP BY v1;
-- result:
1
-- !result
SELECT sum(id) FROM t_disable_global_dict_rewrite WHERE v2 MATCH "abc" GROUP BY v2;
-- result:
[REGEX].*Match can only used as a pushdown predicate on column with GIN in a single query.*
-- !result
SELECT id FROM t_disable_global_dict_rewrite WHERE v1 MATCH "abc" ORDER BY v1;
-- result:
1
-- !result
SELECT id FROM t_disable_global_dict_rewrite WHERE v2 MATCH "abc" ORDER BY v2;
-- result:
[REGEX].*Match can only used as a pushdown predicate on column with GIN in a single query.*
-- !result
DROP TABLE t_disable_global_dict_rewrite;
-- result:
-- !result
-- name: test_create_mv_with_match
ADMIN SET FRONTEND CONFIG("enable_experimental_gin" = "true");
-- result:
-- !result
CREATE TABLE `t_create_mv_with_match` (
  `id` bigint(20) NOT NULL COMMENT "",
  `v1` varchar(255) NULL COMMENT "",
  `v2` varchar(255) NULL COMMENT "",
  INDEX gin_none (`v1`) USING GIN ("parser" = "english")
) ENGINE=OLAP
DUPLICATE KEY(`id`)
DISTRIBUTED BY HASH(`id`) BUCKETS 1
PROPERTIES (
"replication_num" = "1",
"enable_persistent_index" = "true",
"replicated_storage" = "false",
"compression" = "LZ4"
);
-- result:
-- !result
INSERT INTO t_create_mv_with_match VALUES (1, "abc", "bcd");
-- result:
-- !result
CREATE MATERIALIZED VIEW mv AS SELECT id, v1, v2 FROM t_create_mv_with_match WHERE v1 MATCH "abc";
-- result:
-- !result
function: wait_materialized_view_cancel()
-- result:
None
-- !result
DROP TABLE t_create_mv_with_match;
-- result:
-- !result
-- name: test_alter_gin_col_into_other_type
ADMIN SET FRONTEND CONFIG("enable_experimental_gin" = "true");
-- result:
-- !result
CREATE TABLE `t_alter_gin_col_into_other_type` (
  `id` bigint(20) NOT NULL COMMENT "",
  `v1` varchar(255) NULL COMMENT "",
  INDEX gin_none (`v1`) USING GIN ("parser" = "english")
) ENGINE=OLAP
DUPLICATE KEY(`id`)
DISTRIBUTED BY HASH(`id`) BUCKETS 1
PROPERTIES (
"replication_num" = "1",
"enable_persistent_index" = "true",
"replicated_storage" = "false",
"compression" = "LZ4"
);
-- result:
-- !result
ALTER TABLE t_alter_gin_col_into_other_type MODIFY COLUMN v1 BIGINT;
-- result:
E: (1064, 'Cannot modify a column with GIN into non-string type')
-- !result
INSERT INTO t_alter_gin_col_into_other_type VALUES (1, "abc");
-- result:
-- !result
ALTER TABLE t_alter_gin_col_into_other_type MODIFY COLUMN v1 VARCHAR(2000);
-- result:
-- !result
function: wait_alter_table_finish()
-- result:
None
-- !result
SHOW CREATE TABLE t_alter_gin_col_into_other_type;
-- result:
t_alter_gin_col_into_other_type	CREATE TABLE `t_alter_gin_col_into_other_type` (
  `id` bigint(20) NOT NULL COMMENT "",
  `v1` varchar(2000) NULL COMMENT "",
  INDEX gin_none (`v1`) USING GIN("imp_lib" = "clucene", "parser" = "english") COMMENT ''
) ENGINE=OLAP 
DUPLICATE KEY(`id`)
DISTRIBUTED BY HASH(`id`) BUCKETS 1 
PROPERTIES (
"compression" = "LZ4",
"fast_schema_evolution" = "true",
"replicated_storage" = "false",
"replication_num" = "1"
);
-- !result
SELECT * FROM t_alter_gin_col_into_other_type;
-- result:
1	abc
-- !result
DROP TABLE t_alter_gin_col_into_other_type;
-- result:
-- !result
-- name: test_gin_var @sequential
ADMIN SET FRONTEND CONFIG("enable_experimental_gin" = "true");
-- result:
-- !result
CREATE TABLE `t_gin_var` (
  `id` bigint(20) NOT NULL COMMENT "",
  `v1` varchar(255) NULL COMMENT "",
  INDEX gin_none (`v1`) USING GIN ("parser" = "standard")
) ENGINE=OLAP
DUPLICATE KEY(`id`)
DISTRIBUTED BY HASH(`id`) BUCKETS 1
PROPERTIES (
"replication_num" = "1",
"enable_persistent_index" = "true",
"replicated_storage" = "false",
"compression" = "LZ4"
);
-- result:
-- !result
INSERT INTO t_gin_var VALUES (1, "abc bcd");
-- result:
-- !result
SELECT * FROM t_gin_var WHERE v1 MATCH "abc";
-- result:
1	abc bcd
-- !result
SET enable_gin_filter = false;
-- result:
-- !result
SELECT * FROM t_gin_var WHERE v1 MATCH "abc";
-- result:
[REGEX].*Match can only used as a pushdown predicate on column with GIN in a single query.*
-- !result
SET enable_gin_filter = true;
-- result:
-- !result
SELECT * FROM t_gin_var WHERE v1 MATCH "abc";
-- result:
1	abc bcd
-- !result
DROP TABLE t_gin_var;
-- result:
-- !result
ADMIN SET FRONTEND CONFIG("enable_experimental_gin" = "false");
-- result:
-- !result
CREATE TABLE `t_gin_var` (
  `id` bigint(20) NOT NULL COMMENT "",
  `v1` varchar(255) NULL COMMENT "",
  INDEX gin_none (`v1`) USING GIN ("parser" = "standard")
) ENGINE=OLAP
DUPLICATE KEY(`id`)
DISTRIBUTED BY HASH(`id`) BUCKETS 1
PROPERTIES (
"replication_num" = "1",
"enable_persistent_index" = "true",
"replicated_storage" = "false",
"compression" = "LZ4"
);
-- result:
E: (1064, 'Getting analyzing error. Detail message: The inverted index is disabled, enable it by setting FE config `enable_experimental_gin` to true.')
-- !result
CREATE TABLE `t_gin_var` (
  `id` bigint(20) NOT NULL COMMENT "",
  `v1` varchar(255) NULL COMMENT ""
) ENGINE=OLAP
DUPLICATE KEY(`id`)
DISTRIBUTED BY HASH(`id`) BUCKETS 1
PROPERTIES (
"replication_num" = "1",
"enable_persistent_index" = "true",
"replicated_storage" = "false",
"compression" = "LZ4"
);
-- result:
-- !result
ALTER TABLE t_gin_var add index idx (v1) USING GIN('parser' = 'standard');
-- result:
E: (1064, 'Getting analyzing error. Detail message: The inverted index is disabled, enable it by setting FE config `enable_experimental_gin` to true.')
-- !result
ADMIN SET FRONTEND CONFIG("enable_experimental_gin" = "true");
-- result:
-- !result
DROP TABLE t_gin_var;
-- result:
-- !result
CREATE TABLE `t_gin_var` (
  `id` bigint(20) NOT NULL COMMENT "",
  `v1` varchar(255) NULL COMMENT "",
  INDEX gin_none (`v1`) USING GIN ("parser" = "standard")
) ENGINE=OLAP
DUPLICATE KEY(`id`)
DISTRIBUTED BY HASH(`id`) BUCKETS 1
PROPERTIES (
"replication_num" = "1",
"enable_persistent_index" = "true",
"replicated_storage" = "false",
"compression" = "LZ4"
);
-- result:
-- !result
DROP TABLE t_gin_var;
-- result:
-- !result
-- name: test_gin_match_empty
CREATE TABLE `t_gin_match_empty` (
  `k` BIGINT NOT NULL COMMENT "",
  `v1` string COMMENT "",
  `v2` string COMMENT "",
  `v3` string COMMENT "",
   INDEX idx1 (v1) USING GIN ('parser' = 'english'),
   INDEX idx2 (v2) USING GIN ('parser' = 'chinese'),
   INDEX idx3 (v3) USING GIN ('parser' = 'standard')
) ENGINE=OLAP 
DUPLICATE KEY(`k`)
DISTRIBUTED BY HASH(`k`) BUCKETS 1
PROPERTIES (
"replication_num" = "1",
"in_memory" = "false",
"enable_persistent_index" = "true",
"replicated_storage" = "false"
);
-- result:
-- !result
insert into t_gin_match_empty values (1, "中文50中文", "中文50中文", "中文50中文");
-- result:
-- !result
SELECT count(*) FROM t_gin_match_empty WHERE v1 MATCH "";
-- result:
0
-- !result
SELECT count(*) FROM t_gin_match_empty WHERE v2 MATCH "";
-- result:
0
-- !result
SELECT count(*) FROM t_gin_match_empty WHERE v3 MATCH "";
-- result:
0
-- !result
DROP TABLE t_gin_match_empty;
-- result:
-- !result
-- name: test_gin_view
ADMIN SET FRONTEND CONFIG("enable_experimental_gin" = "true");
-- result:
-- !result
CREATE TABLE `t_gin_view` (
  `id` bigint(20) NOT NULL COMMENT "",
  `v1` varchar(255) NULL COMMENT "",
  INDEX gin_none (`v1`) USING GIN ("parser" = "english")
) ENGINE=OLAP
DUPLICATE KEY(`id`)
DISTRIBUTED BY HASH(`id`) BUCKETS 1
PROPERTIES (
"replication_num" = "1",
"enable_persistent_index" = "true",
"replicated_storage" = "false",
"compression" = "LZ4"
);
-- result:
-- !result
INSERT INTO t_gin_view VALUES (1, "abd bcd");
-- result:
-- !result
SELECT * FROM t_gin_view;
-- result:
1	abd bcd
-- !result
CREATE VIEW test_view1 (column1, column2) AS SELECT * FROM t_gin_view;
-- result:
-- !result
SELECT * FROM test_view1 WHERE column2 MATCH "abd" AND column2 MATCH "bcd";
-- result:
1	abd bcd
-- !result
SELECT * FROM test_view1 WHERE column2 MATCH "abd" AND column2 MATCH "bcd";
-- result:
1	abd bcd
-- !result
SELECT * FROM test_view1 WHERE column2 MATCH "abd" AND column2 MATCH "bcd";
-- result:
1	abd bcd
-- !result
SELECT * FROM test_view1 WHERE column2 MATCH "abd" AND column2 MATCH "bcd";
-- result:
1	abd bcd
-- !result
SELECT * FROM test_view1 WHERE column2 MATCH "abd" AND column2 MATCH "bcd";
-- result:
1	abd bcd
-- !result
SELECT * FROM test_view1 WHERE column2 MATCH "abd" AND column2 MATCH "bcd";
-- result:
1	abd bcd
-- !result
SELECT * FROM test_view1 WHERE column2 MATCH "abd" AND column2 MATCH "bcd";
-- result:
1	abd bcd
-- !result
SELECT * FROM test_view1 WHERE column2 MATCH "abd" AND column2 MATCH "bcd";
-- result:
1	abd bcd
-- !result
SELECT * FROM test_view1 WHERE column2 MATCH "abd" AND column2 MATCH "bcd";
-- result:
1	abd bcd
-- !result
SELECT * FROM test_view1 WHERE column2 MATCH "abd" AND column2 MATCH "bcd";
-- result:
1	abd bcd
-- !result
DROP TABLE t_gin_view;
-- result:
-- !result
CREATE TABLE duplicate_table_demo_datatype_not_replicated_all_varchar ( AAA DATETIME not NULL COMMENT "", BBB VARCHAR(200) not NULL COMMENT "", CCC VARCHAR(200) not NULL COMMENT "", DDD VARCHAR(20000) COMMENT "", EEE LARGEINT  NULL COMMENT "", FFF DECIMAL(20,10) NULL COMMENT "", GGG VARCHAR(200)  NULL COMMENT "", HHH FLOAT  NULL COMMENT "", III BOOLEAN  NULL COMMENT "", KKK CHAR(20)   NULL COMMENT "", LLL STRING   NULL COMMENT "", MMM VARCHAR(20)   NULL COMMENT "", NNN BINARY  NULL COMMENT "", OOO TINYINT NULL COMMENT "", PPP DATETIME NULL COMMENT "", QQQ ARRAY<INT> NULL COMMENT "", RRR JSON NULL COMMENT "", SSS MAP<INT,INT> NULL COMMENT "", TTT STRUCT<a INT, b INT> NULL COMMENT "", INDEX init_bitmap_index (KKK) USING BITMAP ) duplicate KEY(AAA, BBB, CCC) PARTITION BY RANGE (`AAA`) ( START ("1970-01-01") END ("2030-01-01") EVERY (INTERVAL 30 YEAR) ) DISTRIBUTED BY HASH(`AAA`, `BBB`) BUCKETS 3 ORDER BY(`AAA`,`BBB`,`CCC`,`DDD`) PROPERTIES ( "replicated_storage"="false", "replication_num" = "1", "storage_format" = "v2", "enable_persistent_index" = "true", "bloom_filter_columns" = "MMM", "unique_constraints" = "GGG" );
-- result:
-- !result
create view test_view (AAA, DDD) as select AAA, max(DDD) from duplicate_table_demo_datatype_not_replicated_all_varchar group by AAA;
-- result:
-- !result
CREATE INDEX idx ON duplicate_table_demo_datatype_not_replicated_all_varchar(DDD) USING GIN('parser' = 'english');
-- result:
-- !result
function: wait_alter_table_finish()
-- result:
None
-- !result
insert into duplicate_table_demo_datatype_not_replicated_all_varchar values ('1974-08-20 23:13:25', 'xIjfSXnegdnZiZGQMaxo', 'syHwIOMctmDLDGCibEun', 'hIbilUEGdLbCnaZASCVL', 6299, 25361.52081, 'QuTsacRyxiIkBjEmjhNu', -11.4812925061712, True, 'QcLRdQJMhtPXojJUjkUd', 'yUeFlbzomaPDwKeaHylx', 'WqQyGEjEYpvLzfBXYUCB', '', 8, '2015-11-03 16:31:47', [2621, 5950, 13171], '{"job": "Administrator, Civil Service", "company": "Morris-Anderson", "ssn": "823-67-5554", "residence": "59688 Hanna Shoal Apt. 586\nWest Waynefort, CO 69652", "current_location": ["-64.3777465", "21.079566"], "blood_group": "O-", "website": ["http://young.biz/", "https://cobb-bell.com/", "http://www.roberts-garrison.com/", "http://jones.com/"], "username": "howardarcher", "name": "John Mccullough", "sex": "M", "address": "1361 Susan Mountain\nJasonbury, MI 85084", "mail": "lovejennifer@gmail.com", "birthdate": "1928-06-25"}', null, null);
-- result:
-- !result
select * from test_view where DDD match 'msrjabmbwkxmjggulkiy';
-- result:
[REGEX].*Match can only used as a pushdown predicate on column with GIN in a single query.*
-- !result
select * from test_view where DDD match 'msrjabmbwkxmjggulkiy';
-- result:
[REGEX].*Match can only used as a pushdown predicate on column with GIN in a single query.*
-- !result
select * from test_view where DDD match 'msrjabmbwkxmjggulkiy';
-- result:
[REGEX].*Match can only used as a pushdown predicate on column with GIN in a single query.*
-- !result
select * from test_view where DDD match 'msrjabmbwkxmjggulkiy';
-- result:
[REGEX].*Match can only used as a pushdown predicate on column with GIN in a single query.*
-- !result
select * from test_view where DDD match 'msrjabmbwkxmjggulkiy';
-- result:
[REGEX].*Match can only used as a pushdown predicate on column with GIN in a single query.*
-- !result
select * from test_view where DDD match 'msrjabmbwkxmjggulkiy';
-- result:
[REGEX].*Match can only used as a pushdown predicate on column with GIN in a single query.*
-- !result
select * from test_view where DDD match 'msrjabmbwkxmjggulkiy';
-- result:
[REGEX].*Match can only used as a pushdown predicate on column with GIN in a single query.*
-- !result
select * from test_view where DDD match 'msrjabmbwkxmjggulkiy';
-- result:
[REGEX].*Match can only used as a pushdown predicate on column with GIN in a single query.*
-- !result
select * from test_view where DDD match 'msrjabmbwkxmjggulkiy';
-- result:
[REGEX].*Match can only used as a pushdown predicate on column with GIN in a single query.*
-- !result
select * from test_view where DDD match 'msrjabmbwkxmjggulkiy';
-- result:
[REGEX].*Match can only used as a pushdown predicate on column with GIN in a single query.*
-- !result
DROP VIEW test_view;
-- result:
-- !result
DROP TABLE duplicate_table_demo_datatype_not_replicated_all_varchar;
-- result:
-- !result
-- name: test_vertical_compaction
ADMIN SET FRONTEND CONFIG("enable_experimental_gin" = "true");
-- result:
-- !result
CREATE TABLE `t_vertical_compaction` (
  `id1` bigint(20) NOT NULL COMMENT "",
  `text_column` varchar(255) NULL COMMENT "",
  `col1` varchar(255) DEFAULT "ABC" COMMENT "",
  `col2` varchar(255) DEFAULT "ABC" COMMENT "",
  `col3` varchar(255) DEFAULT "ABC" COMMENT "",
  `col4` varchar(255) DEFAULT "ABC" COMMENT "",
  `col5` varchar(255) DEFAULT "ABC" COMMENT "",
  `col6` varchar(255) DEFAULT "ABC" COMMENT "",
  `col7` varchar(255) DEFAULT "ABC" COMMENT "",
  `col8` varchar(255) DEFAULT "ABC" COMMENT "",
  `col9` varchar(255) DEFAULT "ABC" COMMENT "",
  `col10` varchar(255) DEFAULT "ABC" COMMENT "",
  INDEX gin_none (`text_column`) USING GIN ("parser" = "none") COMMENT 'whole line index'
) ENGINE=OLAP
DUPLICATE KEY(`id1`)
DISTRIBUTED BY HASH(`id1`) BUCKETS 1
PROPERTIES (
"replication_num" = "1",
"enable_persistent_index" = "true",
"replicated_storage" = "false",
"compression" = "LZ4"
);
-- result:
-- !result
INSERT INTO t_vertical_compaction (id1, text_column) VALUES (1, "abc");
-- result:
-- !result
INSERT INTO t_vertical_compaction (id1, text_column) VALUES (2, "ABC");
-- result:
-- !result
INSERT INTO t_vertical_compaction (id1, text_column) VALUES (3, "bcd");
-- result:
-- !result
INSERT INTO t_vertical_compaction (id1, text_column) VALUES (4, "BCD");
-- result:
-- !result
ALTER TABLE t_vertical_compaction BASE COMPACT;
-- result:
-- !result
SELECT sleep(10);
-- result:
1
-- !result
DROP TABLE t_vertical_compaction;
-- result:
-- !result