-- name: test_iceberg_scan_metrics
create external catalog iceberg_sink_${uuid0} PROPERTIES (
    "type"  =  "iceberg",
    "iceberg.catalog.type"  =  "hive",
    "iceberg.catalog.hive.metastore.uris"="${hive_metastore_uris}",
    "aws.s3.access_key"  =  "${oss_ak}",
    "aws.s3.secret_key"  =  "${oss_sk}",
    "aws.s3.endpoint"  =  "${oss_endpoint}",
    "enable_iceberg_metadata_cache" = "false"
);
-- result:
-- !result
function: assert_explain_verbose_contains('select * from iceberg_sink_${uuid0}.iceberg_ci_db.t2 limit 1', 'total-planning-duration')
-- result:
None
-- !result
function: assert_explain_verbose_contains('select * from iceberg_sink_${uuid0}.iceberg_ci_db.t2 limit 1', 'result-data-files')
-- result:
None
-- !result
function: assert_explain_verbose_contains('select * from iceberg_sink_${uuid0}.iceberg_ci_db.t2 limit 1', 'result-delete-files')
-- result:
None
-- !result
function: assert_explain_verbose_contains('select * from iceberg_sink_${uuid0}.iceberg_ci_db.t2 limit 1', 'scanned-data-manifests')
-- result:
None
-- !result
function: assert_explain_verbose_contains('select * from iceberg_sink_${uuid0}.iceberg_ci_db.t2 limit 1', 'total-file-size-in-bytes')
-- result:
None
-- !result
function: assert_explain_verbose_contains('select * from iceberg_sink_${uuid0}.iceberg_ci_db.t2 limit 1', 'scanned-delete-manifests')
-- result:
None
-- !result
set enable_profile=true;
-- result:
-- !result
set enable_async_profile=false;
-- result:
-- !result
select * from iceberg_sink_${uuid0}.iceberg_ci_db.t2 limit 1;
-- result:
1
-- !result
select get_query_profile(last_query_id());
-- result:
[REGEX].*ScanMetrics.*
-- !result