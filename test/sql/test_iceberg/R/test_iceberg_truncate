-- name: test_iceberg_truncate
create external catalog iceberg_truncate_${uuid0} PROPERTIES ("type"="iceberg", "iceberg.catalog.type"="hive", "iceberg.catalog.hive.metastore.uris"="${iceberg_catalog_hive_metastore_uris}","enable_iceberg_metadata_cache"="true","aws.s3.access_key" = "${oss_ak}","aws.s3.secret_key" = "${oss_sk}","aws.s3.endpoint" = "${oss_endpoint}");
-- result:
-- !result
create database iceberg_truncate_${uuid0}.iceberg_db_${uuid0} properties (
    "location" = "oss://${oss_bucket}/iceberg_truncate_${uuid0}/iceberg_db/${uuid0}"
);
-- result:
-- !result
create external table iceberg_truncate_${uuid0}.iceberg_db_${uuid0}.ice_tbl_${uuid0} (k1 int);
-- result:
-- !result
insert into iceberg_truncate_${uuid0}.iceberg_db_${uuid0}.ice_tbl_${uuid0} values(1),(2),(3);
-- result:
-- !result
select * from iceberg_truncate_${uuid0}.iceberg_db_${uuid0}.ice_tbl_${uuid0} order by k1;
-- result:
1
2
3
-- !result
truncate table iceberg_truncate_${uuid0}.iceberg_db_${uuid0}.ice_tbl_${uuid0};
-- result:
-- !result
select * from iceberg_truncate_${uuid0}.iceberg_db_${uuid0}.ice_tbl_${uuid0} order by k1;
-- result:
-- !result
set catalog iceberg_truncate_${uuid0};
-- result:
-- !result
insert into iceberg_db_${uuid0}.ice_tbl_${uuid0} values(1),(2),(3);
-- result:
-- !result
select * from iceberg_db_${uuid0}.ice_tbl_${uuid0} order by k1;
-- result:
1
2
3
-- !result
truncate table iceberg_db_${uuid0}.ice_tbl_${uuid0};
-- result:
-- !result
select * from iceberg_db_${uuid0}.ice_tbl_${uuid0} order by k1;
-- result:
-- !result
use iceberg_truncate_${uuid0}.iceberg_db_${uuid0};
-- result:
-- !result
insert into ice_tbl_${uuid0} values(1),(2),(3);
-- result:
-- !result
select * from ice_tbl_${uuid0} order by k1;
-- result:
1
2
3
-- !result
truncate table ice_tbl_${uuid0};
-- result:
-- !result
select * from ice_tbl_${uuid0} order by k1;
-- result:
-- !result
drop table iceberg_truncate_${uuid0}.iceberg_db_${uuid0}.ice_tbl_${uuid0} force;
-- result:
-- !result
drop database iceberg_truncate_${uuid0}.iceberg_db_${uuid0};
-- result:
-- !result
drop catalog iceberg_truncate_${uuid0};
-- result:
-- !result
shell: ossutil64 rm -rf oss://${oss_bucket}/iceberg_truncate_${uuid0}/iceberg_db/${uuid0} > /dev/null || echo "exit 0" >/dev/null
-- result:
0

-- !result