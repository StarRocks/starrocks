-- name: test_iceberg_file_path_position

create external catalog iceberg_sql_test_${uuid0} PROPERTIES ("type"="iceberg", "iceberg.catalog.type"="hive", "iceberg.catalog.hive.metastore.uris"="${iceberg_catalog_hive_metastore_uris}","enable_iceberg_metadata_cache"="true","aws.s3.access_key" = "${oss_ak}","aws.s3.secret_key" = "${oss_sk}","aws.s3.endpoint" = "${oss_endpoint}");

-- Test _file column (should be string, not null)
select max(_file) from iceberg_sql_test_${uuid0}.iceberg_oss_db.entity;
select count(distinct _file) from iceberg_sql_test_${uuid0}.iceberg_oss_db.entity;
select distinct _file from iceberg_sql_test_${uuid0}.iceberg_oss_db.entity;
select count(distinct _file) from iceberg_sql_test_${uuid0}.iceberg_oss_db.partsupp_two_bucket;
select distinct _file from iceberg_sql_test_${uuid0}.iceberg_oss_db.partsupp_two_bucket order by _file;

-- Test _pos column (should be bigint, not null)
select min(_pos), max(_pos) from iceberg_sql_test_${uuid0}.iceberg_oss_db.entity;
select count(distinct _pos) from iceberg_sql_test_${uuid0}.iceberg_oss_db.entity;
select min(_pos), max(_pos) from iceberg_sql_test_${uuid0}.iceberg_oss_db.partsupp_two_bucket;
select count(distinct _pos) from iceberg_sql_test_${uuid0}.iceberg_oss_db.partsupp_two_bucket;

-- Test combination of _file and _pos
select entity_id,_file, _pos from iceberg_sql_test_${uuid0}.iceberg_oss_db.entity where entity_id = 'e_635571';
select entity_id,_file, _pos from iceberg_sql_test_${uuid0}.iceberg_oss_db.entity order by entity_id,_file,_pos limit 5;
select ps_partkey, ps_suppkey, _file, _pos from iceberg_sql_test_${uuid0}.iceberg_oss_db.partsupp_two_bucket  order by ps_partkey,ps_suppkey,_file,_pos limit 5;

drop catalog iceberg_sql_test_${uuid0};
