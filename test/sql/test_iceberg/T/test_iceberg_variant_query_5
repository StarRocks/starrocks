-- name: test_iceberg_variant_query_5

-- iceberg catalog on hive does not variant yet.

create external catalog iceberg_sql_test_${uuid0}
PROPERTIES ("type"="iceberg", "iceberg.catalog.type"="hadoop", "iceberg.catalog.warehouse"="oss://${oss_bucket}/test_iceberg_variant_query_5/${uuid0}/warehouse/");

shell: ossutil64 mkdir oss://${oss_bucket}/test_iceberg_variant_query_5/${uuid0}/warehouse/iceberg_variant > /dev/null

use iceberg_sql_test_${uuid0}.iceberg_variant;

-- ========================================
-- StarRocks Table Creation for P1 Analytics
-- ========================================

CREATE TABLE variant_analytics_users (
    user_id INT,
    variant_profile VARIANT
)
properties(
  'format-version' = '3'
);

CREATE TABLE variant_analytics_orders (
    order_id INT,
    variant_order VARIANT
)
properties(
  'format-version' = '3'
);

CREATE TABLE variant_analytics_logs (
    log_id INT,
    variant_log VARIANT
)
properties(
  'format-version' = '3'
);

CREATE TABLE variant_analytics_events (
    event_id INT,
    variant_event VARIANT
)
properties(
  'format-version' = '3'
);

shell: ossutil64 cp ./sql/test_iceberg/data/variant_analytics_users/data/00000-4481-6663e105-7590-4b0d-a12e-532e70997c54-0-00001.parquet oss://${oss_bucket}/test_iceberg_variant_query_5/${uuid0}/variant_analytics_users/data/00000-4481-6663e105-7590-4b0d-a12e-532e70997c54-0-00001.parquet > /dev/null
shell: ossutil64 cp ./sql/test_iceberg/data/variant_analytics_orders/data/00000-5092-2040b2d3-ece5-4a3e-921d-5c6fe199d84e-0-00001.parquet oss://${oss_bucket}/test_iceberg_variant_query_5/${uuid0}/variant_analytics_orders/data/00000-5092-2040b2d3-ece5-4a3e-921d-5c6fe199d84e-0-00001.parquet > /dev/null
shell: ossutil64 cp ./sql/test_iceberg/data/variant_analytics_logs/data/00000-5703-3b3d8f17-3283-4bfe-9b15-c5e709543218-0-00001.parquet oss://${oss_bucket}/test_iceberg_variant_query_5/${uuid0}/variant_analytics_logs/data/00000-5703-3b3d8f17-3283-4bfe-9b15-c5e709543218-0-00001.parquet > /dev/null
shell: ossutil64 cp ./sql/test_iceberg/data/variant_analytics_events/data/00000-6314-35dbd646-4270-4820-8218-51aaf402590d-0-00001.parquet oss://${oss_bucket}/test_iceberg_variant_query_5/${uuid0}/variant_analytics_events/data/00000-6314-35dbd646-4270-4820-8218-51aaf402590d-0-00001.parquet > /dev/null

alter table variant_analytics_users execute add_files(location='oss://${oss_bucket}/test_iceberg_variant_query_5/${uuid0}/variant_analytics_users/data/00000-4481-6663e105-7590-4b0d-a12e-532e70997c54-0-00001.parquet', file_format='parquet');
alter table variant_analytics_orders execute add_files(location='oss://${oss_bucket}/test_iceberg_variant_query_5/${uuid0}/variant_analytics_orders/data/00000-5092-2040b2d3-ece5-4a3e-921d-5c6fe199d84e-0-00001.parquet', file_format='parquet');
alter table variant_analytics_logs execute add_files(location='oss://${oss_bucket}/test_iceberg_variant_query_5/${uuid0}/variant_analytics_logs/data/00000-5703-3b3d8f17-3283-4bfe-9b15-c5e709543218-0-00001.parquet', file_format='parquet');
alter table variant_analytics_events execute add_files(location='oss://${oss_bucket}/test_iceberg_variant_query_5/${uuid0}/variant_analytics_events/data/00000-6314-35dbd646-4270-4820-8218-51aaf402590d-0-00001.parquet', file_format='parquet');


-- ========================================
-- P1 Analytics Validation Queries
-- ========================================

-- ========================================
-- Query 1: WHERE Clause - String Equality Filter
-- Test ID: UNC-5.1.1
-- ========================================
SELECT 'Query 1: Filter by VARIANT string field equality' AS test_description;
SELECT
    user_id,
    get_variant_string(variant_profile, '$.name') as name,
    get_variant_string(variant_profile, '$.status') as status,
    get_variant_int(variant_profile, '$.age') as age
FROM variant_analytics_users
WHERE get_variant_string(variant_profile, '$.status') = 'active'
ORDER BY user_id;

-- ========================================
-- Query 2: WHERE Clause - Numeric Comparison
-- Test ID: UNC-5.1.2
-- ========================================
SELECT 'Query 2: Filter by VARIANT numeric field comparison' AS test_description;
SELECT
    user_id,
    get_variant_string(variant_profile, '$.name') as name,
    get_variant_int(variant_profile, '$.age') as age,
    get_variant_string(variant_profile, '$.status') as status
FROM variant_analytics_users
WHERE get_variant_int(variant_profile, '$.age') > 30
ORDER BY user_id;

-- ========================================
-- Query 3: WHERE Clause - LIKE Pattern Match
-- Test ID: UNC-5.1.3
-- ========================================
SELECT 'Query 3: Filter by VARIANT string LIKE pattern' AS test_description;
SELECT
    user_id,
    get_variant_string(variant_profile, '$.name') as name,
    get_variant_string(variant_profile, '$.email') as email
FROM variant_analytics_users
WHERE get_variant_string(variant_profile, '$.email') LIKE '%@example.com'
ORDER BY user_id;

-- ========================================
-- Query 4: WHERE Clause - IS NULL Check
-- Test ID: UNC-5.1.4
-- ========================================
SELECT 'Query 4: Filter with IS NULL check on VARIANT field' AS test_description;
SELECT
    log_id,
    get_variant_string(variant_log, '$.level') as log_level,
    get_variant_string(variant_log, '$.error_type') as error_type,
    CASE
        WHEN get_variant_string(variant_log, '$.error_type') IS NULL THEN 'NO_ERROR'
        ELSE get_variant_string(variant_log, '$.error_type')
    END as error_status
FROM variant_analytics_logs
WHERE get_variant_string(variant_log, '$.error_type') IS NULL
ORDER BY log_id;

-- ========================================
-- Query 5: WHERE Clause - Multiple AND Conditions
-- Test ID: UNC-5.1.5
-- ========================================
SELECT 'Query 5: Filter with multiple AND conditions on VARIANT fields' AS test_description;
SELECT
    user_id,
    get_variant_string(variant_profile, '$.name') as name,
    get_variant_int(variant_profile, '$.age') as age,
    get_variant_string(variant_profile, '$.status') as status,
    get_variant_double(variant_profile, '$.score') as score
FROM variant_analytics_users
WHERE get_variant_int(variant_profile, '$.age') > 25
  AND get_variant_string(variant_profile, '$.status') = 'active'
  AND get_variant_double(variant_profile, '$.score') >= 85.0
ORDER BY user_id;

-- ========================================
-- Query 6: WHERE Clause - OR Conditions
-- Test ID: UNC-5.1.6
-- ========================================
SELECT 'Query 6: Filter with OR conditions on VARIANT fields' AS test_description;
SELECT
    user_id,
    get_variant_string(variant_profile, '$.name') as name,
    get_variant_string(variant_profile, '$.country') as country
FROM variant_analytics_users
WHERE get_variant_string(variant_profile, '$.country') = 'USA'
   OR get_variant_string(variant_profile, '$.country') = 'UK'
ORDER BY user_id;

-- ========================================
-- Query 7: Aggregation - COUNT
-- Test ID: UNC-5.2.1
-- ========================================
SELECT 'Query 7: COUNT aggregation on VARIANT column' AS test_description;
SELECT
    COUNT(*) as total_users,
    COUNT(CASE WHEN get_variant_string(variant_profile, '$.status') = 'active' THEN 1 END) as active_users,
    COUNT(CASE WHEN get_variant_string(variant_profile, '$.status') = 'inactive' THEN 1 END) as inactive_users
FROM variant_analytics_users;

-- ========================================
-- Query 8: Aggregation - SUM
-- Test ID: UNC-5.2.2
-- ========================================
SELECT 'Query 8: SUM aggregation on VARIANT numeric field' AS test_description;
SELECT
    SUM(get_variant_double(variant_order, '$.amount')) as total_revenue,
    COUNT(*) as order_count,
    SUM(get_variant_double(variant_order, '$.amount')) / COUNT(*) as avg_order_value
FROM variant_analytics_orders;

-- ========================================
-- Query 9: Aggregation - AVG
-- Test ID: UNC-5.2.3
-- ========================================
SELECT 'Query 9: AVG aggregation on VARIANT numeric field' AS test_description;
SELECT
    AVG(get_variant_double(variant_profile, '$.score')) as avg_score,
    AVG(get_variant_int(variant_profile, '$.age')) as avg_age
FROM variant_analytics_users
WHERE get_variant_string(variant_profile, '$.status') = 'active';

-- ========================================
-- Query 10: Aggregation - MIN/MAX
-- Test ID: UNC-5.2.4
-- ========================================
SELECT 'Query 10: MIN/MAX aggregation on VARIANT fields' AS test_description;
SELECT
    MIN(get_variant_int(variant_profile, '$.age')) as youngest_age,
    MAX(get_variant_int(variant_profile, '$.age')) as oldest_age,
    MIN(get_variant_double(variant_profile, '$.score')) as min_score,
    MAX(get_variant_double(variant_profile, '$.score')) as max_score
FROM variant_analytics_users;

-- ========================================
-- Query 11: GROUP BY on VARIANT Field
-- Test ID: UNC-5.3.1
-- ========================================
SELECT 'Query 11: GROUP BY on VARIANT extracted field' AS test_description;
SELECT
    get_variant_string(variant_profile, '$.status') as status,
    COUNT(*) as user_count,
    AVG(get_variant_double(variant_profile, '$.score')) as avg_score
FROM variant_analytics_users
GROUP BY get_variant_string(variant_profile, '$.status')
ORDER BY status;

-- ========================================
-- Query 12: GROUP BY Multiple VARIANT Fields
-- ========================================
SELECT 'Query 12: GROUP BY multiple VARIANT fields' AS test_description;
SELECT
    get_variant_string(variant_profile, '$.country') as country,
    get_variant_string(variant_profile, '$.status') as status,
    COUNT(*) as user_count,
    AVG(get_variant_int(variant_profile, '$.age')) as avg_age
FROM variant_analytics_users
GROUP BY
    get_variant_string(variant_profile, '$.country'),
    get_variant_string(variant_profile, '$.status')
ORDER BY country, status;

-- ========================================
-- Query 13: ORDER BY on VARIANT Field
-- Test ID: UNC-5.3.2
-- ========================================
SELECT 'Query 13: ORDER BY on VARIANT extracted field' AS test_description;
SELECT
    user_id,
    get_variant_string(variant_profile, '$.name') as name,
    get_variant_double(variant_profile, '$.score') as score
FROM variant_analytics_users
ORDER BY get_variant_double(variant_profile, '$.score') DESC
LIMIT 5;

-- ========================================
-- Query 14: JOIN on VARIANT Extracted Field
-- Test ID: UNC-5.4.1
-- ========================================
SELECT 'Query 14: JOIN tables on VARIANT extracted field' AS test_description;
SELECT
    u.user_id,
    get_variant_string(u.variant_profile, '$.name') as user_name,
    get_variant_string(u.variant_profile, '$.email') as email,
    o.order_id,
    get_variant_double(o.variant_order, '$.amount') as order_amount,
    get_variant_string(o.variant_order, '$.product') as product
FROM variant_analytics_users u
JOIN variant_analytics_orders o
    ON u.user_id = get_variant_int(o.variant_order, '$.user_id')
ORDER BY u.user_id, o.order_id;

-- ========================================
-- Query 15: Real-World Analytics - Log Error Analysis
-- Test ID: UNC-5.5.1
-- ========================================
SELECT 'Query 15: Analyze error logs by type and service' AS test_description;
SELECT
    get_variant_string(variant_log, '$.level') as log_level,
    get_variant_string(variant_log, '$.error_type') as error_type,
    get_variant_string(variant_log, '$.service') as service,
    COUNT(*) as error_count
FROM variant_analytics_logs
WHERE get_variant_string(variant_log, '$.level') = 'ERROR'
GROUP BY
    get_variant_string(variant_log, '$.level'),
    get_variant_string(variant_log, '$.error_type'),
    get_variant_string(variant_log, '$.service')
ORDER BY error_count DESC;

-- ========================================
-- Query 16: Real-World Analytics - Conversion Funnel
-- Test ID: UNC-5.5.3
-- ========================================
SELECT 'Query 16: Compute e-commerce conversion funnel' AS test_description;
WITH events AS (
    SELECT
        get_variant_string(variant_event, '$.user_id') as user_id,
        get_variant_string(variant_event, '$.event_type') as event_type,
        get_variant_int(variant_event, '$.timestamp') as ts
    FROM variant_analytics_events
)
SELECT
    COUNT(DISTINCT CASE WHEN event_type = 'page_view' THEN user_id END) as users_viewed,
    COUNT(DISTINCT CASE WHEN event_type = 'add_to_cart' THEN user_id END) as users_added_cart,
    COUNT(DISTINCT CASE WHEN event_type = 'purchase' THEN user_id END) as users_purchased,
    ROUND(COUNT(DISTINCT CASE WHEN event_type = 'add_to_cart' THEN user_id END) * 100.0 /
          NULLIF(COUNT(DISTINCT CASE WHEN event_type = 'page_view' THEN user_id END), 0), 2) as cart_conversion_rate,
    ROUND(COUNT(DISTINCT CASE WHEN event_type = 'purchase' THEN user_id END) * 100.0 /
          NULLIF(COUNT(DISTINCT CASE WHEN event_type = 'add_to_cart' THEN user_id END), 0), 2) as purchase_conversion_rate
FROM events;

-- ========================================
-- Query 17: Revenue by Category
-- ========================================
SELECT 'Query 17: Aggregate revenue by product category' AS test_description;
SELECT
    get_variant_string(variant_order, '$.category') as category,
    COUNT(*) as order_count,
    SUM(get_variant_double(variant_order, '$.amount')) as total_revenue,
    AVG(get_variant_double(variant_order, '$.amount')) as avg_order_value,
    MIN(get_variant_double(variant_order, '$.amount')) as min_order,
    MAX(get_variant_double(variant_order, '$.amount')) as max_order
FROM variant_analytics_orders
GROUP BY get_variant_string(variant_order, '$.category')
ORDER BY total_revenue DESC;

-- ========================================
-- Query 18: User Activity with Orders
-- ========================================
SELECT 'Query 18: Join users with their order summary' AS test_description;
SELECT
    u.user_id,
    get_variant_string(u.variant_profile, '$.name') as user_name,
    get_variant_string(u.variant_profile, '$.country') as country,
    COUNT(o.order_id) as order_count,
    COALESCE(SUM(get_variant_double(o.variant_order, '$.amount')), 0) as total_spent
FROM variant_analytics_users u
LEFT JOIN variant_analytics_orders o
    ON u.user_id = get_variant_int(o.variant_order, '$.user_id')
GROUP BY
    u.user_id,
    get_variant_string(u.variant_profile, '$.name'),
    get_variant_string(u.variant_profile, '$.country')
ORDER BY total_spent DESC;

-- ========================================
-- Query 19: Event Distribution by Type
-- ========================================
SELECT 'Query 19: Event type distribution and metrics' AS test_description;
SELECT
    get_variant_string(variant_event, '$.event_type') as event_type,
    COUNT(*) as event_count,
    COUNT(DISTINCT get_variant_string(variant_event, '$.user_id')) as unique_users,
    MIN(get_variant_int(variant_event, '$.timestamp')) as first_event_ts,
    MAX(get_variant_int(variant_event, '$.timestamp')) as last_event_ts
FROM variant_analytics_events
GROUP BY get_variant_string(variant_event, '$.event_type')
ORDER BY event_count DESC;

-- ========================================
-- Query 20: Complex Filter with Aggregation
-- ========================================
SELECT 'Query 20: Complex filtering with GROUP BY and HAVING' AS test_description;
SELECT
    get_variant_string(variant_profile, '$.country') as country,
    COUNT(*) as user_count,
    AVG(get_variant_double(variant_profile, '$.score')) as avg_score,
    AVG(get_variant_int(variant_profile, '$.age')) as avg_age
FROM variant_analytics_users
WHERE get_variant_string(variant_profile, '$.status') IN ('active', 'inactive')
GROUP BY get_variant_string(variant_profile, '$.country')
HAVING COUNT(*) >= 2
ORDER BY avg_score DESC;


drop table variant_analytics_users force;
drop table variant_analytics_orders force;
drop table variant_analytics_logs force;
drop table variant_analytics_events force;
set catalog default_catalog;
drop catalog iceberg_sql_test_${uuid0};

shell: ossutil64 rm -rf oss://${oss_bucket}/test_iceberg_variant_query_5/${uuid0}/ > /dev/null


-- use spark to generate those data files

-- ========================================
-- P1 Analytics Test Suite
-- Covers: UNC-5.1.x (Filters), UNC-5.2.x (Aggregations), UNC-5.3.x (Group/Sort), UNC-5.4.x (Joins), UNC-5.5.x (Real-world)
-- ========================================
-- This test suite validates VARIANT in analytics scenarios:
-- - WHERE clause filtering on VARIANT fields
-- - Aggregations (COUNT, SUM, AVG, MIN, MAX)
-- - GROUP BY and ORDER BY on VARIANT fields
-- - JOIN operations using VARIANT fields
-- - Real-world analytics patterns (logs, sessions, events)
-- ========================================

-- use iceberg_glue2.zya;

-- DROP TABLE IF EXISTS variant_analytics_users;
-- DROP TABLE IF EXISTS variant_analytics_orders;
-- DROP TABLE IF EXISTS variant_analytics_events;
-- DROP TABLE IF EXISTS variant_analytics_logs;

-- -- ========================================
-- -- Test 1: User Data for Filtering and Aggregation
-- -- Test IDs: UNC-5.1.x, UNC-5.2.x, UNC-5.3.x
-- -- ========================================
-- CREATE TABLE variant_analytics_users (
--     user_id INT,
--     variant_profile VARIANT
-- ) USING iceberg
-- TBLPROPERTIES (
--     'format-version' = '3',
--     'write.format.default' = 'parquet',
--     'engine.hive.enabled' = 'false'
-- );

-- INSERT INTO variant_analytics_users VALUES
--     (1, parse_json('{"name":"Alice","age":28,"email":"alice@example.com","status":"active","score":85.5,"country":"USA"}')),
--     (2, parse_json('{"name":"Bob","age":35,"email":"bob@example.com","status":"active","score":92.3,"country":"Canada"}')),
--     (3, parse_json('{"name":"Charlie","age":22,"email":"charlie@test.com","status":"inactive","score":67.8,"country":"USA"}')),
--     (4, parse_json('{"name":"Diana","age":41,"email":"diana@example.com","status":"active","score":88.1,"country":"UK"}')),
--     (5, parse_json('{"name":"Eve","age":29,"email":"eve@test.org","status":"active","score":95.7,"country":"Canada"}')),
--     (6, parse_json('{"name":"Frank","age":33,"email":"frank@example.com","status":"suspended","score":71.2,"country":"USA"}')),
--     (7, parse_json('{"name":"Grace","age":26,"email":"grace@example.com","status":"active","score":89.4,"country":"UK"}')),
--     (8, parse_json('{"name":"Henry","age":38,"email":"henry@test.com","status":"active","score":76.5,"country":"USA"}')),
--     (9, parse_json('{"name":"Ivy","age":31,"email":"ivy@example.com","status":"inactive","score":82.9,"country":"Canada"}')),
--     (10, parse_json('{"name":"Jack","age":27,"email":"jack@example.com","status":"active","score":91.0,"country":"UK"}'));

-- -- ========================================
-- -- Test 2: Order Data for Joins
-- -- Test ID: UNC-5.4.1
-- -- ========================================
-- CREATE TABLE variant_analytics_orders (
--     order_id INT,
--     variant_order VARIANT
-- ) USING iceberg
-- TBLPROPERTIES (
--     'format-version' = '3',
--     'write.format.default' = 'parquet',
--     'engine.hive.enabled' = 'false'
-- );

-- INSERT INTO variant_analytics_orders VALUES
--     (101, parse_json('{"user_id":1,"amount":150.50,"product":"Laptop","category":"Electronics","timestamp":"2024-01-15 10:30:00"}')),
--     (102, parse_json('{"user_id":2,"amount":45.99,"product":"Book","category":"Books","timestamp":"2024-01-16 14:20:00"}')),
--     (103, parse_json('{"user_id":1,"amount":89.99,"product":"Mouse","category":"Electronics","timestamp":"2024-01-17 09:15:00"}')),
--     (104, parse_json('{"user_id":4,"amount":210.00,"product":"Desk","category":"Furniture","timestamp":"2024-01-18 16:45:00"}')),
--     (105, parse_json('{"user_id":3,"amount":12.50,"product":"Notebook","category":"Stationery","timestamp":"2024-01-19 11:00:00"}')),
--     (106, parse_json('{"user_id":2,"amount":299.99,"product":"Monitor","category":"Electronics","timestamp":"2024-01-20 13:30:00"}')),
--     (107, parse_json('{"user_id":5,"amount":67.80,"product":"Keyboard","category":"Electronics","timestamp":"2024-01-21 10:00:00"}')),
--     (108, parse_json('{"user_id":1,"amount":125.00,"product":"Chair","category":"Furniture","timestamp":"2024-01-22 15:20:00"}')),
--     (109, parse_json('{"user_id":7,"amount":55.50,"product":"Lamp","category":"Furniture","timestamp":"2024-01-23 12:10:00"}')),
--     (110, parse_json('{"user_id":2,"amount":34.99,"product":"Cable","category":"Electronics","timestamp":"2024-01-24 09:40:00"}'));

-- -- ========================================
-- -- Test 3: Application Logs for Real-World Analytics
-- -- Test ID: UNC-5.5.1
-- -- ========================================
-- CREATE TABLE variant_analytics_logs (
--     log_id INT,
--     variant_log VARIANT
-- ) USING iceberg
-- TBLPROPERTIES (
--     'format-version' = '3',
--     'write.format.default' = 'parquet',
--     'engine.hive.enabled' = 'false'
-- );

-- INSERT INTO variant_analytics_logs VALUES
--     (1, parse_json('{"timestamp":"2024-01-20 10:00:00","level":"INFO","message":"Application started","service":"api","error_type":null}')),
--     (2, parse_json('{"timestamp":"2024-01-20 10:05:00","level":"ERROR","message":"Database connection failed","service":"api","error_type":"ConnectionError"}')),
--     (3, parse_json('{"timestamp":"2024-01-20 10:06:00","level":"ERROR","message":"Timeout waiting for response","service":"api","error_type":"TimeoutError"}')),
--     (4, parse_json('{"timestamp":"2024-01-20 10:10:00","level":"WARN","message":"High memory usage detected","service":"worker","error_type":null}')),
--     (5, parse_json('{"timestamp":"2024-01-20 10:15:00","level":"ERROR","message":"Invalid input parameter","service":"api","error_type":"ValidationError"}')),
--     (6, parse_json('{"timestamp":"2024-01-20 10:20:00","level":"INFO","message":"Request processed successfully","service":"api","error_type":null}')),
--     (7, parse_json('{"timestamp":"2024-01-20 10:25:00","level":"ERROR","message":"Database connection failed","service":"worker","error_type":"ConnectionError"}')),
--     (8, parse_json('{"timestamp":"2024-01-20 10:30:00","level":"ERROR","message":"Out of memory","service":"worker","error_type":"MemoryError"}')),
--     (9, parse_json('{"timestamp":"2024-01-20 10:35:00","level":"INFO","message":"Cache cleared","service":"api","error_type":null}')),
--     (10, parse_json('{"timestamp":"2024-01-20 10:40:00","level":"ERROR","message":"Invalid input parameter","service":"api","error_type":"ValidationError"}'));

-- -- ========================================
-- -- Test 4: Session Events for Conversion Funnel
-- -- Test IDs: UNC-5.5.2, UNC-5.5.3
-- -- ========================================
-- CREATE TABLE variant_analytics_events (
--     event_id INT,
--     variant_event VARIANT
-- ) USING iceberg
-- TBLPROPERTIES (
--     'format-version' = '3',
--     'write.format.default' = 'parquet',
--     'engine.hive.enabled' = 'false'
-- );

-- INSERT INTO variant_analytics_events VALUES
--     (1, parse_json('{"user_id":"u1","event_type":"page_view","timestamp":1705820000,"page":"/home","session_id":"s1"}')),
--     (2, parse_json('{"user_id":"u1","event_type":"add_to_cart","timestamp":1705820060,"product_id":"p101","session_id":"s1"}')),
--     (3, parse_json('{"user_id":"u1","event_type":"purchase","timestamp":1705820120,"amount":99.99,"session_id":"s1"}')),
--     (4, parse_json('{"user_id":"u2","event_type":"page_view","timestamp":1705820180,"page":"/products","session_id":"s2"}')),
--     (5, parse_json('{"user_id":"u2","event_type":"page_view","timestamp":1705820240,"page":"/about","session_id":"s2"}')),
--     (6, parse_json('{"user_id":"u3","event_type":"page_view","timestamp":1705820300,"page":"/home","session_id":"s3"}')),
--     (7, parse_json('{"user_id":"u3","event_type":"add_to_cart","timestamp":1705820360,"product_id":"p202","session_id":"s3"}')),
--     (8, parse_json('{"user_id":"u3","event_type":"add_to_cart","timestamp":1705820420,"product_id":"p303","session_id":"s3"}')),
--     (9, parse_json('{"user_id":"u3","event_type":"purchase","timestamp":1705820480,"amount":249.50,"session_id":"s3"}')),
--     (10, parse_json('{"user_id":"u4","event_type":"page_view","timestamp":1705820540,"page":"/products","session_id":"s4"}')),
--     (11, parse_json('{"user_id":"u4","event_type":"add_to_cart","timestamp":1705820600,"product_id":"p404","session_id":"s4"}')),
--     (12, parse_json('{"user_id":"u5","event_type":"page_view","timestamp":1705820660,"page":"/home","session_id":"s5"}')),
--     (13, parse_json('{"user_id":"u5","event_type":"page_view","timestamp":1705820720,"page":"/pricing","session_id":"s5"}')),
--     (14, parse_json('{"user_id":"u6","event_type":"page_view","timestamp":1705820780,"page":"/home","session_id":"s6"}')),
--     (15, parse_json('{"user_id":"u6","event_type":"add_to_cart","timestamp":1705820840,"product_id":"p505","session_id":"s6"}')),
--     (16, parse_json('{"user_id":"u6","event_type":"purchase","timestamp":1705820900,"amount":179.00,"session_id":"s6"}'));

-- -- Sanity checks
-- SELECT 'variant_analytics_users' AS table_name, COUNT(*) AS row_count FROM variant_analytics_users;
-- SELECT 'variant_analytics_orders' AS table_name, COUNT(*) AS row_count FROM variant_analytics_orders;
-- SELECT 'variant_analytics_logs' AS table_name, COUNT(*) AS row_count FROM variant_analytics_logs;
-- SELECT 'variant_analytics_events' AS table_name, COUNT(*) AS row_count FROM variant_analytics_events;
