-- name: test_flat_json_consistency
CREATE TABLE `test_json_cast_map` (
  `c1` bigint(20) NULL COMMENT "",
  `c2` json NULL COMMENT ""
);
-- result:
-- !result
insert into test_json_cast_map values
(1, '{"level1": {"level2": {"level3": {"level4": {"5":"abc"}}}}}'),
(2, '{"level1": {"level2": {"level3": {"level4": {}}}}}'),
(9, '{"100": {"200": {"300": "abc"}}}');
-- result:
-- !result
select * from test_json_cast_map order by c1;
-- result:
1	{"level1": {"level2": {"level3": {"level4": {"5": "abc"}}}}}
2	{"level1": {"level2": {"level3": {"level4": {}}}}}
9	{"100": {"200": {"300": "abc"}}}
-- !result
select flat_json_meta(c2) from test_json_cast_map [_META_];
-- result:
["nulls(TINYINT), 100.200.300(VARCHAR), level1.level2.level3.level4.5(VARCHAR), remain(JSON)"]
-- !result
truncate table test_json_cast_map;
-- result:
-- !result
insert into test_json_cast_map values
(1, '{"level1": {"level2": {"level3": {"level4": {"5":"abc"}}}}}'),
(2, '{"level1": {"level2": {"level3": {"level4": {}}}}}');
-- result:
-- !result
select * from test_json_cast_map order by c1;
-- result:
1	{"level1": {"level2": {"level3": {"level4": {"5": "abc"}}}}}
2	{"level1": {"level2": {"level3": {"level4": {}}}}}
-- !result
select flat_json_meta(c2) from test_json_cast_map [_META_];
-- result:
["nulls(TINYINT), level1.level2.level3.level4.5(VARCHAR), remain(JSON)"]
-- !result
truncate table test_json_cast_map;
-- result:
-- !result
insert into test_json_cast_map values
(1, '{"level1": {"level2": {"level3": {"level4": {"5":"abc"}}}}}'),
(9, '{"100": {"200": {"300": "abc"}}}');
-- result:
-- !result
select * from test_json_cast_map order by c1;
-- result:
1	{"level1": {"level2": {"level3": {"level4": {"5": "abc"}}}}}
9	{"100": {"200": {"300": "abc"}}}
-- !result
select flat_json_meta(c2) from test_json_cast_map [_META_];
-- result:
["nulls(TINYINT), 100.200.300(VARCHAR), level1.level2.level3.level4.5(VARCHAR), remain(JSON)"]
-- !result
truncate table test_json_cast_map;
-- result:
-- !result
insert into test_json_cast_map values
(1, '{"level1": {"level2": {"level3": {"level4": {"5":"abc"}}}}}'),
(2, '{"level1": {"level2": {"level3": {"level4": {"5":"def"}}}}}'),
(3, '{"level1": {"level2": {"level3": {"level4": {"6":"ghi"}}}}}');
-- result:
-- !result
select * from test_json_cast_map order by c1;
-- result:
1	{"level1": {"level2": {"level3": {"level4": {"5": "abc"}}}}}
2	{"level1": {"level2": {"level3": {"level4": {"5": "def"}}}}}
3	{"level1": {"level2": {"level3": {"level4": {"6": "ghi"}}}}}
-- !result
select flat_json_meta(c2) from test_json_cast_map [_META_];
-- result:
["nulls(TINYINT), level1.level2.level3.level4.5(VARCHAR), level1.level2.level3.level4.6(VARCHAR), remain(JSON)"]
-- !result
truncate table test_json_cast_map;
-- result:
-- !result
insert into test_json_cast_map values
(2, '{"level1": {"level2": {"level3": {"level4": {}}}}}'),
(9, '{"100": {"200": {"300": "abc"}}}');
-- result:
-- !result
select * from test_json_cast_map order by c1;
-- result:
2	{"level1": {"level2": {"level3": {"level4": {}}}}}
9	{"100": {"200": {"300": "abc"}}}
-- !result
select flat_json_meta(c2) from test_json_cast_map [_META_];
-- result:
["nulls(TINYINT), 100.200.300(VARCHAR), remain(JSON)"]
-- !result
truncate table test_json_cast_map;
-- result:
-- !result
insert into test_json_cast_map values
(1, '{"level1": {"level2": {"level3": {"level4": {"5":"abc"}}}}}'),
(2, '{"level1": {"level2": {"level3": {"level4": {}}}}}'),
(3, '{"level1": {"level2": {"level3": {}}}}'),
(4, '{"level1": {"level2": {}}}'),
(5, '{"level1": {}}');
-- result:
-- !result
select * from test_json_cast_map order by c1;
-- result:
1	{"level1": {"level2": {"level3": {"level4": {"5": "abc"}}}}}
2	{"level1": {"level2": {"level3": {"level4": {}}}}}
3	{"level1": {"level2": {"level3": {}}}}
4	{"level1": {"level2": {}}}
5	{"level1": {}}
-- !result
select flat_json_meta(c2) from test_json_cast_map [_META_];
-- result:
[]
-- !result
truncate table test_json_cast_map;
-- result:
-- !result
insert into test_json_cast_map values
(1, '{"level1": {"level2": {"level3": {"level4": {"5":"abc"}}}}}'),
(5, '{"level1": {}}');
-- result:
-- !result
select * from test_json_cast_map order by c1;
-- result:
1	{"level1": {"level2": {"level3": {"level4": {"5": "abc"}}}}}
5	{"level1": {}}
-- !result
select flat_json_meta(c2) from test_json_cast_map [_META_];
-- result:
["nulls(TINYINT), level1.level2.level3.level4.5(VARCHAR), remain(JSON)"]
-- !result
truncate table test_json_cast_map;
-- result:
-- !result
insert into test_json_cast_map values
(1, '{"100": {}}'),
(9, '{"100": {"200": {"300": "abc"}}}');
-- result:
-- !result
select * from test_json_cast_map order by c1;
-- result:
1	{"100": {}}
9	{"100": {"200": {"300": "abc"}}}
-- !result
select flat_json_meta(c2) from test_json_cast_map [_META_];
-- result:
["nulls(TINYINT), 100.200.300(VARCHAR), remain(JSON)"]
-- !result
drop table test_json_cast_map;
-- result:
-- !result