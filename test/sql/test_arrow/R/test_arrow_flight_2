-- name: test_arrow_flight_2 @arrow_flight_sql

CREATE TABLE test (id INT, name STRING) ENGINE=OLAP PRIMARY KEY (id) DISTRIBUTED BY HASH(id) BUCKETS 1 PROPERTIES ('replication_num' = '1');
-- result:
-- !result

INSERT INTO test VALUES (1, 'Alice'), (2, 'Bob');
-- result:
-- !result

INSERT INTO test VALUES (1, 'Alice'), (2, 'Bob');
-- result:
-- !result

INSERT INTO test VALUES (3, 'Zac'), (4, 'Tom');
-- result:
-- !result

SELECT * FROM test order by id asc;
-- result:
1	Alice
2	Bob
3	Zac
4	Tom
-- !result

UPDATE test SET name = 'Charlie' WHERE id = 1;
-- result:
-- !result

SELECT * FROM test order by id asc;
-- result:
1	Charlie
2	Bob
3	Zac
4	Tom
-- !result

UPDATE test SET name = 'Charlie' WHERE id = 1;
-- result:
-- !result

SELECT * FROM test order by id asc;
-- result:
1	Charlie
2	Bob
3	Zac
4	Tom
-- !result

DELETE FROM test WHERE id = 2;
-- result:
-- !result

ALTER TABLE test ADD COLUMN age INT;
-- result:
-- !result
function: wait_alter_table_finish()
-- result:
None
-- !result

ALTER TABLE test MODIFY COLUMN name STRING;
-- result:
-- !result
function: wait_alter_table_finish()
-- result:
None
-- !result

INSERT INTO test (id, name, age) VALUES (5, 'Eve', 30);
-- result:
-- !result

SELECT * FROM test WHERE id = 5;
-- result:
5	Eve	30
-- !result

SELECT * FROM test order by id asc;
-- result:
1	Charlie	None
3	Zac	None
4	Tom	None
5	Eve	30
-- !result

SHOW CREATE TABLE test;
-- result:
-- !result

CREATE TABLE test2 (id INT, age INT) ENGINE=OLAP PRIMARY KEY (id) DISTRIBUTED BY HASH(id) BUCKETS 1 PROPERTIES ('replication_num' = '1');
-- result:
-- !result

INSERT INTO test2 VALUES (1, 18), (2, 20);
-- result:
-- !result

SELECT * FROM (SELECT id, name FROM test) AS sub WHERE id = 1;
-- result:
1	Charlie
-- !result
