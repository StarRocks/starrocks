-- name: test_spill_hash_join_set_finishing_failed @sequential
set enable_spill=true;
set spill_mode="force";
set pipeline_dop = 1;

create table t1(c1 int, c2 int) properties("replication_num"="1");
create table t2(c1 int, c2 int) properties("replication_num"="1");

insert into t1 select generate_series,generate_series from table(generate_series(0,2000));
insert into t2 select generate_series,generate_series from table(generate_series(0,2000));

admin enable failpoint 'spill_flush_set_invalid_status';

select sum(t1.c1), sum(t2.c2) from t1 join t2 on t1.c1=t2.c2;

admin disable failpoint 'spill_flush_set_invalid_status';