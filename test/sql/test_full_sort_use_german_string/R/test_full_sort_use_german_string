-- name: test_full_sort_use_german_string
DROP TABLE if exists t0;
-- result:
-- !result
CREATE TABLE if not exists t0
(
c0 VARCHAR(255) NOT NULL,
c1 VARCHAR(255) NOT NULL,
c2 VARCHAR(255) NOT NULL,
c3 VARCHAR(255) NOT NULL 
) ENGINE=OLAP
DUPLICATE KEY(`c0` )
COMMENT "OLAP"
DISTRIBUTED BY HASH(`c0` ) BUCKETS 1
PROPERTIES(
"replication_num" = "1",
"in_memory" = "false",
"storage_format" = "default" 
);
-- result:
-- !result
insert into t0
select
concat("",i,"_abc") as c0,
concat("foo_", 100000 - i) as c1,
concat("bar_", ((50000 - i)/10)*((50000 - i)/10)) as c2,
concat("", ((50000 - i)/10)*((50000 - i)/10),"_bar") as c3
from table(generate_series(1,100000)) gs(i);
-- result:
-- !result
with cte as(select c0, count(1) over(partition by c0) as cnt from t0) 
select /*+SET_VAR(enable_full_sort_use_german_string=true)*/sum(murmur_hash3_32(c0, cnt)) as fingerprint from cte;
-- result:
380598722181
-- !result
with cte as(select c0, count(1) over(partition by c0) as cnt from t0) 
select /*+SET_VAR(enable_full_sort_use_german_string=false)*/sum(murmur_hash3_32(c0, cnt)) as fingerprint from cte;
-- result:
380598722181
-- !result
with cte as(select c0,c1, count(1) over(partition by c0,c1) as cnt from t0) 
select /*+SET_VAR(enable_full_sort_use_german_string=true)*/sum(murmur_hash3_32(c0,c1, cnt)) as fingerprint from cte;
-- result:
188259655263
-- !result
with cte as(select c0,c1, count(1) over(partition by c0,c1) as cnt from t0) 
select /*+SET_VAR(enable_full_sort_use_german_string=false)*/sum(murmur_hash3_32(c0,c1, cnt)) as fingerprint from cte;
-- result:
188259655263
-- !result
with cte as(select c0,c1,c2, count(1) over(partition by c0,c1,c2) as cnt from t0) 
select /*+SET_VAR(enable_full_sort_use_german_string=true)*/sum(murmur_hash3_32(c0,c1,c2, cnt)) as fingerprint from cte;
-- result:
-418370384866
-- !result
with cte as(select c0,c1,c2, count(1) over(partition by c0,c1,c2) as cnt from t0) 
select /*+SET_VAR(enable_full_sort_use_german_string=false)*/sum(murmur_hash3_32(c0,c1,c2, cnt)) as fingerprint from cte;
-- result:
-418370384866
-- !result
