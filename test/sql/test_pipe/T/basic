-- name: test_pipe_basic
show pipes;

-- show pipes
create database db_${uuid0};
create database db_${uuid1};
use db_${uuid0};
show pipes;
show pipes from db_${uuid1};

-- create/alter/show/drop/desc
set enable_pipe_validate = false;
create table t1 (id int) duplicate key(id) properties('replication_num' = '1');
create pipe p1 as insert into t1 select * from t1;
show pipes;
desc pipe;
alter pipe p1 pause;
show pipes;
alter pipe p1 resume;
show pipes;
use db_${uuid1};
show pipes from db_${uuid0};
use db_${uuid0};
drop pipe p1;
show pipes;

-- drop database
drop database db_${uuid0};
create database db_${uuid0};
use db_${uuid0};
show pipes;

-- create error
set enable_pipe_validate = true;
create table t1 (id int) duplicate key(id) properties('replication_num' = '1');
create pipe p1 as insert into t1 select * from t1;
create pipe if not exists p1 as insert into t1 select * from t1;
create pipe p1 as insert into t1 select * from t1;
create pipe p2 as select * from t1;
create pipe p+1 as select * from t1;
create pipe p3 as insert into t2 select * from t1;

-- alter error
set enable_pipe_validate = false;
create pipe p1 as insert into t1 select * from t1;
alter pipe p1 pause;
alter pipe p1 pause;
show pipes;
alter pipe p1 resume;
alter pipe p1 resume;
show pipes;

-- drop error
drop pipe if exists p1;
drop pipe if exists p1;
drop pipe p2;
drop pipe if exists p2;