-- name: test_dict_in_struct
CREATE TABLE T (
    id INT,
    value VARCHAR(10),
    arr ARRAY<VARCHAR(10)>
) DUPLICATE KEY(id)
DISTRIBUTED BY HASH(id) BUCKETS 3
PROPERTIES('replication_num' = '1');
-- result:
-- !result
CREATE TABLE T2 LIKE T;
-- result:
-- !result
INSERT INTO T VALUES (1, 'a', ['aa', 'aaa']), (2, 'b', ['bb', 'bbb']), (3, 'c', ['cc', 'ccc']);
-- result:
-- !result
[UC]analyze FULL TABLE T;
-- result:
test_db_92a9f77a305646ae9452d68158a103b4.T	analyze	status	OK
-- !result
function: wait_global_dict_ready('value', 'T')
-- result:

-- !result
function: wait_global_dict_ready('arr', 'T')
-- result:

-- !result
SELECT LOWER(STRUCT(value, arr).col1) AS r1, UPPER(STRUCT(value, arr).col2[1]) AS r2 FROM T ORDER BY id;
-- result:
a	AA
b	BB
c	CC
-- !result
SELECT STRUCT(value, arr, id) r1, NAMED_STRUCT('value', value, 'arr', arr, 'id', id) FROM T ORDER BY id;
-- result:
{"col1":"a","col2":["aa","aaa"],"col3":1}	{"value":"a","arr":["aa","aaa"],"id":1}
{"col1":"b","col2":["bb","bbb"],"col3":2}	{"value":"b","arr":["bb","bbb"],"id":2}
{"col1":"c","col2":["cc","ccc"],"col3":3}	{"value":"c","arr":["cc","ccc"],"id":3}
-- !result
SELECT ANY_VALUE(STRUCT(id, value, arr)) r FROM (SELECT id, value, arr FROM T ORDER BY id LIMIT 1) sub_query;
-- result:
{"col1":1,"col2":"a","col3":["aa","aaa"]}
-- !result
WITH T2 AS (SELECT ANY_VALUE(STRUCT(value, arr)) A FROM (SELECT * FROM T ORDER BY id DESC LIMIT 1) subquery) SELECT LOWER(A.col1), ARRAY_LENGTH(A.col2), UPPER(A.col2[1]) FROM T2;
-- result:
c	2	CC
-- !result
SELECT UPPER(STRUCT(value, LOWER(value)).col1) FROM T ORDER BY id;
-- result:
A
B
C
-- !result
SELECT UPPER(STRUCT(value, STRUCT(value)).col1) FROM T ORDER BY id;
-- result:
A
B
C
-- !result