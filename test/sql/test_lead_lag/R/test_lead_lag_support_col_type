-- name: test_lead_lag_support_col_type
CREATE TABLE test_col_value (
    col_1 INT,
    col_2 INT,
    col_3 INT NOT NULL
) PROPERTIES (
    "compression"        = "LZ4",
    "replicated_storage" = "true",
    "replication_num"    = "1"
);
-- result:
-- !result
INSERT INTO test_col_value (col_1, col_2, col_3) VALUES (1, 1, 11), (2, 2, 22), (3, 3, 33), (4, NULL, 44), (5, 5, 55), (6, 6, 66);
-- result:
-- !result
SELECT col_1, col_2 , LAG(col_2, 2, col_3) OVER (ORDER BY col_1) AS lag_result FROM test_col_value;
-- result:
1	1	11
2	2	22
3	3	1
4	None	2
5	5	3
6	6	None
-- !result
SELECT col_1, col_2 , LEAD(col_2, 2, col_3) OVER (ORDER BY col_1) AS lag_result FROM test_col_value;
-- result:
1	1	3
2	2	None
3	3	5
4	None	6
5	5	55
6	6	66
-- !result
SELECT col_1, col_2 , LAG(col_2, 2, col_3 * 2 + 99) OVER (ORDER BY col_1) AS lag_result FROM test_col_value;
-- result:
E: (1064, 'Getting analyzing error. Detail message: The type of the third parameter of LEAD/LAG not match the type INT.')
-- !result
SELECT col_1, col_2 , LEAD(col_2, 2, col_3 * 2 + 99) OVER (ORDER BY col_1) AS lag_result FROM test_col_value;
-- result:
E: (1064, 'Getting analyzing error. Detail message: The type of the third parameter of LEAD/LAG not match the type INT.')
-- !result
SELECT col_1, col_2 , LAG(col_2 IGNORE NULLS, 2, col_3) OVER (ORDER BY col_1) AS lag_result FROM test_col_value;
-- result:
1	1	11
2	2	22
3	3	1
4	None	2
5	5	2
6	6	3
-- !result
SELECT col_1, col_2 , LEAD(col_2 IGNORE NULLS, 2, col_3) OVER (ORDER BY col_1) AS lag_result FROM test_col_value;
-- result:
1	1	3
2	2	5
3	3	6
4	None	6
5	5	55
6	6	66
-- !result
CREATE TABLE test_col_value2 (
    col_1 INT,
    col_2 INT,
    col_3 VARCHAR(255) NOT NULL
) PROPERTIES (
    "compression"        = "LZ4",
    "replicated_storage" = "true",
    "replication_num"    = "1"
);
-- result:
-- !result
INSERT INTO test_col_value2 (col_1, col_2, col_3) VALUES (1, 1, '11'), (2, 2, '22'), (3, 3, '33'), (4, NULL, '44'), (5, 5, '55'), (6, 6, '66'), (7, 7, '7djaiojdoa'), (8, NULL, '8djaiojdoa'), (9, 9, '0djagdfoi');
-- result:
-- !result
SELECT col_1, col_2 , LAG(col_2, 2, col_3) OVER (ORDER BY col_1) AS lag_result FROM test_col_value2;
-- result:
E: (1064, 'Getting analyzing error. Detail message: The type of the third parameter of LEAD/LAG not match the type INT.')
-- !result
SELECT col_1, col_2 , LEAD(col_2, 2, col_3) OVER (ORDER BY col_1) AS lag_result FROM test_col_value2;
-- result:
E: (1064, 'Getting analyzing error. Detail message: The type of the third parameter of LEAD/LAG not match the type INT.')
-- !result
SELECT col_1, col_2 , LAG(col_2 IGNORE NULLS, 2, col_3) OVER (ORDER BY col_1) AS lag_result FROM test_col_value2;
-- result:
E: (1064, 'Getting analyzing error. Detail message: The type of the third parameter of LEAD/LAG not match the type INT.')
-- !result
SELECT col_1, col_2 , LEAD(col_2 IGNORE NULLS, 2, col_3) OVER (ORDER BY col_1) AS lag_result FROM test_col_value2;
-- result:
E: (1064, 'Getting analyzing error. Detail message: The type of the third parameter of LEAD/LAG not match the type INT.')
-- !result
CREATE TABLE test_array_value (
    col_1 INT,
    arr1 ARRAY<INT>,
    arr2 ARRAY<INT> NOT NULL
) PROPERTIES (
    "compression"        = "LZ4",
    "replicated_storage" = "true",
    "replication_num"    = "1"
);
-- result:
-- !result
INSERT INTO test_array_value (col_1, arr1, arr2) VALUES
    (1, [1, 11], [101, 111]),
    (2, [2, 22], [102, 112]),
    (3, [3, 33], [103, 113]),
    (4, NULL,    [104, 114]),
    (5, [5, 55], [105, 115]),
    (6, [6, 66], [106, 116]);
-- result:
-- !result
SELECT col_1, arr1, LAG(arr1, 2, arr2) OVER (ORDER BY col_1) AS lag_result FROM test_array_value;
-- result:
E: (1064, "class com.starrocks.type.ArrayType cannot be cast to class com.starrocks.type.ScalarType (com.starrocks.type.ArrayType and com.starrocks.type.ScalarType are in unnamed module of loader 'app')")
-- !result
SELECT col_1, arr1, LEAD(arr1, 2, arr2) OVER (ORDER BY col_1) AS lead_result FROM test_array_value;
-- result:
E: (1064, "class com.starrocks.type.ArrayType cannot be cast to class com.starrocks.type.ScalarType (com.starrocks.type.ArrayType and com.starrocks.type.ScalarType are in unnamed module of loader 'app')")
-- !result
SET array_low_cardinality_optimize = true;
-- result:
-- !result
CREATE TABLE test_varchar_value (
    col_1 INT,
    v1 VARCHAR(255),
    v2 VARCHAR(255) NOT NULL
) PROPERTIES (
    "compression"        = "LZ4",
    "replicated_storage" = "true",
    "replication_num"    = "1"
);
-- result:
-- !result
INSERT INTO test_varchar_value (col_1, v1, v2) VALUES
    (1, '1',  '11'),
    (2, '2',  '22'),
    (3, '3',  '33'),
    (4, NULL, '44'),
    (5, '5',  '55'),
    (6, '6',  '66');
-- result:
-- !result
SELECT  col_1, v1, LAG(v1, 2, v2)  OVER (ORDER BY col_1) AS lag_result  FROM test_varchar_value;
-- result:
1	1	11
2	2	22
3	3	1
4	None	2
5	5	3
6	6	None
-- !result
SELECT  col_1, v1, LEAD(v1, 2, v2) OVER (ORDER BY col_1) AS lead_result FROM test_varchar_value;
-- result:
1	1	3
2	2	None
3	3	5
4	None	6
5	5	55
6	6	66
-- !result
SET array_low_cardinality_optimize = true;
-- result:
-- !result
CREATE TABLE test_array_varchar_value (
    col_1 INT,
    arr1 ARRAY<VARCHAR(10)>,
    arr2 ARRAY<VARCHAR(10)> NOT NULL
) PROPERTIES (
    "compression"        = "LZ4",
    "replicated_storage" = "true",
    "replication_num"    = "1"
);
-- result:
-- !result
INSERT INTO test_array_varchar_value (col_1, arr1, arr2) VALUES
    (1, ['1','11'], ['101','111']),
    (2, ['2','22'], ['102','112']),
    (3, ['3','33'], ['103','113']),
    (4, NULL,       ['104','114']),
    (5, ['5','55'], ['105','115']),
    (6, ['6','66'], ['106','116']);
-- result:
-- !result
SELECT  col_1, arr1, LAG(arr1, 2, arr2)  OVER (ORDER BY col_1) AS lag_result  FROM test_array_varchar_value;
-- result:
E: (1064, "class com.starrocks.type.ArrayType cannot be cast to class com.starrocks.type.ScalarType (com.starrocks.type.ArrayType and com.starrocks.type.ScalarType are in unnamed module of loader 'app')")
-- !result
SELECT  col_1, arr1, LEAD(arr1, 2, arr2) OVER (ORDER BY col_1) AS lead_result FROM test_array_varchar_value;
-- result:
E: (1064, "class com.starrocks.type.ArrayType cannot be cast to class com.starrocks.type.ScalarType (com.starrocks.type.ArrayType and com.starrocks.type.ScalarType are in unnamed module of loader 'app')")
-- !result