-- name: test_default_enable_mv @native
create database test_default_enable_mv;
-- result:
-- !result
use test_default_enable_mv;
-- result:
-- !result
admin set frontend config('enable_replicated_storage_as_default_engine'='true');
-- result:
-- !result
create table t1(k int, v int not null) distributed by hash(k);
-- result:
-- !result
create materialized view tvd distributed by hash(k) buckets 10 
PROPERTIES (
    "replication_num" = "1"
)
REFRESH ASYNC as select k, sum(v) from t1 group by k;
-- result:
-- !result
show create materialized view tvd;
-- result:
tvd	CREATE MATERIALIZED VIEW `tvd` (`k`, `sum(v)`)
DISTRIBUTED BY HASH(`k`) BUCKETS 10 
REFRESH ASYNC
PROPERTIES (
"replicated_storage" = "true",
"replication_num" = "1",
"storage_medium" = "HDD"
)
AS select k, sum(v) from t1 group by k;
-- !result
admin set frontend config('enable_replicated_storage_as_default_engine'='false');
-- result:
-- !result
create materialized view tvb distributed by hash(k) buckets 10 
PROPERTIES (
    "replication_num" = "1"
)
REFRESH ASYNC as select k, sum(v) from t1 group by k;
-- result:
-- !result
show create materialized view tvb;
-- result:
tvb	CREATE MATERIALIZED VIEW `tvb` (`k`, `sum(v)`)
DISTRIBUTED BY HASH(`k`) BUCKETS 10 
REFRESH ASYNC
PROPERTIES (
"replicated_storage" = "false",
"replication_num" = "1",
"storage_medium" = "HDD"
)
AS select k, sum(v) from t1 group by k;
-- !result
admin set frontend config('enable_replicated_storage_as_default_engine'='true');
-- result:
-- !result