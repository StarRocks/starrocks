-- name: testArrayAgg
CREATE TABLE `ss` (
  `id` int(11) NULL COMMENT "",
  `name` varchar(255) NULL COMMENT "",
  `subject` varchar(255) NULL COMMENT "",
  `score` int(11) NULL COMMENT ""
) ENGINE=OLAP
DUPLICATE KEY(`id`)
DISTRIBUTED BY HASH(`id`) BUCKETS 4
PROPERTIES (
"replication_num" = "1",
"in_memory" = "false",
"enable_persistent_index" = "false",
"replicated_storage" = "true",
"compression" = "LZ4"
);

insert into ss values (1,"Tom","English",90);
insert into ss values (1,"Tom","Math",80);
insert into ss values (2,"Tom","English",NULL);
insert into ss values (2,"Tom",NULL,NULL);
insert into ss values (3,"May",NULL,NULL);
insert into ss values (3,"Ti","English",98);
insert into ss values (4,NULL,NULL,NULL);
insert into ss values (NULL,NULL,NULL,NULL);
insert into ss values (NULL,"Ti","物理Phy",99);
insert into ss values (11,"张三此地无银三百两","英文English",98);
insert into ss values (11,"张三掩耳盗铃","Math数学欧拉方程",78);
insert into ss values (12,"李四大闹天空","英语外语美誉",NULL);
insert into ss values (2,"王武程咬金","语文北京上海",22);
insert into ss values (3,"Tom","数学大不列颠",NULL);

select max(id), array_agg(distinct name), count(distinct id), array_agg(name) from ss where id < 2  order by 1;
select max(id), array_agg(distinct name) from ss where id < 2  order by 1;
select max(id), array_agg(distinct name), array_agg(distinct score order by 1) from ss where id < 2 order by 1;
select max(id),array_agg(distinct name), count(distinct id), array_agg(name) from ss where id < 2  order by 1;
select max(id),array_agg(distinct name) from ss where id < 2  order by 1;
select max(id),array_agg(name), array_agg(name,score order by 1,2) from ss where id < 2  order by 1;
select max(id),array_agg(name), array_agg(distinct name) from ss where id < 2 order by 1;
select max(id),array_agg(distinct name), array_agg(distinct score order by 1) from ss where id < 2 order by 1;

select id, array_agg(distinct name), count(distinct score), array_agg(name) from ss where id < 2 group by id order by 1;
select id, array_agg(distinct name) from ss where id < 2 group by id order by id;
select id, array_agg(name), array_agg(name,score order by 1,2) from ss where id < 2 group by id order by 1;
select id, array_agg(name), array_agg(distinct name) from ss where id < 2 group by id order by 1;
select id, array_agg(distinct name), array_agg(distinct score order by 1) from ss where id < 2 group by id order by 1;
select score, array_agg(distinct name), count(distinct id), array_agg(name) from ss where id < 2 group by score order by 1;
select score, array_agg(distinct name) from ss where id < 2 group by score order by score;
select score, array_agg(name), array_agg(name,score order by 1,2) from ss where id < 2 group by score order by 1;
select score, array_agg(name), array_agg(distinct name) from ss where id < 2 group by score order by 1;
select score, array_agg(distinct name), array_agg(distinct score order by 1) from ss where id < 2 group by score order by 1;


select array_agg(distinct name order by 1, score), count(distinct id), array_agg(name order by 1) from ss group by id order by id;
select array_agg(distinct subject order by 1, name) from ss group by id order by id;
select array_agg(name order by 1), array_agg(distinct name order by 1, score) from ss group by id order by id;
select array_agg(distinct name order by 1,score), array_agg(distinct score order by 1) from ss group by id order by id;
select array_agg(distinct name order by 1) from ss group by id order by id;
select array_agg(distinct name order by score, 1), count(distinct id), max(score)  from ss group by id order by id;
select array_agg(distinct null order by score,1,4.00),array_agg(null order by score,1,4.00 ) from ss group by id order by id;
select array_agg(distinct subject order by 1, null) from ss group by id order by id;
select array_agg(distinct score order by score,4.00),array_agg(subject order by score,4.00, 1),array_agg(subject order by score,4.00, 1)  from ss group by id order by id;
select array_agg(distinct score order by 1) from ss group by id order by id;
select array_agg(distinct score order by 1,name) from ss group by id order by id;
select array_agg(distinct 1 order by 1) from ss group by id order by id;
select array_agg(distinct 12 order by score) from ss group by id order by id;
select array_agg(distinct subject order by 1) from ss group by id order by id;
select group_concat( name,subject order by 1,2), array_agg(distinct id), max(score) from ss group by id order by id;
select array_agg( name order by 1,score), count(distinct id), max(score)  from ss group by id order by id;
select array_agg( subject order by score,1), count(distinct id), max(score)  from ss group by id order by id;
select array_agg(name order by score,4,1), count(distinct id), max(score)  from ss group by id order by id;
select array_agg(subject order by score,4.00), count(distinct id), max(score)  from ss group by id order by id;
select array_agg( name order by score,4.00),array_agg(distinct name order by score,4.00) from ss group by id order by id;
select array_agg( null order by score,4.00) from ss group by id order by id;
select array_agg( score order by 1) from ss group by id order by id;
select array_agg( score order by 1,name) from ss group by id order by id;
select array_agg(distinct 1 order by 1) from ss group by id order by id;


select array_agg(distinct name order by 1, score), count(distinct id), array_agg(name order by 1) from ss;
select array_agg(distinct subject order by 1, name) from ss;
select array_agg(name order by 1), array_agg(distinct name order by 1, score) from ss;
select array_agg(distinct name order by 1,score), array_agg(distinct score order by 1) from ss;
select array_agg(distinct name order by 1) from ss ;
select array_agg(distinct name order by score, 1), count(distinct id), max(score)  from ss ;
select array_agg(distinct null order by score,1,4.00),array_agg(null order by score,1,4.00 ) from ss;
select array_agg(distinct subject order by 1, null) from ss ;
select array_agg(distinct score order by score,4.00),array_agg(subject order by score,4.00, 1),array_agg(subject order by score,4.00, 1)  from ss ;
select array_agg(distinct score order by 1) from ss ;
select array_agg(distinct score order by 1,name) from ss ;
select array_agg(distinct 1 order by 1) from ss ;
select array_agg(distinct 12 order by score) from ss ;
select array_agg(distinct subject order by 1) from ss;
select group_concat(name,subject order by 1,2), avg(distinct id), max(score) from ss;
select array_agg( name order by 1,score), count(distinct id), max(score)  from ss;
select array_agg( subject order by score,1), count(distinct id), max(score)  from ss;
select array_agg(name order by score,4,1), count(distinct id), max(score)  from ss ;
select array_agg(subject order by score,4.00, 1), count(distinct id), max(score)  from ss ;
select array_agg( name order by score,4.00,1),array_agg(distinct name order by score,4.00, 1) from ss ;
select array_agg( null order by score,4.00) from ss;
select array_agg(distinct null order by score,4.00) from ss;
select array_agg( score order by 1) from ss;
select array_agg( score order by 1,name) from ss;
select array_agg(distinct 1 order by 1) from ss

set new_planner_agg_stage = 2;
select max(id), array_agg(distinct name), count(distinct id), array_agg(name) from ss where id < 2  order by 1;
select max(id), array_agg(distinct name) from ss where id < 2  order by 1;
select max(id), array_agg(distinct name), array_agg(distinct score order by 1) from ss where id < 2 order by 1;
select max(id),array_agg(distinct name), count(distinct id), array_agg(name) from ss where id < 2  order by 1;
select max(id),array_agg(distinct name) from ss where id < 2  order by 1;
select max(id),array_agg(name), array_agg(name,score order by 1,2) from ss where id < 2  order by 1;
select max(id),array_agg(name), array_agg(distinct name) from ss where id < 2 order by 1;
select max(id),array_agg(distinct name), array_agg(distinct score order by 1) from ss where id < 2 order by 1;

select id, array_agg(distinct name), count(distinct score), array_agg(name) from ss where id < 2 group by id order by 1;
select id, array_agg(distinct name) from ss where id < 2 group by id order by id;
select id, array_agg(name), array_agg(name,score order by 1,2) from ss where id < 2 group by id order by 1;
select id, array_agg(name), array_agg(distinct name) from ss where id < 2 group by id order by 1;
select id, array_agg(distinct name), array_agg(distinct score order by 1) from ss where id < 2 group by id order by 1;
select score, array_agg(distinct name), count(distinct id), array_agg(name) from ss where id < 2 group by score order by 1;
select score, array_agg(distinct name) from ss where id < 2 group by score order by score;
select score, array_agg(name), array_agg(name,score order by 1,2) from ss where id < 2 group by score order by 1;
select score, array_agg(name), array_agg(distinct name) from ss where id < 2 group by score order by 1;
select score, array_agg(distinct name), array_agg(distinct score order by 1) from ss where id < 2 group by score order by 1;


select array_agg(distinct name order by 1, score), count(distinct id), array_agg(name order by 1) from ss group by id order by id;
select array_agg(distinct subject order by 1, name) from ss group by id order by id;
select array_agg(name order by 1), array_agg(distinct name order by 1, score) from ss group by id order by id;
select array_agg(distinct name order by 1,score), array_agg(distinct score order by 1) from ss group by id order by id;
select array_agg(distinct name order by 1) from ss group by id order by id;
select array_agg(distinct name order by score, 1), count(distinct id), max(score)  from ss group by id order by id;
select array_agg(distinct null order by score,1,4.00),array_agg(null order by score,1,4.00 ) from ss group by id order by id;
select array_agg(distinct subject order by 1, null) from ss group by id order by id;
select array_agg(distinct score order by score,4.00),array_agg(subject order by score,4.00, 1),array_agg(subject order by score,4.00, 1)  from ss group by id order by id;
select array_agg(distinct score order by 1) from ss group by id order by id;
select array_agg(distinct score order by 1,name) from ss group by id order by id;
select array_agg(distinct 1 order by 1) from ss group by id order by id;
select array_agg(distinct 12 order by score) from ss group by id order by id;
select array_agg(distinct subject order by 1) from ss group by id order by id;
select group_concat( name,subject order by 1,2), array_agg(distinct id), max(score) from ss group by id order by id;
select array_agg( name order by 1,score), count(distinct id), max(score)  from ss group by id order by id;
select array_agg( subject order by score,1), count(distinct id), max(score)  from ss group by id order by id;
select array_agg(name order by score,4,1), count(distinct id), max(score)  from ss group by id order by id;
select array_agg(subject order by score,4.00), count(distinct id), max(score)  from ss group by id order by id;
select array_agg( name order by score,4.00),array_agg(distinct name order by score,4.00) from ss group by id order by id;
select array_agg( null order by score,4.00) from ss group by id order by id;
select array_agg( score order by 1) from ss group by id order by id;
select array_agg( score order by 1,name) from ss group by id order by id;
select array_agg(distinct 1 order by 1) from ss group by id order by id;


select array_agg(distinct name order by 1, score), count(distinct id), array_agg(name order by 1) from ss;
select array_agg(distinct subject order by 1, name) from ss;
select array_agg(name order by 1), array_agg(distinct name order by 1, score) from ss;
select array_agg(distinct name order by 1,score), array_agg(distinct score order by 1) from ss;
select array_agg(distinct name order by 1) from ss ;
select array_agg(distinct name order by score, 1), count(distinct id), max(score)  from ss ;
select array_agg(distinct null order by score,1,4.00),array_agg(null order by score,1,4.00 ) from ss;
select array_agg(distinct subject order by 1, null) from ss ;
select array_agg(distinct score order by score,4.00),array_agg(subject order by score,4.00, 1),array_agg(subject order by score,4.00, 1)  from ss ;
select array_agg(distinct score order by 1) from ss ;
select array_agg(distinct score order by 1,name) from ss ;
select array_agg(distinct 1 order by 1) from ss ;
select array_agg(distinct 12 order by score) from ss ;
select array_agg(distinct subject order by 1) from ss;
select group_concat(name,subject order by 1,2), avg(distinct id), max(score) from ss;
select array_agg( name order by 1,score), count(distinct id), max(score)  from ss;
select array_agg( subject order by score,1), count(distinct id), max(score)  from ss;
select array_agg(name order by score,4,1), count(distinct id), max(score)  from ss ;
select array_agg(subject order by score,4.00, 1), count(distinct id), max(score)  from ss ;
select array_agg( name order by score,4.00,1),array_agg(distinct name order by score,4.00, 1) from ss ;
select array_agg( null order by score,4.00) from ss;
select array_agg(distinct null order by score,4.00) from ss;
select array_agg( score order by 1) from ss;
select array_agg( score order by 1,name) from ss;
select array_agg(distinct 1 order by 1) from ss
set new_planner_agg_stage = 0;

set enable_exchange_pass_through = false;
select max(id), array_agg(distinct name), count(distinct id), array_agg(name) from ss where id < 2  order by 1;
select max(id), array_agg(distinct name) from ss where id < 2  order by 1;
select max(id), array_agg(distinct name), array_agg(distinct score order by 1) from ss where id < 2 order by 1;
select max(id),array_agg(distinct name), count(distinct id), array_agg(name) from ss where id < 2  order by 1;
select max(id),array_agg(distinct name) from ss where id < 2  order by 1;
select max(id),array_agg(name), array_agg(name,score order by 1,2) from ss where id < 2  order by 1;
select max(id),array_agg(name), array_agg(distinct name) from ss where id < 2 order by 1;
select max(id),array_agg(distinct name), array_agg(distinct score order by 1) from ss where id < 2 order by 1;

select id, array_agg(distinct name), count(distinct score), array_agg(name) from ss where id < 2 group by id order by 1;
select id, array_agg(distinct name) from ss where id < 2 group by id order by id;
select id, array_agg(name), array_agg(name,score order by 1,2) from ss where id < 2 group by id order by 1;
select id, array_agg(name), array_agg(distinct name) from ss where id < 2 group by id order by 1;
select id, array_agg(distinct name), array_agg(distinct score order by 1) from ss where id < 2 group by id order by 1;
select score, array_agg(distinct name), count(distinct id), array_agg(name) from ss where id < 2 group by score order by 1;
select score, array_agg(distinct name) from ss where id < 2 group by score order by score;
select score, array_agg(name), array_agg(name,score order by 1,2) from ss where id < 2 group by score order by 1;
select score, array_agg(name), array_agg(distinct name) from ss where id < 2 group by score order by 1;
select score, array_agg(distinct name), array_agg(distinct score order by 1) from ss where id < 2 group by score order by 1;


select array_agg(distinct name order by 1, score), count(distinct id), array_agg(name order by 1) from ss group by id order by id;
select array_agg(distinct subject order by 1, name) from ss group by id order by id;
select array_agg(name order by 1), array_agg(distinct name order by 1, score) from ss group by id order by id;
select array_agg(distinct name order by 1,score), array_agg(distinct score order by 1) from ss group by id order by id;
select array_agg(distinct name order by 1) from ss group by id order by id;
select array_agg(distinct name order by score, 1), count(distinct id), max(score)  from ss group by id order by id;
select array_agg(distinct null order by score,1,4.00),array_agg(null order by score,1,4.00 ) from ss group by id order by id;
select array_agg(distinct subject order by 1, null) from ss group by id order by id;
select array_agg(distinct score order by score,4.00),array_agg(subject order by score,4.00, 1),array_agg(subject order by score,4.00, 1)  from ss group by id order by id;
select array_agg(distinct score order by 1) from ss group by id order by id;
select array_agg(distinct score order by 1,name) from ss group by id order by id;
select array_agg(distinct 1 order by 1) from ss group by id order by id;
select array_agg(distinct 12 order by score) from ss group by id order by id;
select array_agg(distinct subject order by 1) from ss group by id order by id;
select group_concat( name,subject order by 1,2), array_agg(distinct id), max(score) from ss group by id order by id;
select array_agg( name order by 1,score), count(distinct id), max(score)  from ss group by id order by id;
select array_agg( subject order by score,1), count(distinct id), max(score)  from ss group by id order by id;
select array_agg(name order by score,4,1), count(distinct id), max(score)  from ss group by id order by id;
select array_agg(subject order by score,4.00), count(distinct id), max(score)  from ss group by id order by id;
select array_agg( name order by score,4.00),array_agg(distinct name order by score,4.00) from ss group by id order by id;
select array_agg( null order by score,4.00) from ss group by id order by id;
select array_agg( score order by 1) from ss group by id order by id;
select array_agg( score order by 1,name) from ss group by id order by id;
select array_agg(distinct 1 order by 1) from ss group by id order by id;


select array_agg(distinct name order by 1, score), count(distinct id), array_agg(name order by 1) from ss;
select array_agg(distinct subject order by 1, name) from ss;
select array_agg(name order by 1), array_agg(distinct name order by 1, score) from ss;
select array_agg(distinct name order by 1,score), array_agg(distinct score order by 1) from ss;
select array_agg(distinct name order by 1) from ss ;
select array_agg(distinct name order by score, 1), count(distinct id), max(score)  from ss ;
select array_agg(distinct null order by score,1,4.00),array_agg(null order by score,1,4.00 ) from ss;
select array_agg(distinct subject order by 1, null) from ss ;
select array_agg(distinct score order by score,4.00),array_agg(subject order by score,4.00, 1),array_agg(subject order by score,4.00, 1)  from ss ;
select array_agg(distinct score order by 1) from ss ;
select array_agg(distinct score order by 1,name) from ss ;
select array_agg(distinct 1 order by 1) from ss ;
select array_agg(distinct 12 order by score) from ss ;
select array_agg(distinct subject order by 1) from ss;
select group_concat(name,subject order by 1,2), avg(distinct id), max(score) from ss;
select array_agg( name order by 1,score), count(distinct id), max(score)  from ss;
select array_agg( subject order by score,1), count(distinct id), max(score)  from ss;
select array_agg(name order by score,4,1), count(distinct id), max(score)  from ss ;
select array_agg(subject order by score,4.00, 1), count(distinct id), max(score)  from ss ;
select array_agg( name order by score,4.00,1),array_agg(distinct name order by score,4.00, 1) from ss ;
select array_agg( null order by score,4.00) from ss;
select array_agg(distinct null order by score,4.00) from ss;
select array_agg( score order by 1) from ss;
select array_agg( score order by 1,name) from ss;
select array_agg(distinct 1 order by 1) from ss

set enable_query_cache = true;
select id, array_agg(distinct name), count(distinct score), array_agg(name) from ss where id < 2 group by id order by 1;
select id, array_agg(distinct name) from ss where id < 2 group by id order by id;
select id, array_agg(name), array_agg(name,score order by 1,2) from ss where id < 2 group by id order by 1;
select id, array_agg(name), array_agg(distinct name) from ss where id < 2 group by id order by 1;
select id, array_agg(distinct name), array_agg(distinct score order by 1) from ss where id < 2 group by id order by 1;
select score, array_agg(distinct name), count(distinct id), array_agg(name) from ss where id < 2 group by score order by 1;
select score, array_agg(distinct name) from ss where id < 2 group by score order by score;
select score, array_agg(name), array_agg(name,score order by 1,2) from ss where id < 2 group by score order by 1;
select score, array_agg(name), array_agg(distinct name) from ss where id < 2 group by score order by 1;
select score, array_agg(distinct name), array_agg(distinct score order by 1) from ss where id < 2 group by score order by 1;


select array_agg(distinct name order by 1, score), count(distinct id), array_agg(name order by 1) from ss group by id order by id;
select array_agg(distinct subject order by 1, name) from ss group by id order by id;
select array_agg(name order by 1), array_agg(distinct name order by 1, score) from ss group by id order by id;
select array_agg(distinct name order by 1,score), array_agg(distinct score order by 1) from ss group by id order by id;
select array_agg(distinct name order by 1) from ss group by id order by id;

select array_agg(distinct name order by 1, score), count(distinct id), array_agg(name order by 1) from ss;
select array_agg(distinct subject order by 1, name) from ss;
select array_agg(name order by 1), array_agg(distinct name order by 1, score) from ss;
select array_agg(distinct name order by 1,score), array_agg(distinct score order by 1) from ss;
select array_agg(distinct name order by 1) from ss ;
select array_agg(distinct name order by score, 1), count(distinct id), max(score)  from ss ;
select array_agg(distinct null order by score,1,4.00),array_agg(null order by score,1,4.00 ) from ss;

select array_agg();
select array_agg() from ss;
select array_agg(',');
select array_agg("中国" order by 1, id) from ss;
select array_agg("中国" order by 2, id separator NULL) from ss;
select array_agg("中国",name order by 2, "第一", id) from ss;
select array_agg(  order by score) from ss order by 1;
select array_agg(distinct  order by score) from ss order by 1;
select array_agg([1,2]) from ss;
select array_agg(json_object("2:3")) from ss;
select array_agg(distinct json_object("2:3")) from ss;
select array_agg(distinct [json_object("2:3")]) from ss;

select array_agg(map(2,3)) from ss;
select array_agg(distinct map(2,3)) from ss;

select array_agg(null);
select array_agg(order by 1 separator '');
select array_agg(separator NULL);
