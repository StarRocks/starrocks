-- name: test_decimal256_aggregate_function
DROP DATABASE IF EXISTS test_decimal256_agg_func;
-- result:
-- !result
CREATE DATABASE test_decimal256_agg_func;
-- result:
-- !result
USE test_decimal256_agg_func;
-- result:
-- !result
DROP TABLE IF EXISTS decimal256_agg_test;
-- result:
-- !result
CREATE TABLE decimal256_agg_test (
    id INT,
    category VARCHAR(10),
    p40s10 DECIMAL(40,10),    -- 30 integer digits + 10 decimal digits
    p50s15 DECIMAL(50,15),    -- 35 integer digits + 15 decimal digits
    p76s20 DECIMAL(76,20),    -- 56 integer digits + 20 decimal digits
    p76s0 DECIMAL(76,0)       -- 76 integer digits + 0 decimal digits
) properties("replication_num"="1");
-- result:
-- !result
INSERT INTO decimal256_agg_test VALUES
(1, 'A', 100.1234567890, 100.123456789012345, 100.12345678901234567890, 100),
(2, 'A', 100.1234567890, 100.123456789012345, 100.12345678901234567890, 100),
(3, 'A', 100.1234567890, 100.123456789012345, 100.12345678901234567890, 100),

(4, 'B', 200.5555555555, 200.555555555555555, 200.55555555555555555555, 200),
(5, 'B', 200.5555555555, 200.555555555555555, 200.55555555555555555555, 200),

(6, 'C', 0.0000000000, 0.000000000000000, 0.00000000000000000000, 0),
(7, 'C', 0.0000000000, 0.000000000000000, 0.00000000000000000000, 0),
(8, 'C', 0.0000000000, 0.000000000000000, 0.00000000000000000000, 0),

(9, 'D', -50.9876543210, -50.987654321098765, -50.98765432109876543210, -50),
(10, 'D', -50.9876543210, -50.987654321098765, -50.98765432109876543210, -50),

(11, 'E', 300.1111111111, 300.111111111111111, 300.11111111111111111111, 300),
(12, 'F', 400.2222222222, 400.222222222222222, 400.22222222222222222222, 400),
(13, 'G', 500.3333333333, 500.333333333333333, 500.33333333333333333333, 500),

(14, 'H', 999999999999999999999999999999.9999999999,
          99999999999999999999999999999999999.999999999999999,
          99999999999999999999999999999999999999999999999999999999.99999999999999999999,
          9999999999999999999999999999999999999999999999999999999999999999999999999999),
(15, 'H', 999999999999999999999999999999.9999999999,
          99999999999999999999999999999999999.999999999999999,
          99999999999999999999999999999999999999999999999999999999.99999999999999999999,
          9999999999999999999999999999999999999999999999999999999999999999999999999999),

(16, 'I', 0.0000000001, 0.000000000000001, 0.00000000000000000001, 1),
(17, 'I', 0.0000000001, 0.000000000000001, 0.00000000000000000001, 1),

(18, 'J', NULL, NULL, NULL, NULL),
(19, 'J', 600.4444444444, 600.444444444444444, 600.44444444444444444444, 600),

(20, 'K', 777.7777777777, 777.777777777777777, 777.77777777777777777777, 777),
(21, 'K', 777.7777777777, 888.888888888888888, 999.99999999999999999999, 777),
(22, 'K', 777.7777777777, 777.777777777777777, 777.77777777777777777777, 888);
-- result:
-- !result
SELECT 'Test1_COUNT_BASIC' as test_name, COUNT(*) as total_rows FROM decimal256_agg_test;
-- result:
Test1_COUNT_BASIC	22
-- !result
SELECT
    'Test1_COUNT_NON_NULL' as test_name,
    COUNT(p40s10) as count_p40s10,
    COUNT(p50s15) as count_p50s15,
    COUNT(p76s20) as count_p76s20,
    COUNT(p76s0) as count_p76s0
FROM decimal256_agg_test;
-- result:
Test1_COUNT_NON_NULL	21	21	21	21
-- !result
SELECT
    'Test2_SUM' as test_name,
    SUM(p40s10) as sum_p40s10,
    SUM(p50s15) as sum_p50s15,
    SUM(p76s20) as sum_p76s20,
    SUM(p76s0) as sum_p76s0
FROM decimal256_agg_test;
-- result:
Test2_SUM	2000000000000000000000000004733.9506172801	200000000000000000000000000000004845.061728391506167	200000000000000000000000000000000000000000000000000004956.17283950261728395023	20000000000000000000000000000000000000000000000000000000000000000000000004842
-- !result
SELECT
    'Test3_AVG' as test_name,
    AVG(p40s10) as avg_p40s10,
    AVG(p50s15) as avg_p50s15,
    AVG(p76s20) as avg_p76s20,
    AVG(p76s0) as avg_p76s0
FROM decimal256_agg_test;
-- result:
Test3_AVG	95238095238095238095238095463.521457965719	9523809523809523809523809523809754.526748971024103	9523809523809523809523809523809523809523809523809524045.53203997631510875953	2046222049275135930893159257071040935639933169755114893700828629548287.777822
-- !result
SELECT
    'Test4_MIN_MAX' as test_name,
    MIN(p40s10) as min_p40s10,
    MAX(p40s10) as max_p40s10,
    MIN(p50s15) as min_p50s15,
    MAX(p50s15) as max_p50s15,
    MIN(p76s20) as min_p76s20,
    MAX(p76s20) as max_p76s20,
    MIN(p76s0) as min_p76s0,
    MAX(p76s0) as max_p76s0
FROM decimal256_agg_test;
-- result:
Test4_MIN_MAX	-50.9876543210	999999999999999999999999999999.9999999999	-50.987654321098765	99999999999999999999999999999999999.999999999999999	-50.98765432109876543210	99999999999999999999999999999999999999999999999999999999.99999999999999999999	-50	9999999999999999999999999999999999999999999999999999999999999999999999999999
-- !result
SELECT
    'Test5_GROUP_BY_CATEGORY' as test_name,
    category,
    COUNT(*) as row_count,
    SUM(p40s10) as sum_p40s10,
    AVG(p40s10) as avg_p40s10,
    MIN(p50s15) as min_p50s15,
    MAX(p76s20) as max_p76s20
FROM decimal256_agg_test
GROUP BY category
ORDER BY category;
-- result:
Test5_GROUP_BY_CATEGORY	A	3	300.3703703670	100.123456789000	100.123456789012345	100.12345678901234567890
Test5_GROUP_BY_CATEGORY	B	2	401.1111111110	200.555555555500	200.555555555555555	200.55555555555555555555
Test5_GROUP_BY_CATEGORY	C	3	0E-10	0E-12	0E-15	0E-20
Test5_GROUP_BY_CATEGORY	D	2	-101.9753086420	-50.987654321000	-50.987654321098765	-50.98765432109876543210
Test5_GROUP_BY_CATEGORY	E	1	300.1111111111	300.111111111100	300.111111111111111	300.11111111111111111111
Test5_GROUP_BY_CATEGORY	F	1	400.2222222222	400.222222222200	400.222222222222222	400.22222222222222222222
Test5_GROUP_BY_CATEGORY	G	1	500.3333333333	500.333333333300	500.333333333333333	500.33333333333333333333
Test5_GROUP_BY_CATEGORY	H	2	1999999999999999999999999999999.9999999998	999999999999999999999999999999.999999999900	99999999999999999999999999999999999.999999999999999	99999999999999999999999999999999999999999999999999999999.99999999999999999999
Test5_GROUP_BY_CATEGORY	I	2	2E-10	1.00E-10	1E-15	1E-20
Test5_GROUP_BY_CATEGORY	J	2	600.4444444444	600.444444444400	600.444444444444444	600.44444444444444444444
Test5_GROUP_BY_CATEGORY	K	3	2333.3333333331	777.777777777700	777.777777777777777	999.99999999999999999999
-- !result
SELECT
    'Test6_GROUP_BY_P40S10' as test_name,
    p40s10,
    COUNT(*) as row_count,
    SUM(p50s15) as sum_p50s15,
    AVG(p50s15) as avg_p50s15,
    MIN(p76s0) as min_p76s0,
    MAX(p76s0) as max_p76s0
FROM decimal256_agg_test
WHERE p40s10 IS NOT NULL
GROUP BY p40s10
ORDER BY p40s10;
-- result:
Test6_GROUP_BY_P40S10	-50.9876543210	2	-101.975308642197530	-50.987654321098765	-50	-50
Test6_GROUP_BY_P40S10	0E-10	3	0E-15	0E-15	0	0
Test6_GROUP_BY_P40S10	1E-10	2	2E-15	1E-15	1	1
Test6_GROUP_BY_P40S10	100.1234567890	3	300.370370367037035	100.123456789012345	100	100
Test6_GROUP_BY_P40S10	200.5555555555	2	401.111111111111110	200.555555555555555	200	200
Test6_GROUP_BY_P40S10	300.1111111111	1	300.111111111111111	300.111111111111111	300	300
Test6_GROUP_BY_P40S10	400.2222222222	1	400.222222222222222	400.222222222222222	400	400
Test6_GROUP_BY_P40S10	500.3333333333	1	500.333333333333333	500.333333333333333	500	500
Test6_GROUP_BY_P40S10	600.4444444444	1	600.444444444444444	600.444444444444444	600	600
Test6_GROUP_BY_P40S10	777.7777777777	3	2444.444444444444442	814.814814814814814	777	888
Test6_GROUP_BY_P40S10	999999999999999999999999999999.9999999999	2	199999999999999999999999999999999999.999999999999998	99999999999999999999999999999999999.999999999999999	9999999999999999999999999999999999999999999999999999999999999999999999999999	9999999999999999999999999999999999999999999999999999999999999999999999999999
-- !result
set new_planner_agg_stage=0;
-- result:
-- !result
SELECT
    'Test7_COUNT_DISTINCT_planner0' as test_name,
    COUNT(DISTINCT p40s10) as distinct_p40s10,
    COUNT(DISTINCT p50s15) as distinct_p50s15,
    COUNT(DISTINCT p76s20) as distinct_p76s20,
    COUNT(DISTINCT p76s0) as distinct_p76s0
FROM decimal256_agg_test;
-- result:
Test7_COUNT_DISTINCT_planner0	11	12	12	12
-- !result
set new_planner_agg_stage=2;
-- result:
-- !result
SELECT
    'Test7_COUNT_DISTINCT_planner2' as test_name,
    COUNT(DISTINCT p40s10) as distinct_p40s10,
    COUNT(DISTINCT p50s15) as distinct_p50s15,
    COUNT(DISTINCT p76s20) as distinct_p76s20,
    COUNT(DISTINCT p76s0) as distinct_p76s0
FROM decimal256_agg_test;
-- result:
Test7_COUNT_DISTINCT_planner2	11	12	12	12
-- !result
set new_planner_agg_stage=0;
-- result:
-- !result
set new_planner_agg_stage=0;
-- result:
-- !result
SELECT
    'Test8_SUM_DISTINCT_planner0' as test_name,
    SUM(DISTINCT p40s10) as sum_distinct_p40s10,
    SUM(DISTINCT p50s15) as sum_distinct_p50s15,
    SUM(DISTINCT p76s20) as sum_distinct_p76s20,
    SUM(DISTINCT p76s0) as sum_distinct_p76s0
FROM decimal256_agg_test;
-- result:
Test8_SUM_DISTINCT_planner0	1000000000000000000000000002828.5802469122	100000000000000000000000000000003717.469135801246910	100000000000000000000000000000000000000000000000000003828.58024691235802469121	10000000000000000000000000000000000000000000000000000000000000000000000003715
-- !result
set new_planner_agg_stage=2;
-- result:
-- !result
SELECT
    'Test8_SUM_DISTINCT_planner2' as test_name,
    SUM(DISTINCT p40s10) as sum_distinct_p40s10,
    SUM(DISTINCT p50s15) as sum_distinct_p50s15,
    SUM(DISTINCT p76s20) as sum_distinct_p76s20,
    SUM(DISTINCT p76s0) as sum_distinct_p76s0
FROM decimal256_agg_test;
-- result:
Test8_SUM_DISTINCT_planner2	1000000000000000000000000002828.5802469122	100000000000000000000000000000003717.469135801246910	100000000000000000000000000000000000000000000000000003828.58024691235802469121	10000000000000000000000000000000000000000000000000000000000000000000000003715
-- !result
set new_planner_agg_stage=0;
-- result:
-- !result
set new_planner_agg_stage=0;
-- result:
-- !result
SELECT
    'Test9_AVG_DISTINCT_planner0' as test_name,
    AVG(DISTINCT p40s10) as avg_distinct_p40s10,
    AVG(DISTINCT p50s15) as avg_distinct_p50s15,
    AVG(DISTINCT p76s20) as avg_distinct_p76s20,
    AVG(DISTINCT p76s0) as avg_distinct_p76s0
FROM decimal256_agg_test;
-- result:
Test9_AVG_DISTINCT_planner0	90909090909090909090909091166.234567901109	8333333333333333333333333333333643.122427983437243	8333333333333333333333333333333333333333333333333333652.38168724269650205760	None
-- !result
set new_planner_agg_stage=2;
-- result:
-- !result
SELECT
    'Test9_AVG_DISTINCT_planner2' as test_name,
    AVG(DISTINCT p40s10) as avg_distinct_p40s10,
    AVG(DISTINCT p50s15) as avg_distinct_p50s15,
    AVG(DISTINCT p76s20) as avg_distinct_p76s20,
    AVG(DISTINCT p76s0) as avg_distinct_p76s0
FROM decimal256_agg_test;
-- result:
Test9_AVG_DISTINCT_planner2	90909090909090909090909091166.234567901109	8333333333333333333333333333333643.122427983437243	8333333333333333333333333333333333333333333333333333652.38168724269650205760	None
-- !result
set new_planner_agg_stage=0;
-- result:
-- !result
set new_planner_agg_stage=0;
-- result:
-- !result
SELECT
    'Test10_GROUP_COUNT_DISTINCT_planner0' as test_name,
    category,
    COUNT(*) as row_count,
    COUNT(DISTINCT p40s10) as distinct_p40s10,
    COUNT(DISTINCT p76s0) as distinct_p76s0
FROM decimal256_agg_test
GROUP BY category
ORDER BY category;
-- result:
Test10_GROUP_COUNT_DISTINCT_planner0	A	3	1	1
Test10_GROUP_COUNT_DISTINCT_planner0	B	2	1	1
Test10_GROUP_COUNT_DISTINCT_planner0	C	3	1	1
Test10_GROUP_COUNT_DISTINCT_planner0	D	2	1	1
Test10_GROUP_COUNT_DISTINCT_planner0	E	1	1	1
Test10_GROUP_COUNT_DISTINCT_planner0	F	1	1	1
Test10_GROUP_COUNT_DISTINCT_planner0	G	1	1	1
Test10_GROUP_COUNT_DISTINCT_planner0	H	2	1	1
Test10_GROUP_COUNT_DISTINCT_planner0	I	2	1	1
Test10_GROUP_COUNT_DISTINCT_planner0	J	2	1	1
Test10_GROUP_COUNT_DISTINCT_planner0	K	3	1	2
-- !result
set new_planner_agg_stage=2;
-- result:
-- !result
SELECT
    'Test10_GROUP_COUNT_DISTINCT_planner2' as test_name,
    category,
    COUNT(*) as row_count,
    COUNT(DISTINCT p40s10) as distinct_p40s10,
    COUNT(DISTINCT p76s0) as distinct_p76s0
FROM decimal256_agg_test
GROUP BY category
ORDER BY category;
-- result:
Test10_GROUP_COUNT_DISTINCT_planner2	A	3	1	1
Test10_GROUP_COUNT_DISTINCT_planner2	B	2	1	1
Test10_GROUP_COUNT_DISTINCT_planner2	C	3	1	1
Test10_GROUP_COUNT_DISTINCT_planner2	D	2	1	1
Test10_GROUP_COUNT_DISTINCT_planner2	E	1	1	1
Test10_GROUP_COUNT_DISTINCT_planner2	F	1	1	1
Test10_GROUP_COUNT_DISTINCT_planner2	G	1	1	1
Test10_GROUP_COUNT_DISTINCT_planner2	H	2	1	1
Test10_GROUP_COUNT_DISTINCT_planner2	I	2	1	1
Test10_GROUP_COUNT_DISTINCT_planner2	J	2	1	1
Test10_GROUP_COUNT_DISTINCT_planner2	K	3	1	2
-- !result
set new_planner_agg_stage=0;
-- result:
-- !result
set new_planner_agg_stage=0;
-- result:
-- !result
SELECT
    'Test11_GROUP_SUM_DISTINCT_planner0' as test_name,
    category,
    SUM(DISTINCT p40s10) as sum_distinct_p40s10,
    SUM(DISTINCT p50s15) as sum_distinct_p50s15
FROM decimal256_agg_test
GROUP BY category
ORDER BY category;
-- result:
Test11_GROUP_SUM_DISTINCT_planner0	A	100.1234567890	100.123456789012345
Test11_GROUP_SUM_DISTINCT_planner0	B	200.5555555555	200.555555555555555
Test11_GROUP_SUM_DISTINCT_planner0	C	0E-10	0E-15
Test11_GROUP_SUM_DISTINCT_planner0	D	-50.9876543210	-50.987654321098765
Test11_GROUP_SUM_DISTINCT_planner0	E	300.1111111111	300.111111111111111
Test11_GROUP_SUM_DISTINCT_planner0	F	400.2222222222	400.222222222222222
Test11_GROUP_SUM_DISTINCT_planner0	G	500.3333333333	500.333333333333333
Test11_GROUP_SUM_DISTINCT_planner0	H	999999999999999999999999999999.9999999999	99999999999999999999999999999999999.999999999999999
Test11_GROUP_SUM_DISTINCT_planner0	I	1E-10	1E-15
Test11_GROUP_SUM_DISTINCT_planner0	J	600.4444444444	600.444444444444444
Test11_GROUP_SUM_DISTINCT_planner0	K	777.7777777777	1666.666666666666665
-- !result
set new_planner_agg_stage=2;
-- result:
-- !result
SELECT
    'Test11_GROUP_SUM_DISTINCT_planner2' as test_name,
    category,
    SUM(DISTINCT p40s10) as sum_distinct_p40s10,
    SUM(DISTINCT p50s15) as sum_distinct_p50s15
FROM decimal256_agg_test
GROUP BY category
ORDER BY category;
-- result:
Test11_GROUP_SUM_DISTINCT_planner2	A	100.1234567890	100.123456789012345
Test11_GROUP_SUM_DISTINCT_planner2	B	200.5555555555	200.555555555555555
Test11_GROUP_SUM_DISTINCT_planner2	C	0E-10	0E-15
Test11_GROUP_SUM_DISTINCT_planner2	D	-50.9876543210	-50.987654321098765
Test11_GROUP_SUM_DISTINCT_planner2	E	300.1111111111	300.111111111111111
Test11_GROUP_SUM_DISTINCT_planner2	F	400.2222222222	400.222222222222222
Test11_GROUP_SUM_DISTINCT_planner2	G	500.3333333333	500.333333333333333
Test11_GROUP_SUM_DISTINCT_planner2	H	999999999999999999999999999999.9999999999	99999999999999999999999999999999999.999999999999999
Test11_GROUP_SUM_DISTINCT_planner2	I	1E-10	1E-15
Test11_GROUP_SUM_DISTINCT_planner2	J	600.4444444444	600.444444444444444
Test11_GROUP_SUM_DISTINCT_planner2	K	777.7777777777	1666.666666666666665
-- !result
set new_planner_agg_stage=0;
-- result:
-- !result
set new_planner_agg_stage=0;
-- result:
-- !result
SELECT
    'Test12_GROUP_AVG_DISTINCT_planner0' as test_name,
    category,
    AVG(DISTINCT p40s10) as avg_distinct_p40s10,
    AVG(DISTINCT p76s0) as avg_distinct_p76s0
FROM decimal256_agg_test
GROUP BY category
ORDER BY category;
-- result:
Test12_GROUP_AVG_DISTINCT_planner0	A	100.123456789000	100.000000
Test12_GROUP_AVG_DISTINCT_planner0	B	200.555555555500	200.000000
Test12_GROUP_AVG_DISTINCT_planner0	C	0E-12	0.000000
Test12_GROUP_AVG_DISTINCT_planner0	D	-50.987654321000	-50.000000
Test12_GROUP_AVG_DISTINCT_planner0	E	300.111111111100	300.000000
Test12_GROUP_AVG_DISTINCT_planner0	F	400.222222222200	400.000000
Test12_GROUP_AVG_DISTINCT_planner0	G	500.333333333300	500.000000
Test12_GROUP_AVG_DISTINCT_planner0	H	999999999999999999999999999999.999999999900	None
Test12_GROUP_AVG_DISTINCT_planner0	I	1.00E-10	1.000000
Test12_GROUP_AVG_DISTINCT_planner0	J	600.444444444400	600.000000
Test12_GROUP_AVG_DISTINCT_planner0	K	777.777777777700	832.500000
-- !result
set new_planner_agg_stage=2;
-- result:
-- !result
SELECT
    'Test12_GROUP_AVG_DISTINCT_planner2' as test_name,
    category,
    AVG(DISTINCT p40s10) as avg_distinct_p40s10,
    AVG(DISTINCT p76s0) as avg_distinct_p76s0
FROM decimal256_agg_test
GROUP BY category
ORDER BY category;
-- result:
Test12_GROUP_AVG_DISTINCT_planner2	A	100.123456789000	100.000000
Test12_GROUP_AVG_DISTINCT_planner2	B	200.555555555500	200.000000
Test12_GROUP_AVG_DISTINCT_planner2	C	0E-12	0.000000
Test12_GROUP_AVG_DISTINCT_planner2	D	-50.987654321000	-50.000000
Test12_GROUP_AVG_DISTINCT_planner2	E	300.111111111100	300.000000
Test12_GROUP_AVG_DISTINCT_planner2	F	400.222222222200	400.000000
Test12_GROUP_AVG_DISTINCT_planner2	G	500.333333333300	500.000000
Test12_GROUP_AVG_DISTINCT_planner2	H	999999999999999999999999999999.999999999900	None
Test12_GROUP_AVG_DISTINCT_planner2	I	1.00E-10	1.000000
Test12_GROUP_AVG_DISTINCT_planner2	J	600.444444444400	600.000000
Test12_GROUP_AVG_DISTINCT_planner2	K	777.777777777700	832.500000
-- !result
set new_planner_agg_stage=0;
-- result:
-- !result
set new_planner_agg_stage=0;
-- result:
-- !result
SELECT
    'Test13_GROUP_BY_DECIMAL_DISTINCT_planner0' as test_name,
    p76s0,
    COUNT(*) as row_count,
    COUNT(DISTINCT p40s10) as distinct_p40s10,
    SUM(DISTINCT p40s10) as sum_distinct_p40s10,
    AVG(DISTINCT p40s10) as avg_distinct_p40s10
FROM decimal256_agg_test
WHERE p76s0 IS NOT NULL
GROUP BY p76s0
ORDER BY p76s0;
-- result:
Test13_GROUP_BY_DECIMAL_DISTINCT_planner0	-50	2	1	-50.9876543210	-50.987654321000
Test13_GROUP_BY_DECIMAL_DISTINCT_planner0	0	3	1	0E-10	0E-12
Test13_GROUP_BY_DECIMAL_DISTINCT_planner0	1	2	1	1E-10	1.00E-10
Test13_GROUP_BY_DECIMAL_DISTINCT_planner0	100	3	1	100.1234567890	100.123456789000
Test13_GROUP_BY_DECIMAL_DISTINCT_planner0	200	2	1	200.5555555555	200.555555555500
Test13_GROUP_BY_DECIMAL_DISTINCT_planner0	300	1	1	300.1111111111	300.111111111100
Test13_GROUP_BY_DECIMAL_DISTINCT_planner0	400	1	1	400.2222222222	400.222222222200
Test13_GROUP_BY_DECIMAL_DISTINCT_planner0	500	1	1	500.3333333333	500.333333333300
Test13_GROUP_BY_DECIMAL_DISTINCT_planner0	600	1	1	600.4444444444	600.444444444400
Test13_GROUP_BY_DECIMAL_DISTINCT_planner0	777	2	1	777.7777777777	777.777777777700
Test13_GROUP_BY_DECIMAL_DISTINCT_planner0	888	1	1	777.7777777777	777.777777777700
Test13_GROUP_BY_DECIMAL_DISTINCT_planner0	9999999999999999999999999999999999999999999999999999999999999999999999999999	2	1	999999999999999999999999999999.9999999999	999999999999999999999999999999.999999999900
-- !result
set new_planner_agg_stage=2;
-- result:
-- !result
SELECT
    'Test13_GROUP_BY_DECIMAL_DISTINCT_planner2' as test_name,
    p76s0,
    COUNT(*) as row_count,
    COUNT(DISTINCT p40s10) as distinct_p40s10,
    SUM(DISTINCT p40s10) as sum_distinct_p40s10,
    AVG(DISTINCT p40s10) as avg_distinct_p40s10
FROM decimal256_agg_test
WHERE p76s0 IS NOT NULL
GROUP BY p76s0
ORDER BY p76s0;
-- result:
Test13_GROUP_BY_DECIMAL_DISTINCT_planner2	-50	2	1	-50.9876543210	-50.987654321000
Test13_GROUP_BY_DECIMAL_DISTINCT_planner2	0	3	1	0E-10	0E-12
Test13_GROUP_BY_DECIMAL_DISTINCT_planner2	1	2	1	1E-10	1.00E-10
Test13_GROUP_BY_DECIMAL_DISTINCT_planner2	100	3	1	100.1234567890	100.123456789000
Test13_GROUP_BY_DECIMAL_DISTINCT_planner2	200	2	1	200.5555555555	200.555555555500
Test13_GROUP_BY_DECIMAL_DISTINCT_planner2	300	1	1	300.1111111111	300.111111111100
Test13_GROUP_BY_DECIMAL_DISTINCT_planner2	400	1	1	400.2222222222	400.222222222200
Test13_GROUP_BY_DECIMAL_DISTINCT_planner2	500	1	1	500.3333333333	500.333333333300
Test13_GROUP_BY_DECIMAL_DISTINCT_planner2	600	1	1	600.4444444444	600.444444444400
Test13_GROUP_BY_DECIMAL_DISTINCT_planner2	777	2	1	777.7777777777	777.777777777700
Test13_GROUP_BY_DECIMAL_DISTINCT_planner2	888	1	1	777.7777777777	777.777777777700
Test13_GROUP_BY_DECIMAL_DISTINCT_planner2	9999999999999999999999999999999999999999999999999999999999999999999999999999	2	1	999999999999999999999999999999.9999999999	999999999999999999999999999999.999999999900
-- !result
set new_planner_agg_stage=0;
-- result:
-- !result
set new_planner_agg_stage=0;
-- result:
-- !result
SELECT DISTINCT 'Test14_SELECT_DISTINCT_SINGLE_planner0' as test_name, p40s10
FROM decimal256_agg_test
WHERE p40s10 IS NOT NULL
ORDER BY p40s10;
-- result:
Test14_SELECT_DISTINCT_SINGLE_planner0	-50.9876543210
Test14_SELECT_DISTINCT_SINGLE_planner0	0E-10
Test14_SELECT_DISTINCT_SINGLE_planner0	1E-10
Test14_SELECT_DISTINCT_SINGLE_planner0	100.1234567890
Test14_SELECT_DISTINCT_SINGLE_planner0	200.5555555555
Test14_SELECT_DISTINCT_SINGLE_planner0	300.1111111111
Test14_SELECT_DISTINCT_SINGLE_planner0	400.2222222222
Test14_SELECT_DISTINCT_SINGLE_planner0	500.3333333333
Test14_SELECT_DISTINCT_SINGLE_planner0	600.4444444444
Test14_SELECT_DISTINCT_SINGLE_planner0	777.7777777777
Test14_SELECT_DISTINCT_SINGLE_planner0	999999999999999999999999999999.9999999999
-- !result
set new_planner_agg_stage=2;
-- result:
-- !result
SELECT DISTINCT 'Test14_SELECT_DISTINCT_SINGLE_planner2' as test_name, p40s10
FROM decimal256_agg_test
WHERE p40s10 IS NOT NULL
ORDER BY p40s10;
-- result:
Test14_SELECT_DISTINCT_SINGLE_planner2	-50.9876543210
Test14_SELECT_DISTINCT_SINGLE_planner2	0E-10
Test14_SELECT_DISTINCT_SINGLE_planner2	1E-10
Test14_SELECT_DISTINCT_SINGLE_planner2	100.1234567890
Test14_SELECT_DISTINCT_SINGLE_planner2	200.5555555555
Test14_SELECT_DISTINCT_SINGLE_planner2	300.1111111111
Test14_SELECT_DISTINCT_SINGLE_planner2	400.2222222222
Test14_SELECT_DISTINCT_SINGLE_planner2	500.3333333333
Test14_SELECT_DISTINCT_SINGLE_planner2	600.4444444444
Test14_SELECT_DISTINCT_SINGLE_planner2	777.7777777777
Test14_SELECT_DISTINCT_SINGLE_planner2	999999999999999999999999999999.9999999999
-- !result
set new_planner_agg_stage=0;
-- result:
-- !result
set new_planner_agg_stage=0;
-- result:
-- !result
SELECT DISTINCT 'Test15_SELECT_DISTINCT_MULTI_planner0' as test_name, p40s10, p50s15, p76s0
FROM decimal256_agg_test
WHERE p40s10 IS NOT NULL
ORDER BY p40s10, p50s15;
-- result:
Test15_SELECT_DISTINCT_MULTI_planner0	-50.9876543210	-50.987654321098765	-50
Test15_SELECT_DISTINCT_MULTI_planner0	0E-10	0E-15	0
Test15_SELECT_DISTINCT_MULTI_planner0	1E-10	1E-15	1
Test15_SELECT_DISTINCT_MULTI_planner0	100.1234567890	100.123456789012345	100
Test15_SELECT_DISTINCT_MULTI_planner0	200.5555555555	200.555555555555555	200
Test15_SELECT_DISTINCT_MULTI_planner0	300.1111111111	300.111111111111111	300
Test15_SELECT_DISTINCT_MULTI_planner0	400.2222222222	400.222222222222222	400
Test15_SELECT_DISTINCT_MULTI_planner0	500.3333333333	500.333333333333333	500
Test15_SELECT_DISTINCT_MULTI_planner0	600.4444444444	600.444444444444444	600
Test15_SELECT_DISTINCT_MULTI_planner0	777.7777777777	777.777777777777777	777
Test15_SELECT_DISTINCT_MULTI_planner0	777.7777777777	777.777777777777777	888
Test15_SELECT_DISTINCT_MULTI_planner0	777.7777777777	888.888888888888888	777
Test15_SELECT_DISTINCT_MULTI_planner0	999999999999999999999999999999.9999999999	99999999999999999999999999999999999.999999999999999	9999999999999999999999999999999999999999999999999999999999999999999999999999
-- !result
set new_planner_agg_stage=2;
-- result:
-- !result
SELECT DISTINCT 'Test15_SELECT_DISTINCT_MULTI_planner2' as test_name, p40s10, p50s15, p76s0
FROM decimal256_agg_test
WHERE p40s10 IS NOT NULL
ORDER BY p40s10, p50s15;
-- result:
Test15_SELECT_DISTINCT_MULTI_planner2	-50.9876543210	-50.987654321098765	-50
Test15_SELECT_DISTINCT_MULTI_planner2	0E-10	0E-15	0
Test15_SELECT_DISTINCT_MULTI_planner2	1E-10	1E-15	1
Test15_SELECT_DISTINCT_MULTI_planner2	100.1234567890	100.123456789012345	100
Test15_SELECT_DISTINCT_MULTI_planner2	200.5555555555	200.555555555555555	200
Test15_SELECT_DISTINCT_MULTI_planner2	300.1111111111	300.111111111111111	300
Test15_SELECT_DISTINCT_MULTI_planner2	400.2222222222	400.222222222222222	400
Test15_SELECT_DISTINCT_MULTI_planner2	500.3333333333	500.333333333333333	500
Test15_SELECT_DISTINCT_MULTI_planner2	600.4444444444	600.444444444444444	600
Test15_SELECT_DISTINCT_MULTI_planner2	777.7777777777	777.777777777777777	777
Test15_SELECT_DISTINCT_MULTI_planner2	777.7777777777	777.777777777777777	888
Test15_SELECT_DISTINCT_MULTI_planner2	777.7777777777	888.888888888888888	777
Test15_SELECT_DISTINCT_MULTI_planner2	999999999999999999999999999999.9999999999	99999999999999999999999999999999999.999999999999999	9999999999999999999999999999999999999999999999999999999999999999999999999999
-- !result
set new_planner_agg_stage=0;
-- result:
-- !result
set new_planner_agg_stage=0;
-- result:
-- !result
SELECT
    'Test16_COMPLEX_DISTINCT_planner0' as test_name,
    COUNT(DISTINCT p40s10) as count_distinct_p40s10,
    SUM(DISTINCT p40s10) as sum_distinct_p40s10,
    AVG(DISTINCT p40s10) as avg_distinct_p40s10,
    COUNT(DISTINCT p76s0) as count_distinct_p76s0,
    SUM(DISTINCT p76s0) as sum_distinct_p76s0,
    AVG(DISTINCT p76s0) as avg_distinct_p76s0
FROM decimal256_agg_test;
-- result:
Test16_COMPLEX_DISTINCT_planner0	11	1000000000000000000000000002828.5802469122	90909090909090909090909091166.234567901109	12	10000000000000000000000000000000000000000000000000000000000000000000000003715	None
-- !result
set new_planner_agg_stage=2;
-- result:
-- !result
SELECT
    'Test16_COMPLEX_DISTINCT_planner2' as test_name,
    COUNT(DISTINCT p40s10) as count_distinct_p40s10,
    SUM(DISTINCT p40s10) as sum_distinct_p40s10,
    AVG(DISTINCT p40s10) as avg_distinct_p40s10,
    COUNT(DISTINCT p76s0) as count_distinct_p76s0,
    SUM(DISTINCT p76s0) as sum_distinct_p76s0,
    AVG(DISTINCT p76s0) as avg_distinct_p76s0
FROM decimal256_agg_test;
-- result:
Test16_COMPLEX_DISTINCT_planner2	11	1000000000000000000000000002828.5802469122	90909090909090909090909091166.234567901109	12	10000000000000000000000000000000000000000000000000000000000000000000000003715	None
-- !result
set new_planner_agg_stage=0;
-- result:
-- !result
set new_planner_agg_stage=0;
-- result:
-- !result
SELECT
    'Test17_HAVING_DISTINCT_planner0' as test_name,
    p40s10,
    COUNT(*) as row_count,
    COUNT(DISTINCT p50s15) as distinct_p50s15,
    SUM(DISTINCT p50s15) as sum_distinct_p50s15
FROM decimal256_agg_test
WHERE p40s10 IS NOT NULL
GROUP BY p40s10
HAVING COUNT(*) > 1
ORDER BY p40s10;
-- result:
Test17_HAVING_DISTINCT_planner0	-50.9876543210	2	1	-50.987654321098765
Test17_HAVING_DISTINCT_planner0	0E-10	3	1	0E-15
Test17_HAVING_DISTINCT_planner0	1E-10	2	1	1E-15
Test17_HAVING_DISTINCT_planner0	100.1234567890	3	1	100.123456789012345
Test17_HAVING_DISTINCT_planner0	200.5555555555	2	1	200.555555555555555
Test17_HAVING_DISTINCT_planner0	777.7777777777	3	2	1666.666666666666665
Test17_HAVING_DISTINCT_planner0	999999999999999999999999999999.9999999999	2	1	99999999999999999999999999999999999.999999999999999
-- !result
set new_planner_agg_stage=2;
-- result:
-- !result
SELECT
    'Test17_HAVING_DISTINCT_planner2' as test_name,
    p40s10,
    COUNT(*) as row_count,
    COUNT(DISTINCT p50s15) as distinct_p50s15,
    SUM(DISTINCT p50s15) as sum_distinct_p50s15
FROM decimal256_agg_test
WHERE p40s10 IS NOT NULL
GROUP BY p40s10
HAVING COUNT(*) > 1
ORDER BY p40s10;
-- result:
Test17_HAVING_DISTINCT_planner2	-50.9876543210	2	1	-50.987654321098765
Test17_HAVING_DISTINCT_planner2	0E-10	3	1	0E-15
Test17_HAVING_DISTINCT_planner2	1E-10	2	1	1E-15
Test17_HAVING_DISTINCT_planner2	100.1234567890	3	1	100.123456789012345
Test17_HAVING_DISTINCT_planner2	200.5555555555	2	1	200.555555555555555
Test17_HAVING_DISTINCT_planner2	777.7777777777	3	2	1666.666666666666665
Test17_HAVING_DISTINCT_planner2	999999999999999999999999999999.9999999999	2	1	99999999999999999999999999999999999.999999999999999
-- !result
set new_planner_agg_stage=0;
-- result:
-- !result
SELECT
    'Test18_EMPTY_RESULT' as test_name,
    COUNT(*) as count_all,
    SUM(p40s10) as sum_p40s10,
    AVG(p40s10) as avg_p40s10,
    MIN(p50s15) as min_p50s15,
    MAX(p76s20) as max_p76s20
FROM decimal256_agg_test
WHERE id > 1000;
-- result:
Test18_EMPTY_RESULT	0	None	None	None	None
-- !result
SELECT
    'Test19_NULL_ONLY' as test_name,
    COUNT(*) as count_all,
    COUNT(p40s10) as count_p40s10,
    SUM(p50s15) as sum_p50s15,
    AVG(p50s15) as avg_p50s15
FROM decimal256_agg_test
WHERE id = 18;
-- result:
Test19_NULL_ONLY	1	0	None	None
-- !result
SELECT
    'Test20_SINGLE_ROW' as test_name,
    COUNT(*) as count_all,
    SUM(p40s10) as sum_p40s10,
    AVG(p40s10) as avg_p40s10,
    MIN(p50s15) as min_p50s15,
    MAX(p76s20) as max_p76s20
FROM decimal256_agg_test
WHERE id = 11;
-- result:
Test20_SINGLE_ROW	1	300.1111111111	300.111111111100	300.111111111111111	300.11111111111111111111
-- !result