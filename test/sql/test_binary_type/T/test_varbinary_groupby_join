-- name: test_varbinary_groupby_join
create database db_${uuid0};
use db_${uuid0};

-- Create tables with VARBINARY
create table a(
  id int,
  kb varbinary,
  v int
)
DUPLICATE KEY(id)
DISTRIBUTED BY HASH(id)
BUCKETS 1
PROPERTIES('replication_num'='1');

create table b(
  id int,
  kb varbinary,
  v int
)
DUPLICATE KEY(id)
DISTRIBUTED BY HASH(id)
BUCKETS 1
PROPERTIES('replication_num'='1');

-- Insert rows using hex literal x'..'
insert into a values
  (1, x'0102', 10),
  (2, x'0102', 20),
  (3, x'0AFF', 30);

insert into b values
  (10, x'0102', 100),
  (20, x'0AFF', 200),
  (30, x'BEEF', 300);

-- GROUP BY on VARBINARY
select hex(kb), count(*), sum(v) from a group by kb order by hex(kb);

-- JOIN on VARBINARY equality
select hex(a.kb), a.v, b.v from a join b on a.kb = b.kb order by hex(a.kb), a.v, b.v;

-- LEFT JOIN with unmatched key
select hex(a.kb), a.v, ifnull(b.v, -1) from a left join b on a.kb = b.kb order by hex(a.kb), a.v, ifnull(b.v, -1);