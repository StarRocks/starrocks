-- name: test_array_cast
select cast(array<string>[] as string);
-- result:
[]
-- !result
select cast(array<int>[] as string);
-- result:
[]
-- !result
select cast(array<string>['a', 'b'] as string);
-- result:
[a,b]
-- !result
select cast(array<int>[1, 2] as string);
-- result:
[1,2]
-- !result
select cast(array<double>[1.1, 2.2] as string);
-- result:
[1.1,2.2]
-- !result
select cast(array<json>['{"a": 1}', '{"a": 2}'] as string);
-- result:
[{"a": 1},{"a": 2}]
-- !result
select cast(array<json>['{"a": 1}', NULL] as string);
-- result:
[{"a": 1},NULL]
-- !result
select cast(array<int>[1, null] as string);
-- result:
[1,NULL]
-- !result
select cast(array<int>[null, null] as string);
-- result:
[NULL,NULL]
-- !result
select cast(array<array<int>>[null, null] as string);
-- result:
[NULL,NULL]
-- !result
select cast(array<array<int>>[null, [null]] as string);
-- result:
[NULL,[NULL]]
-- !result
select cast(map<int, int>{1: 1} as string);
-- result:
E: (1064, 'Getting analyzing error from line 1, column 7 to line 1, column 41. Detail message: Invalid type cast from map<int(11),int(11)> to varchar(65533) in sql `map{1:1}`.')
-- !result
select cast(row(1, 2) as string);
-- result:
E: (1064, 'Getting analyzing error from line 1, column 7 to line 1, column 31. Detail message: Invalid type cast from struct<col1 tinyint(4), col2 tinyint(4)> to varchar(65533) in sql `row(1, 2)`.')
-- !result
select cast(array<map<int, int>>[map{1: 1}] as string);
-- result:
E: (1064, 'Getting analyzing error from line 1, column 7 to line 1, column 53. Detail message: Invalid type cast from array<map<int(11),int(11)>> to varchar(65533) in sql `[map{1:1}]`.')
-- !result
select cast(array<struct<c1 int, c2 int>>[row(1, 2)] as string);
-- result:
E: (1064, 'Getting analyzing error from line 1, column 7 to line 1, column 62. Detail message: Invalid type cast from array<struct<c1 int(11), c2 int(11)>> to varchar(65533) in sql `[row(1, 2)]`.')
-- !result
select cast(array<map<int, int>>[] as string);
-- result:
[]
-- !result
select cast(array<struct<c1 int, c2 int>>[] as string);
-- result:
[]
-- !result
CREATE TABLE array_test ( 
    pk bigint not null ,
    c1   Array<String>, 
    c2   Array<BigInt>,
    c3   Array<Double>,
    c4   Array<DECIMAL(26, 2)>,
    c5   Array<DECIMAL64(4, 3)>,
    c6   Array<DECIMAL128(25, 19)>,
    c7   Array<DECIMAL32(8, 5)> ,
    c8   Array<DECIMAL(16, 3)>,
    c9   Array<DECIMAL128(18, 6)> ,
    c10  Array<Array<BigInt>>,
    c11  Array<Array<String>>,
    c12 Array<Array<Array<String>>>,
    c13 Array<Array<Array<DECIMAL(26, 2)>>>
) ENGINE=OLAP
DUPLICATE KEY(`pk`)
DISTRIBUTED BY HASH(`pk`) BUCKETS 3
PROPERTIES ( "replication_num" = "1");
-- result:
-- !result
insert into array_test values
(1, ['a', 'b', 'c'], [1.0, 2.0, 3.0, 4.0, 10.0], [1.0, 2.0, 3.0, 4.0, 10.0, 1.1, 2.1, 3.2, 4.3, -1, -10, 100], [4.0, 10.0, 1.1, 2.1, 3.2, 4.3, -1, -10, 100, 1.0, 2.0, 3.0], [4.0, 10.0, 1.1, -10, 100, 1.0, 2.0, 3.0, 2.1, 3.2, 4.3, -1], [4.0, 2.1, 3.2, 10.0, 1.1, -10, 100, -1, 1.0, 2.0, 3.0, 4.3], [4.0, 2.1, 3.2, 10.0, 2.0, 3.0, 1.1, -1, -10, 100, 1.0, 4.3], [4.0, 2.1, 3.0, 1.1, 4.3, 3.2, -10, 100, 1.0, 10.0, -1, 2.0], [4.0, 2.1, 100, 1.0, 4.3, 3.2, 10.0, 2.0, 3.0, 1.1, -1, -10], [[1, 2, 3, 4], [5, 2, 6, 4], [100, -1, 92, 8], [66, 4, 32, -10]], [['1', '2', '3', '4'], ['-1', 'a', '-100', '100'], ['a', 'b', 'c']], [[['1'],['2'],['3']], [['6'],['5'],['4']], [['-1', '-2'],['-2', '10'],['100','23']]], [[[1],[2],[3]], [[6],[5],[4]], [[-1, -2],[-2, 10],[100,23]]]),
(2, ['-1', '10', '1', '100', '2'], NULL, [10.0, 20.0, 30.0, 4.0, 100.0, 10.1, 2.1, 30.2, 40.3, -1, -10, 100], [40.0, 100.0, 01.1, 2.1, 30.2, 40.3, -1, -100, 1000, 1.0, 2.0, 3.0], [40.0, 100.0, 01.1, -10, 1000, 10.0, 2.0, 30.0, 20.1, 3.2, 4.3, -1], NULL, NULL, [40.0, 20.1, 30.0, 10.1, 40.30, 30.20, -100, 1000, 1.0, 100.0, -10, 2.0], [40.0, 20.1, 1000, 10.0, 40.30, 30.20, 100.0, 20.0, 3.0, 10.1, -10, -10], NULL, NULL, [[['10'],['20'],['30']], [['60'],['5'],['4']], [['-100', '-2'],['-20', '10'],['100','23']]], [[[10],[20],[30]], [[60],[50],[4]], [[-1, -2],[-2, 100],[100,23]]]),
(4, ['a', NULL, 'c', 'e', 'd'], [1.0, 2.0, 3.0, 4.0, 10.0], [1.0, 2.0, 3.0, 4.0, 10.0, NULL, 1.1, 2.1, 3.2, NULL, 4.3, -1, -10, 100], [4.0, 10.0, 1.1, 2.1,NULL, 3.2, 4.3, -1, -10, 100, 1.0, 2.0, 3.0], [4.0, 10.0, 1.1, -10, 100, 1.0, 2.0, 3.0, 2.1, 3.2, 4.3, -1], [4.0, 2.1, 3.2, 10.0, 1.1, -10, 100, -1, 1.0, 2.0, 3.0, 4.3], [4.0, 2.1, 3.2, 10.0, 2.0, 3.0, 1.1, -1, -10, 100, 1.0, 4.3], [4.0, 2.1, 3.0, 1.1, 4.3, 3.2, -10, 100, 1.0, 10.0, -1, 2.0], [4.0, 2.1, 100, NULL, 1.0, 4.3, 3.2, 10.0, 2.0, 3.0, 1.1, -1, -10], [[1, 2, 3, NULL, 4], [5, 2, 6, 4], NULL, [100, -1, 92, 8], [66, 4, 32, -10]], [['1', '2', '3', '4'], ['-1', 'a', '-100', '100'], ['a', 'b', 'c']], [[['1'],['2'],['3']], [['6'],['5'],['4']], [['-1', '-2'],NULL,['-2', '10'],['100','23']]], [[[1],NULL,[2],[3]], [[6],[5],[4]], NULL, [[-1, -2],[-2, 10],[100,23]]]),
(3, NULL, [1.0, 2.0, 3.0, 4.0, 10.0], NULL, [40.0, 10.0, 1.1, 2.1, 3.2, 4.3, -10, -10, 100, 10.0, 20.0, 3.0], [4.0, 10.0, 1.1, -10, 100, 1.0, 20.0, 3.0, 2.1, 3.2, 4.3, -1], [40.0, 20.1, 3.2, 10.0, 10.1, -10, 100, -1, 10.0, 2.0, 30.0, 4.3], [4.0, 2.1, 3.2, 10.0, 20.0, 3.0, 1.1, -10, -100, 100, 10.0, 4.3], NULL, NULL, [[1, 2, 30, 4], [50, 2, 6, 4], [100, -10, 92, 8], [66, 40, 32, -100]], [['1', '20', '3', '4'], ['-1', 'a00', '-100', '100'], ['a', 'b0', 'c']], NULL, NULL);
-- result:
-- !result
select cast(c1 as string) from array_test;
-- result:
[-1,10,1,100,2]
None
[a,b,c]
[a,NULL,c,e,d]
-- !result
select cast(c2 as string) from array_test;
-- result:
[1,2,3,4,10]
[1,2,3,4,10]
None
[1,2,3,4,10]
-- !result
select cast(c3 as string) from array_test;
-- result:
[1,2,3,4,10,1.1,2.1,3.2,4.3,-1,-10,100]
[1,2,3,4,10,NULL,1.1,2.1,3.2,NULL,4.3,-1,-10,100]
[10,20,30,4,100,10.1,2.1,30.2,40.3,-1,-10,100]
None
-- !result
select cast(c4 as string) from array_test;
-- result:
[4.00,10.00,1.10,2.10,3.20,4.30,-1.00,-10.00,100.00,1.00,2.00,3.00]
[4.00,10.00,1.10,2.10,NULL,3.20,4.30,-1.00,-10.00,100.00,1.00,2.00,3.00]
[40.00,100.00,1.10,2.10,30.20,40.30,-1.00,-100.00,1000.00,1.00,2.00,3.00]
[40.00,10.00,1.10,2.10,3.20,4.30,-10.00,-10.00,100.00,10.00,20.00,3.00]
-- !result
select cast(c5 as string) from array_test;
-- result:
[4.000,10.000,1.100,-10.000,100.000,1.000,2.000,3.000,2.100,3.200,4.300,-1.000]
[4.000,10.000,1.100,-10.000,100.000,1.000,2.000,3.000,2.100,3.200,4.300,-1.000]
[40.000,100.000,1.100,-10.000,1000.000,10.000,2.000,30.000,20.100,3.200,4.300,-1.000]
[4.000,10.000,1.100,-10.000,100.000,1.000,20.000,3.000,2.100,3.200,4.300,-1.000]
-- !result
select cast(c6 as string) from array_test;
-- result:
None
[40.0000000000000000000,20.1000000000000000000,3.2000000000000000000,10.0000000000000000000,10.1000000000000000000,-10.0000000000000000000,100.0000000000000000000,-1.0000000000000000000,10.0000000000000000000,2.0000000000000000000,30.0000000000000000000,4.3000000000000000000]
[4.0000000000000000000,2.1000000000000000000,3.2000000000000000000,10.0000000000000000000,1.1000000000000000000,-10.0000000000000000000,100.0000000000000000000,-1.0000000000000000000,1.0000000000000000000,2.0000000000000000000,3.0000000000000000000,4.3000000000000000000]
[4.0000000000000000000,2.1000000000000000000,3.2000000000000000000,10.0000000000000000000,1.1000000000000000000,-10.0000000000000000000,100.0000000000000000000,-1.0000000000000000000,1.0000000000000000000,2.0000000000000000000,3.0000000000000000000,4.3000000000000000000]
-- !result
select cast(c7 as string) from array_test;
-- result:
None
[4.00000,2.10000,3.20000,10.00000,20.00000,3.00000,1.10000,-10.00000,-100.00000,100.00000,10.00000,4.30000]
[4.00000,2.10000,3.20000,10.00000,2.00000,3.00000,1.10000,-1.00000,-10.00000,100.00000,1.00000,4.30000]
[4.00000,2.10000,3.20000,10.00000,2.00000,3.00000,1.10000,-1.00000,-10.00000,100.00000,1.00000,4.30000]
-- !result
select cast(c8 as string) from array_test;
-- result:
[40.000,20.100,30.000,10.100,40.300,30.200,-100.000,1000.000,1.000,100.000,-10.000,2.000]
None
[4.000,2.100,3.000,1.100,4.300,3.200,-10.000,100.000,1.000,10.000,-1.000,2.000]
[4.000,2.100,3.000,1.100,4.300,3.200,-10.000,100.000,1.000,10.000,-1.000,2.000]
-- !result
select cast(c9 as string) from array_test;
-- result:
[4.000000,2.100000,100.000000,1.000000,4.300000,3.200000,10.000000,2.000000,3.000000,1.100000,-1.000000,-10.000000]
[4.000000,2.100000,100.000000,NULL,1.000000,4.300000,3.200000,10.000000,2.000000,3.000000,1.100000,-1.000000,-10.000000]
[40.000000,20.100000,1000.000000,10.000000,40.300000,30.200000,100.000000,20.000000,3.000000,10.100000,-10.000000,-10.000000]
None
-- !result
select cast(c10 as string) from array_test;
-- result:
None
[[1,2,30,4],[50,2,6,4],[100,-10,92,8],[66,40,32,-100]]
[[1,2,3,4],[5,2,6,4],[100,-1,92,8],[66,4,32,-10]]
[[1,2,3,NULL,4],[5,2,6,4],NULL,[100,-1,92,8],[66,4,32,-10]]
-- !result
select cast(c11 as string) from array_test;
-- result:
None
[[1,20,3,4],[-1,a00,-100,100],[a,b0,c]]
[[1,2,3,4],[-1,a,-100,100],[a,b,c]]
[[1,2,3,4],[-1,a,-100,100],[a,b,c]]
-- !result
select cast(c12 as string) from array_test;
-- result:
[[[1],[2],[3]],[[6],[5],[4]],[[-1,-2],[-2,10],[100,23]]]
[[[1],[2],[3]],[[6],[5],[4]],[[-1,-2],NULL,[-2,10],[100,23]]]
[[[10],[20],[30]],[[60],[5],[4]],[[-100,-2],[-20,10],[100,23]]]
None
-- !result
select cast(c13 as string) from array_test;
-- result:
[[[10.00],[20.00],[30.00]],[[60.00],[50.00],[4.00]],[[-1.00,-2.00],[-2.00,100.00],[100.00,23.00]]]
None
[[[1.00],[2.00],[3.00]],[[6.00],[5.00],[4.00]],[[-1.00,-2.00],[-2.00,10.00],[100.00,23.00]]]
[[[1.00],NULL,[2.00],[3.00]],[[6.00],[5.00],[4.00]],NULL,[[-1.00,-2.00],[-2.00,10.00],[100.00,23.00]]]
-- !result