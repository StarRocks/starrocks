-- name: test_array_contains_with_const
CREATE TABLE t ( 
pk bigint not null ,
str string,
arr_bigint array<bigint>,
arr_str array<string>
) ENGINE=OLAP
DUPLICATE KEY(`pk`)
DISTRIBUTED BY HASH(`pk`) BUCKETS 3
PROPERTIES (
"replication_num" = "1"
);
-- result:
-- !result
insert into t select generate_series, md5sum(generate_series), array_repeat(generate_series, 1000),array_repeat(md5sum(generate_series), 100) from table(generate_series(0, 9999));
-- result:
-- !result
insert into t values (10000, null, array_repeat(10000, 1000),array_repeat(md5sum(10000), 100));
-- result:
-- !result
set @arr = array_generate(10000);
-- result:
-- !result
select sum(array_contains(@arr, pk)) from t;
-- result:
10000
-- !result
select sum(array_contains(@arr, 100)) from t;
-- result:
10001
-- !result
select sum(array_position(@arr, pk)) from t;
-- result:
50015000
-- !result
select sum(array_position(@arr, 100)) from t;
-- result:
1000100
-- !result
select sum(array_contains(arr_bigint, 100)) from t;
-- result:
1
-- !result
select sum(array_position(arr_bigint, 100)) from t;
-- result:
1
-- !result
select sum(array_contains(arr_str, md5sum(100))) from t;
-- result:
1
-- !result
select sum(array_position(arr_str, md5sum(100))) from t;
-- result:
1
-- !result
set @arr = array_repeat("abcdefg", 1000000);
-- result:
-- !result
select sum(array_contains(@arr, "abcdefg")) from t;
-- result:
10001
-- !result
select sum(array_contains(@arr, str)) from t;
-- result:
0
-- !result