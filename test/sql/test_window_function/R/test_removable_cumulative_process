-- name: test_removable_cumulative_process
CREATE TABLE IF NOT EXISTS `t1` (
    `v1` int(11) NULL,
    `v2` int(11) NULL,
    `v3` int(11) NOT NULL,
    `v4` int(11) NULL
)
DUPLICATE KEY(`v1`)
DISTRIBUTED BY HASH(`v1`) BUCKETS 10
PROPERTIES (
    "replication_num" = "1"
);
-- result:
-- !result
INSERT INTO `t1` values (1, 1, 1, NULL), (1, 1, 2, NULL), (1, NULL, 3, NULL), (1, NULL, 4, NULL),
(1, 2, 5, NULL), (1, 2, 6, NULL), (1, NULL, 7, NULL), (1, NULL, 8, NULL), (2, 3, 9, NULL),
(2, 3, 10, NULL), (2, NULL, 11, NULL), (2, NULL, 12, NULL), (2, 4, 13, NULL), (2, 4, 14, NULL),
(2, NULL, 15, NULL), (2, NULL, 16, NULL), (NULL, 3, 17, NULL), (NULL, 3, 18, NULL),
(NULL, NULL, 19, NULL), (NULL, NULL, 20, NULL), (NULL, 4, 21, NULL), (NULL, 4, 22, NULL),
(NULL, NULL, 23, NULL), (NULL, NULL, 24, NULL);
-- result:
-- !result
SELECT v3, v1, COUNT(v1) OVER(ORDER BY v3 ROWS BETWEEN 5 PRECEDING AND 2 PRECEDING) AS CNT FROM t1 ORDER BY v3;
-- result:
1	1	0
2	1	0
3	1	1
4	1	2
5	1	3
6	1	4
7	1	4
8	1	4
9	2	4
10	2	4
11	2	4
12	2	4
13	2	4
14	2	4
15	2	4
16	2	4
17	None	4
18	None	4
19	None	3
20	None	2
21	None	1
22	None	0
23	None	0
24	None	0
-- !result
SELECT v3, v1, COUNT(v1) OVER(ORDER BY v3 ROWS BETWEEN 2 PRECEDING AND 2 FOLLOWING) AS CNT FROM t1 ORDER BY v3;
-- result:
1	1	3
2	1	4
3	1	5
4	1	5
5	1	5
6	1	5
7	1	5
8	1	5
9	2	5
10	2	5
11	2	5
12	2	5
13	2	5
14	2	5
15	2	4
16	2	3
17	None	2
18	None	1
19	None	0
20	None	0
21	None	0
22	None	0
23	None	0
24	None	0
-- !result
SELECT v3, v1, COUNT(v1) OVER(ORDER BY v3 ROWS BETWEEN 2 FOLLOWING AND 5 FOLLOWING) AS CNT FROM t1 ORDER BY v3;
-- result:
1	1	4
2	1	4
3	1	4
4	1	4
5	1	4
6	1	4
7	1	4
8	1	4
9	2	4
10	2	4
11	2	4
12	2	3
13	2	2
14	2	1
15	2	0
16	2	0
17	None	0
18	None	0
19	None	0
20	None	0
21	None	0
22	None	0
23	None	0
24	None	0
-- !result
SELECT v3, v1, COUNT(v1) OVER(ORDER BY v3 ROWS BETWEEN 2 PRECEDING AND CURRENT ROW) AS CNT FROM t1 ORDER BY v3;
-- result:
1	1	1
2	1	2
3	1	3
4	1	3
5	1	3
6	1	3
7	1	3
8	1	3
9	2	3
10	2	3
11	2	3
12	2	3
13	2	3
14	2	3
15	2	3
16	2	3
17	None	2
18	None	1
19	None	0
20	None	0
21	None	0
22	None	0
23	None	0
24	None	0
-- !result
SELECT v3, v1, COUNT(v1) OVER(ORDER BY v3 ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING) AS CNT FROM t1 ORDER BY v3;
-- result:
1	1	3
2	1	3
3	1	3
4	1	3
5	1	3
6	1	3
7	1	3
8	1	3
9	2	3
10	2	3
11	2	3
12	2	3
13	2	3
14	2	3
15	2	2
16	2	1
17	None	0
18	None	0
19	None	0
20	None	0
21	None	0
22	None	0
23	None	0
24	None	0
-- !result
SELECT v3, COUNT(v3) OVER(ORDER BY v3 ROWS BETWEEN 5 PRECEDING AND 2 PRECEDING) AS CNT FROM t1 ORDER BY v3;
-- result:
1	0
2	0
3	1
4	2
5	3
6	4
7	4
8	4
9	4
10	4
11	4
12	4
13	4
14	4
15	4
16	4
17	4
18	4
19	4
20	4
21	4
22	4
23	4
24	4
-- !result
SELECT v3, COUNT(v3) OVER(ORDER BY v3 ROWS BETWEEN 2 PRECEDING AND 2 FOLLOWING) AS CNT FROM t1 ORDER BY v3;
-- result:
1	3
2	4
3	5
4	5
5	5
6	5
7	5
8	5
9	5
10	5
11	5
12	5
13	5
14	5
15	5
16	5
17	5
18	5
19	5
20	5
21	5
22	5
23	4
24	3
-- !result
SELECT v3, COUNT(v3) OVER(ORDER BY v3 ROWS BETWEEN 2 FOLLOWING AND 5 FOLLOWING) AS CNT FROM t1 ORDER BY v3;
-- result:
1	4
2	4
3	4
4	4
5	4
6	4
7	4
8	4
9	4
10	4
11	4
12	4
13	4
14	4
15	4
16	4
17	4
18	4
19	4
20	3
21	2
22	1
23	0
24	0
-- !result
SELECT v3, COUNT(v3) OVER(ORDER BY v3 ROWS BETWEEN 2 PRECEDING AND CURRENT ROW) AS CNT FROM t1 ORDER BY v3;
-- result:
1	1
2	2
3	3
4	3
5	3
6	3
7	3
8	3
9	3
10	3
11	3
12	3
13	3
14	3
15	3
16	3
17	3
18	3
19	3
20	3
21	3
22	3
23	3
24	3
-- !result
SELECT v3, COUNT(v3) OVER(ORDER BY v3 ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING) AS CNT FROM t1 ORDER BY v3;
-- result:
1	3
2	3
3	3
4	3
5	3
6	3
7	3
8	3
9	3
10	3
11	3
12	3
13	3
14	3
15	3
16	3
17	3
18	3
19	3
20	3
21	3
22	3
23	2
24	1
-- !result
SELECT v3, v1, SUM(v1) OVER(ORDER BY v3 ROWS BETWEEN 5 PRECEDING AND 2 PRECEDING) AS CNT FROM t1 ORDER BY v3;
-- result:
1	1	None
2	1	None
3	1	1
4	1	2
5	1	3
6	1	4
7	1	4
8	1	4
9	2	4
10	2	4
11	2	5
12	2	6
13	2	7
14	2	8
15	2	8
16	2	8
17	None	8
18	None	8
19	None	6
20	None	4
21	None	2
22	None	None
23	None	None
24	None	None
-- !result
SELECT v3, v1, SUM(v1) OVER(ORDER BY v3 ROWS BETWEEN 2 PRECEDING AND 2 FOLLOWING) AS CNT FROM t1 ORDER BY v3;
-- result:
1	1	3
2	1	4
3	1	5
4	1	5
5	1	5
6	1	5
7	1	6
8	1	7
9	2	8
10	2	9
11	2	10
12	2	10
13	2	10
14	2	10
15	2	8
16	2	6
17	None	4
18	None	2
19	None	None
20	None	None
21	None	None
22	None	None
23	None	None
24	None	None
-- !result
SELECT v3, v1, SUM(v1) OVER(ORDER BY v3 ROWS BETWEEN 2 FOLLOWING AND 5 FOLLOWING) AS CNT FROM t1 ORDER BY v3;
-- result:
1	1	4
2	1	4
3	1	4
4	1	5
5	1	6
6	1	7
7	1	8
8	1	8
9	2	8
10	2	8
11	2	8
12	2	6
13	2	4
14	2	2
15	2	None
16	2	None
17	None	None
18	None	None
19	None	None
20	None	None
21	None	None
22	None	None
23	None	None
24	None	None
-- !result
SELECT v3, v1, SUM(v1) OVER(ORDER BY v3 ROWS BETWEEN 2 PRECEDING AND CURRENT ROW) AS CNT FROM t1 ORDER BY v3;
-- result:
1	1	1
2	1	2
3	1	3
4	1	3
5	1	3
6	1	3
7	1	3
8	1	3
9	2	4
10	2	5
11	2	6
12	2	6
13	2	6
14	2	6
15	2	6
16	2	6
17	None	4
18	None	2
19	None	None
20	None	None
21	None	None
22	None	None
23	None	None
24	None	None
-- !result
SELECT v3, v1, SUM(v1) OVER(ORDER BY v3 ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING) AS CNT FROM t1 ORDER BY v3;
-- result:
1	1	3
2	1	3
3	1	3
4	1	3
5	1	3
6	1	3
7	1	4
8	1	5
9	2	6
10	2	6
11	2	6
12	2	6
13	2	6
14	2	6
15	2	4
16	2	2
17	None	None
18	None	None
19	None	None
20	None	None
21	None	None
22	None	None
23	None	None
24	None	None
-- !result
SELECT v3, SUM(v3) OVER(ORDER BY v3 ROWS BETWEEN 5 PRECEDING AND 2 PRECEDING) AS CNT FROM t1 ORDER BY v3;
-- result:
1	None
2	None
3	1
4	3
5	6
6	10
7	14
8	18
9	22
10	26
11	30
12	34
13	38
14	42
15	46
16	50
17	54
18	58
19	62
20	66
21	70
22	74
23	78
24	82
-- !result
SELECT v3, SUM(v3) OVER(ORDER BY v3 ROWS BETWEEN 2 PRECEDING AND 2 FOLLOWING) AS CNT FROM t1 ORDER BY v3;
-- result:
1	6
2	10
3	15
4	20
5	25
6	30
7	35
8	40
9	45
10	50
11	55
12	60
13	65
14	70
15	75
16	80
17	85
18	90
19	95
20	100
21	105
22	110
23	90
24	69
-- !result
SELECT v3, SUM(v3) OVER(ORDER BY v3 ROWS BETWEEN 2 FOLLOWING AND 5 FOLLOWING) AS CNT FROM t1 ORDER BY v3;
-- result:
1	18
2	22
3	26
4	30
5	34
6	38
7	42
8	46
9	50
10	54
11	58
12	62
13	66
14	70
15	74
16	78
17	82
18	86
19	90
20	69
21	47
22	24
23	None
24	None
-- !result
SELECT v3, SUM(v3) OVER(ORDER BY v3 ROWS BETWEEN 2 PRECEDING AND CURRENT ROW) AS CNT FROM t1 ORDER BY v3;
-- result:
1	1
2	3
3	6
4	9
5	12
6	15
7	18
8	21
9	24
10	27
11	30
12	33
13	36
14	39
15	42
16	45
17	48
18	51
19	54
20	57
21	60
22	63
23	66
24	69
-- !result
SELECT v3, SUM(v3) OVER(ORDER BY v3 ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING) AS CNT FROM t1 ORDER BY v3;
-- result:
1	6
2	9
3	12
4	15
5	18
6	21
7	24
8	27
9	30
10	33
11	36
12	39
13	42
14	45
15	48
16	51
17	54
18	57
19	60
20	63
21	66
22	69
23	47
24	24
-- !result
SELECT v3, v1, AVG(v1) OVER(ORDER BY v3 ROWS BETWEEN 5 PRECEDING AND 2 PRECEDING) AS CNT FROM t1 ORDER BY v3;
-- result:
1	1	None
2	1	None
3	1	1.0
4	1	1.0
5	1	1.0
6	1	1.0
7	1	1.0
8	1	1.0
9	2	1.0
10	2	1.0
11	2	1.25
12	2	1.5
13	2	1.75
14	2	2.0
15	2	2.0
16	2	2.0
17	None	2.0
18	None	2.0
19	None	2.0
20	None	2.0
21	None	2.0
22	None	None
23	None	None
24	None	None
-- !result
SELECT v3, v1, AVG(v1) OVER(ORDER BY v3 ROWS BETWEEN 2 PRECEDING AND 2 FOLLOWING) AS CNT FROM t1 ORDER BY v3;
-- result:
1	1	1.0
2	1	1.0
3	1	1.0
4	1	1.0
5	1	1.0
6	1	1.0
7	1	1.2
8	1	1.4
9	2	1.6
10	2	1.8
11	2	2.0
12	2	2.0
13	2	2.0
14	2	2.0
15	2	2.0
16	2	2.0
17	None	2.0
18	None	2.0
19	None	None
20	None	None
21	None	None
22	None	None
23	None	None
24	None	None
-- !result
SELECT v3, v1, AVG(v1) OVER(ORDER BY v3 ROWS BETWEEN 2 FOLLOWING AND 5 FOLLOWING) AS CNT FROM t1 ORDER BY v3;
-- result:
1	1	1.0
2	1	1.0
3	1	1.0
4	1	1.25
5	1	1.5
6	1	1.75
7	1	2.0
8	1	2.0
9	2	2.0
10	2	2.0
11	2	2.0
12	2	2.0
13	2	2.0
14	2	2.0
15	2	None
16	2	None
17	None	None
18	None	None
19	None	None
20	None	None
21	None	None
22	None	None
23	None	None
24	None	None
-- !result
SELECT v3, v1, AVG(v1) OVER(ORDER BY v3 ROWS BETWEEN 2 PRECEDING AND CURRENT ROW) AS CNT FROM t1 ORDER BY v3;
-- result:
1	1	1.0
2	1	1.0
3	1	1.0
4	1	1.0
5	1	1.0
6	1	1.0
7	1	1.0
8	1	1.0
9	2	1.3333333333333333
10	2	1.6666666666666667
11	2	2.0
12	2	2.0
13	2	2.0
14	2	2.0
15	2	2.0
16	2	2.0
17	None	2.0
18	None	2.0
19	None	None
20	None	None
21	None	None
22	None	None
23	None	None
24	None	None
-- !result
SELECT v3, v1, AVG(v1) OVER(ORDER BY v3 ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING) AS CNT FROM t1 ORDER BY v3;
-- result:
1	1	1.0
2	1	1.0
3	1	1.0
4	1	1.0
5	1	1.0
6	1	1.0
7	1	1.3333333333333333
8	1	1.6666666666666667
9	2	2.0
10	2	2.0
11	2	2.0
12	2	2.0
13	2	2.0
14	2	2.0
15	2	2.0
16	2	2.0
17	None	None
18	None	None
19	None	None
20	None	None
21	None	None
22	None	None
23	None	None
24	None	None
-- !result
SELECT v3, AVG(v3) OVER(ORDER BY v3 ROWS BETWEEN 5 PRECEDING AND 2 PRECEDING) AS CNT FROM t1 ORDER BY v3;
-- result:
1	None
2	None
3	1.0
4	1.5
5	2.0
6	2.5
7	3.5
8	4.5
9	5.5
10	6.5
11	7.5
12	8.5
13	9.5
14	10.5
15	11.5
16	12.5
17	13.5
18	14.5
19	15.5
20	16.5
21	17.5
22	18.5
23	19.5
24	20.5
-- !result
SELECT v3, AVG(v3) OVER(ORDER BY v3 ROWS BETWEEN 2 PRECEDING AND 2 FOLLOWING) AS CNT FROM t1 ORDER BY v3;
-- result:
1	2.0
2	2.5
3	3.0
4	4.0
5	5.0
6	6.0
7	7.0
8	8.0
9	9.0
10	10.0
11	11.0
12	12.0
13	13.0
14	14.0
15	15.0
16	16.0
17	17.0
18	18.0
19	19.0
20	20.0
21	21.0
22	22.0
23	22.5
24	23.0
-- !result
SELECT v3, AVG(v3) OVER(ORDER BY v3 ROWS BETWEEN 2 FOLLOWING AND 5 FOLLOWING) AS CNT FROM t1 ORDER BY v3;
-- result:
1	4.5
2	5.5
3	6.5
4	7.5
5	8.5
6	9.5
7	10.5
8	11.5
9	12.5
10	13.5
11	14.5
12	15.5
13	16.5
14	17.5
15	18.5
16	19.5
17	20.5
18	21.5
19	22.5
20	23.0
21	23.5
22	24.0
23	None
24	None
-- !result
SELECT v3, AVG(v3) OVER(ORDER BY v3 ROWS BETWEEN 2 PRECEDING AND CURRENT ROW) AS CNT FROM t1 ORDER BY v3;
-- result:
1	1.0
2	1.5
3	2.0
4	3.0
5	4.0
6	5.0
7	6.0
8	7.0
9	8.0
10	9.0
11	10.0
12	11.0
13	12.0
14	13.0
15	14.0
16	15.0
17	16.0
18	17.0
19	18.0
20	19.0
21	20.0
22	21.0
23	22.0
24	23.0
-- !result
SELECT v3, AVG(v3) OVER(ORDER BY v3 ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING) AS CNT FROM t1 ORDER BY v3;
-- result:
1	2.0
2	3.0
3	4.0
4	5.0
5	6.0
6	7.0
7	8.0
8	9.0
9	10.0
10	11.0
11	12.0
12	13.0
13	14.0
14	15.0
15	16.0
16	17.0
17	18.0
18	19.0
19	20.0
20	21.0
21	22.0
22	23.0
23	23.5
24	24.0
-- !result