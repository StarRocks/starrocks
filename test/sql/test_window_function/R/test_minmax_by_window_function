-- name: test_minmax_by_window_function
CREATE TABLE `t1_nulls` (
  `v1` int NULL,
  `v2` bigint NULL,
  `v3` largeint NULL,
  `v4` string NULL,
  `v5` json NULL,
  `v6` map<int, string> NULL,
  `v7` array<int> NULL
) ENGINE=OLAP
DUPLICATE KEY(`v1`)
DISTRIBUTED BY HASH(`v1`) BUCKETS 10
PROPERTIES (
 "replication_num" = "1"
);
-- result:
-- !result
insert into t1_nulls SELECT generate_series, generate_series, generate_series, generate_series, generate_series, map(generate_series, generate_series), [generate_series] FROM TABLE(generate_series(1,  40960));
-- result:
-- !result
select count(mb), sum(mb) from (select min_by(v1, v1) over (partition by v1) mb from t1_nulls) t;
-- result:
40960	838881280
-- !result
select count(mb), sum(mb) from (select min_by(v2, v2) over (partition by v1) mb from t1_nulls) t;
-- result:
40960	838881280
-- !result
select count(mb), sum(mb) from (select min_by(v3, v3) over (partition by v1) mb from t1_nulls) t;
-- result:
40960	838881280
-- !result
select count(mb), max(mb) from (select min_by(v4, v4) over (partition by v1) mb from t1_nulls) t;
-- result:
40960	9999
-- !result
select count(mb), max(get_json_int(mb, "$")) from (select min_by(v5, v1) over (partition by v1) mb from t1_nulls) t;
-- result:
40960	40960
-- !result
CREATE TABLE `t1_not_nulls` (
  `v1` int,
  `v2` bigint,
  `v3` largeint,
  `v4` string,
  `v5` json,
  `v6` map<int, string>,
  `v7` array<int>
) ENGINE=OLAP
DUPLICATE KEY(`v1`)
DISTRIBUTED BY HASH(`v1`) BUCKETS 10
PROPERTIES (
 "replication_num" = "1"
);
-- result:
-- !result
insert into t1_not_nulls SELECT generate_series, generate_series, generate_series, generate_series, generate_series, map(generate_series, generate_series), [generate_series] FROM TABLE(generate_series(1,  40960));
-- result:
-- !result
select count(mb), sum(mb) from (select min_by(v1, v1) over (partition by v1) mb from t1_not_nulls) t;
-- result:
40960	838881280
-- !result
select count(mb), sum(mb) from (select min_by(v2, v2) over (partition by v1) mb from t1_not_nulls) t;
-- result:
40960	838881280
-- !result
select count(mb), sum(mb) from (select min_by(v3, v3) over (partition by v1) mb from t1_not_nulls) t;
-- result:
40960	838881280
-- !result
select count(mb), max(mb) from (select min_by(v4, v4) over (partition by v1) mb from t1_not_nulls) t;
-- result:
40960	9999
-- !result
select count(mb), max(get_json_int(mb, "$")) from (select min_by(v5, v1) over (partition by v1) mb from t1_not_nulls) t;
-- result:
40960	40960
-- !result