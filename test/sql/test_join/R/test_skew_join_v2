-- name: test_skew_join_v2
CREATE TABLE t1 (
    c_key      INT NOT NULL,
    c_tinyint  TINYINT,
    c_smallint SMALLINT,
    c_int      INT,
    c_bigint   BIGINT,
    c_largeint LARGEINT,
    c_float    FLOAT,
    c_double   DOUBLE,
    c_decimal  DECIMAL(26,2),
    c_date     DATE,
    c_datetime DATETIME,
    c_string   STRING
)
DUPLICATE KEY(c_key)
DISTRIBUTED BY HASH(c_key) BUCKETS 1
PROPERTIES (
    "replication_num"="1"
);
-- result:
-- !result
CREATE TABLE t2 (
    c_key      INT NOT NULL,
    c_tinyint  TINYINT,
    c_smallint SMALLINT,
    c_int      INT,
    c_bigint   BIGINT,
    c_largeint LARGEINT,
    c_float    FLOAT,
    c_double   DOUBLE,
    c_decimal  DECIMAL(26,2),
    c_date     DATE,
    c_datetime DATETIME,
    c_string   STRING
)
DUPLICATE KEY(c_key)
DISTRIBUTED BY HASH(c_key) BUCKETS 1
PROPERTIES (
    "replication_num"="1"
);
-- result:
-- !result
set enable_optimize_skew_join_v1=false;
-- result:
-- !result
set enable_optimize_skew_join_v2=true;
-- result:
-- !result
truncate table t1;
-- result:
-- !result
truncate table t2;
-- result:
-- !result
insert into t1(c_key, c_tinyint) values (1, 1), (2, 1), (3, 1), (4, 2), (5, 2), (6, 3);
-- result:
-- !result
insert into t2(c_key, c_tinyint) values (1, 1), (2, 2), (3, 3);
-- result:
-- !result
select t1.c_key, t2.c_key from t1 join [skew|t1.c_tinyint(1,2,8)] t2 on t1.c_tinyint=t2.c_tinyint order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
select t1.c_key, t2.c_key from t2 join [skew|t1.c_tinyint(1,2,8)] t1 on t1.c_tinyint=t2.c_tinyint order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
select t1.c_key, t2.c_key from t1 left join [skew|t1.c_tinyint(1,2,8)] t2 on t1.c_tinyint=t2.c_tinyint order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
select t1.c_key, t2.c_key from t2 left join [skew|t1.c_tinyint(1,2,8)] t1 on t1.c_tinyint=t2.c_tinyint order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
truncate table t1;
-- result:
-- !result
truncate table t2;
-- result:
-- !result
insert into t1(c_key, c_smallint) values (1, 1), (2, 1), (3, 1), (4, 1111), (5, 1111), (6, 3);
-- result:
-- !result
insert into t2(c_key, c_smallint) values (1, 1), (2, 1111), (3, 3);
-- result:
-- !result
select t1.c_key, t2.c_key from t1 join [skew|t1.c_smallint(1,1111,4444)] t2 on t1.c_smallint=t2.c_smallint order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
select t1.c_key, t2.c_key from t2 join [skew|t1.c_smallint(1,1111,4444)] t1 on t1.c_smallint=t2.c_smallint order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
select t1.c_key, t2.c_key from t1 left join [skew|t1.c_smallint(1,1111,4444)] t2 on t1.c_smallint=t2.c_smallint order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
select t1.c_key, t2.c_key from t2 left join [skew|t1.c_smallint(1,1111,4444)] t1 on t1.c_smallint=t2.c_smallint order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
truncate table t1;
-- result:
-- !result
truncate table t2;
-- result:
-- !result
insert into t1(c_key, c_int) values (1, 1), (2, 1), (3, 1), (4, 1234567), (5, 1234567), (6, 3);
-- result:
-- !result
insert into t2(c_key, c_int) values (1, 1), (2, 1234567), (3, 3);
-- result:
-- !result
select t1.c_key, t2.c_key from t1 join [skew|t1.c_int(1,1234567,4444)] t2 on t1.c_int=t2.c_int order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
select t1.c_key, t2.c_key from t2 join [skew|t1.c_int(1,1234567,4444)] t1 on t1.c_int=t2.c_int order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
select t1.c_key, t2.c_key from t1 left join [skew|t1.c_int(1,1234567,4444)] t2 on t1.c_int=t2.c_int order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
select t1.c_key, t2.c_key from t2 left join [skew|t1.c_int(1,1234567,4444)] t1 on t1.c_int=t2.c_int order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
truncate table t1;
-- result:
-- !result
truncate table t2;
-- result:
-- !result
insert into t1(c_key, c_bigint) values (1, 1), (2, 1), (3, 1), (4, 12345678912), (5, 12345678912), (6, 3);
-- result:
-- !result
insert into t2(c_key, c_bigint) values (1, 1), (2, 12345678912), (3, 3);
-- result:
-- !result
select t1.c_key, t2.c_key from t1 join [skew|t1.c_bigint(1,12345678912,4444)] t2 on t1.c_bigint=t2.c_bigint order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
select t1.c_key, t2.c_key from t2 join [skew|t1.c_bigint(1,12345678912,4444)] t1 on t1.c_bigint=t2.c_bigint order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
select t1.c_key, t2.c_key from t1 left join [skew|t1.c_bigint(1,12345678912,4444)] t2 on t1.c_bigint=t2.c_bigint order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
select t1.c_key, t2.c_key from t2 left join [skew|t1.c_bigint(1,12345678912,4444)] t1 on t1.c_bigint=t2.c_bigint order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
truncate table t1;
-- result:
-- !result
truncate table t2;
-- result:
-- !result
insert into t1(c_key, c_largeint) values (1, 1), (2, 1), (3, 1), (4, 18446744073709551620), (5, 18446744073709551620), (6, 3);
-- result:
-- !result
insert into t2(c_key, c_largeint) values (1, 1), (2, 18446744073709551620), (3, 3);
-- result:
-- !result
select t1.c_key, t2.c_key from t1 join [skew|t1.c_largeint(1,18446744073709551620,4444)] t2 on t1.c_largeint=t2.c_largeint order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
select t1.c_key, t2.c_key from t2 join [skew|t1.c_largeint(1,18446744073709551620,4444)] t1 on t1.c_largeint=t2.c_largeint order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
select t1.c_key, t2.c_key from t1 left join [skew|t1.c_largeint(1,18446744073709551620,4444)] t2 on t1.c_largeint=t2.c_largeint order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
select t1.c_key, t2.c_key from t2 left join [skew|t1.c_largeint(1,18446744073709551620,4444)] t1 on t1.c_largeint=t2.c_largeint order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
truncate table t1;
-- result:
-- !result
truncate table t2;
-- result:
-- !result
insert into t1(c_key, c_float) values (1, 1.1), (2, 1.1), (3, 1.1), (4, 2.1), (5, 2.1), (6, 3);
-- result:
-- !result
insert into t2(c_key, c_float) values (1, 1.1), (2, 2.1), (3, 3);
-- result:
-- !result
select t1.c_key, t2.c_key from t1 join [skew|t1.c_float(1.1,2.1,4444)] t2 on t1.c_float=t2.c_float order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
select t1.c_key, t2.c_key from t2 join [skew|t1.c_float(1.1,2.1,4444)] t1 on t1.c_float=t2.c_float order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
select t1.c_key, t2.c_key from t1 left join [skew|t1.c_float(1.1,2.1,4444)] t2 on t1.c_float=t2.c_float order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
select t1.c_key, t2.c_key from t2 left join [skew|t1.c_float(1.1,2.1,4444)] t1 on t1.c_float=t2.c_float order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
truncate table t1;
-- result:
-- !result
truncate table t2;
-- result:
-- !result
insert into t1(c_key, c_double) values (1, 1.1), (2, 1.1), (3, 1.1), (4, 2.1), (5, 2.1), (6, 3);
-- result:
-- !result
insert into t2(c_key, c_double) values (1, 1.1), (2, 2.1), (3, 3);
-- result:
-- !result
select t1.c_key, t2.c_key from t1 join [skew|t1.c_double(1.1,2.1,4444)] t2 on t1.c_double=t2.c_double order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
select t1.c_key, t2.c_key from t2 join [skew|t1.c_double(1.1,2.1,4444)] t1 on t1.c_double=t2.c_double order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
select t1.c_key, t2.c_key from t1 left join [skew|t1.c_double(1.1,2.1,4444)] t2 on t1.c_double=t2.c_double order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
select t1.c_key, t2.c_key from t2 left join [skew|t1.c_double(1.1,2.1,4444)] t1 on t1.c_double=t2.c_double order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
truncate table t1;
-- result:
-- !result
truncate table t2;
-- result:
-- !result
insert into t1(c_key, c_decimal) values (1, 1.1), (2, 1.1), (3, 1.1), (4, 2.1), (5, 2.1), (6, 3);
-- result:
-- !result
insert into t2(c_key, c_decimal) values (1, 1.1), (2, 2.1), (3, 3);
-- result:
-- !result
select t1.c_key, t2.c_key from t1 join [skew|t1.c_decimal(1.1,2.1,4444)] t2 on t1.c_decimal=t2.c_decimal order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
select t1.c_key, t2.c_key from t2 join [skew|t1.c_decimal(1.1,2.1,4444)] t1 on t1.c_decimal=t2.c_decimal order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
select t1.c_key, t2.c_key from t1 left join [skew|t1.c_decimal(1.1,2.1,4444)] t2 on t1.c_decimal=t2.c_decimal order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
select t1.c_key, t2.c_key from t2 left join [skew|t1.c_decimal(1.1,2.1,4444)] t1 on t1.c_decimal=t2.c_decimal order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
truncate table t1;
-- result:
-- !result
truncate table t2;
-- result:
-- !result
insert into t1(c_key, c_date) values
    (1, "2024-01-01"), (2, "2024-01-01"), (3, "2024-01-01"),
    (4, "2024-01-02"), (5, "2024-01-02"), (6, "2024-01-03");
-- result:
-- !result
insert into t2(c_key, c_date) values (1, "2024-01-01"), (2, "2024-01-02"), (3, "2024-01-03");
-- result:
-- !result
select t1.c_key, t2.c_key from t1 join [skew|t1.c_date("2024-01-01","2024-01-02","2024-01-04")] t2 on t1.c_date=t2.c_date order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
select t1.c_key, t2.c_key from t2 join [skew|t1.c_date("2024-01-01","2024-01-02","2024-01-04")] t1 on t1.c_date=t2.c_date order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
select t1.c_key, t2.c_key from t1 left join [skew|t1.c_date("2024-01-01","2024-01-02","2024-01-04")] t2 on t1.c_date=t2.c_date order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
select t1.c_key, t2.c_key from t2 left join [skew|t1.c_date("2024-01-01","2024-01-02","2024-01-04")] t1 on t1.c_date=t2.c_date order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
truncate table t1;
-- result:
-- !result
truncate table t2;
-- result:
-- !result
insert into t1(c_key, c_datetime) values
    (1, "2024-01-01 00:00:00"),
    (2, "2024-01-01 00:00:00"),
    (3, "2024-01-01 00:00:00"),
    (4, "2024-01-02 00:00:00"),
    (5, "2024-01-02 00:00:00"),
    (6, "2024-01-03 00:00:00");
-- result:
-- !result
insert into t2(c_key, c_datetime) values
    (1, "2024-01-01 00:00:00"),
    (2, "2024-01-02 00:00:00"),
    (3, "2024-01-03 00:00:00");
-- result:
-- !result
select t1.c_key, t2.c_key from t1 join [skew|t1.c_datetime("2024-01-01 00:00:00","2024-01-02","2024-01-04")] t2 on t1.c_datetime=t2.c_datetime order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
select t1.c_key, t2.c_key from t2 join [skew|t1.c_datetime("2024-01-01 00:00:00","2024-01-02","2024-01-04")] t1 on t1.c_datetime=t2.c_datetime order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
select t1.c_key, t2.c_key from t1 left join [skew|t1.c_datetime("2024-01-01 00:00:00","2024-01-02","2024-01-04")] t2 on t1.c_datetime=t2.c_datetime order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
select t1.c_key, t2.c_key from t2 left join [skew|t1.c_datetime("2024-01-01 00:00:00","2024-01-02","2024-01-04")] t1 on t1.c_datetime=t2.c_datetime order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
truncate table t1;
-- result:
-- !result
truncate table t2;
-- result:
-- !result
insert into t1(c_key, c_string) values ("1", "1"), ("2", "1"), ("3", "1"), ("4", "1234567"), ("5", "1234567"), ("6", "3");
-- result:
-- !result
insert into t2(c_key, c_string) values ("1", "1"), ("2", "1234567"), ("3", "3");
-- result:
-- !result
select t1.c_key, t2.c_key from t1 join [skew|t1.c_string("1","1234567","4444")] t2 on t1.c_string=t2.c_string order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
select t1.c_key, t2.c_key from t2 join [skew|t1.c_string("1","1234567","4444")] t1 on t1.c_string=t2.c_string order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
select t1.c_key, t2.c_key from t1 left join [skew|t1.c_string("1","1234567","4444")] t2 on t1.c_string=t2.c_string order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
select t1.c_key, t2.c_key from t2 left join [skew|t1.c_string("1","1234567","4444")] t1 on t1.c_string=t2.c_string order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
truncate table t1;
-- result:
-- !result
truncate table t2;
-- result:
-- !result
insert into t1(c_key, c_int) values (1, 1), (2, 1), (3, 1), (4, 1234567), (5, 1234567), (6, 3);
-- result:
-- !result
insert into t2(c_key, c_bigint) values (1, 1), (2, 1234567), (3, 3);
-- result:
-- !result
select t1.c_key, t2.c_key from t1 join [skew|t1.c_int(1,2,99999)] t2 on t1.c_int=t2.c_bigint order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
select t1.c_key, t2.c_key from t2 join [skew|t1.c_int(1,2,99999)] t1 on t1.c_int=t2.c_bigint order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
select t1.c_key, t2.c_key from t1 left join [skew|t1.c_int(1,2,99999)] t2 on t1.c_int=t2.c_bigint order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
select t1.c_key, t2.c_key from t2 left join [skew|t1.c_int(1,2,99999)] t1 on t1.c_int=t2.c_bigint order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
truncate table t1;
-- result:
-- !result
truncate table t2;
-- result:
-- !result
insert into t1(c_key, c_bigint) values (1, 1), (2, 1), (3, 1), (4, 1234567), (5, 1234567), (6, 3);
-- result:
-- !result
insert into t2(c_key, c_int) values (1, 1), (2, 1234567), (3, 3);
-- result:
-- !result
select t1.c_key, t2.c_key from t1 join [skew|t1.c_bigint(1,2,99999)] t2 on t1.c_bigint=t2.c_int order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
select t1.c_key, t2.c_key from t2 join [skew|t1.c_bigint(1,2,99999)] t1 on t1.c_bigint=t2.c_int order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
select t1.c_key, t2.c_key from t1 left join [skew|t1.c_bigint(1,2,99999)] t2 on t1.c_bigint=t2.c_int order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
select t1.c_key, t2.c_key from t2 left join [skew|t1.c_bigint(1,2,99999)] t1 on t1.c_bigint=t2.c_int order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
select t1.c_key, t2.c_key from t2 join [skew|t2.c_int(1,2,99999)] t1 on abs(t1.c_bigint)=abs(t2.c_int) order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
select t1.c_key, t2.c_key from t2 join [skew|t2.c_int(1,2,99999)] t1 on abs(t2.c_int) = abs(t1.c_bigint) order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
select t1.c_key, t2.c_key from t2 join [skew|t2.c_int(1,2,99999)] t1 on t1.c_key = t2.c_key and abs(t2.c_int) = abs(t1.c_bigint) order by t1.c_key, t2.c_key;
-- result:
1	1
-- !result
select t1.c_key, t2.c_key from t1 join [skew|t2.c_int(1,2,99999)] t2 on t1.c_key = t2.c_key and abs(t1.c_bigint) = abs(t2.c_int) order by t1.c_key, t2.c_key;
-- result:
1	1
-- !result
truncate table t1;
-- result:
-- !result
truncate table t2;
-- result:
-- !result
insert into t1(c_key, c_bigint) values (1, null), (2, 1), (3, 2), (4, -1);
-- result:
-- !result
insert into t2(c_key, c_int) values (1, 1), (2, 2), (3, 3);
-- result:
-- !result
function: assert_explain_contains("select count(*) from t1 left join [skew|t1.c_bigint(1,2,null)] t2 on abs(t1.c_bigint)=abs(t2.c_int)", "SplitCastDataSink", "IN (abs[(1)", "IN (")
-- result:
None
-- !result
function: assert_explain_contains("select count(*) from t1 left join [skew|t1.c_bigint(null)] t2 on abs(t1.c_bigint)=abs(t2.c_int)", "SplitCastDataSink")
-- result:
None
-- !result
truncate table t1;
-- result:
-- !result
truncate table t2;
-- result:
-- !result
insert into t1(c_key, c_string) values (1, "1"), (2, "1"), (3, "1"), (4, "1234567"), (5, "1234567"), (6, "3");
-- result:
-- !result
insert into t2(c_key, c_int) values (1, 1), (2, 1234567), (3, 3);
-- result:
-- !result
select t1.c_key, t2.c_key from t1 join [skew|t1.c_string("1","2","99999")] t2 on t1.c_string=t2.c_int order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
select t1.c_key, t2.c_key from t2 join [skew|t1.c_string("1","2","99999")] t1 on t1.c_string=t2.c_int order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
select t1.c_key, t2.c_key from t1 left join [skew|t1.c_string("1","2","99999)] t2 on t1.c_string=t2.c_int order by t1.c_key, t2.c_key;
-- result:
E: (1064, "Getting syntax error at line 1, column 134. Detail message: Unexpected input '<EOF>', the most similar input is {SINGLE_QUOTED_TEXT, 'CEIL', 'FALSE', 'DATETIME', 'INTERVAL', '?', '-'}.")
-- !result
select t1.c_key, t2.c_key from t2 left join [skew|t1.c_string("1","2","99999)] t1 on t1.c_string=t2.c_int order by t1.c_key, t2.c_key;
-- result:
E: (1064, "Getting syntax error at line 1, column 134. Detail message: Unexpected input '<EOF>', the most similar input is {SINGLE_QUOTED_TEXT, 'CEIL', 'FALSE', 'DATETIME', 'INTERVAL', '?', '-'}.")
-- !result
truncate table t1;
-- result:
-- !result
truncate table t2;
-- result:
-- !result
insert into t1(c_key, c_bigint) values (1, 1), (2, 1), (3, 1), (4, 1234567), (5, 1234567), (6, 3);
-- result:
-- !result
insert into t2(c_key, c_int) values (1, 1), (2, 1234567), (3, 3);
-- result:
-- !result
select t1.c_key, t2.c_key from t1 join [skew|t1.c_bigint(1,2,99999)] t2 on t1.c_bigint=t2.c_int order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
select t1.c_key, t2.c_key from t2 join [skew|t1.c_bigint(1,2,99999)] t1 on t1.c_bigint=t2.c_int order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
select t1.c_key, t2.c_key from t1 left join [skew|t1.c_bigint(1,2,99999)] t2 on t1.c_bigint=t2.c_int order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
select t1.c_key, t2.c_key from t2 left join [skew|t1.c_bigint(1,2,99999)] t1 on t1.c_bigint=t2.c_int order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
select t1.c_key, t2.c_key from t1 left join [skew|t1.c_bigint(1,2,99999)] t2 on t1.c_bigint=t2.c_int order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
select t1.c_key, t2.c_key from t2 left join [skew|t1.c_bigint(1,2,99999)] t1 on t1.c_bigint=t2.c_int order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
select t1.c_key, t2.c_key from t1 join [skew|t1.c_bigint(1,2,99999)] t2 on t1.c_bigint=t2.c_int and t1.c_key = t2.c_key order by t1.c_key, t2.c_key;
-- result:
1	1
-- !result
select t1.c_key, t2.c_key from t2 join [skew|t1.c_bigint(1,2,99999)] t1 on t1.c_bigint=t2.c_int and t1.c_key = t2.c_key order by t1.c_key, t2.c_key;
-- result:
1	1
-- !result
select t1.c_key, t2.c_key from t1 left join [skew|t1.c_bigint(1,2,99999)] t2 on t1.c_bigint=t2.c_int and t1.c_key = t2.c_key order by t1.c_key, t2.c_key;
-- result:
1	1
2	None
3	None
4	None
5	None
6	None
-- !result
select t1.c_key, t2.c_key from t2 left join [skew|t1.c_bigint(1,2,99999)] t1 on t1.c_bigint=t2.c_int and t1.c_key = t2.c_key order by t1.c_key, t2.c_key;
-- result:
None	2
None	3
1	1
-- !result
select t1.c_key, t2.c_key from t1 join [skew|t1.c_bigint(1,2,99999)] t2 on t1.c_bigint=t2.c_int order by t1.c_key, t2.c_key limit 2;
-- result:
1	1
2	1
-- !result
select t1.c_key, t2.c_key from t2 join [skew|t1.c_bigint(1,2,99999)] t1 on t1.c_bigint=t2.c_int order by t1.c_key, t2.c_key limit 2;
-- result:
1	1
2	1
-- !result
select t1.c_key, t2.c_key from t1 left join [skew|t1.c_bigint(1,2,99999)] t2 on t1.c_bigint=t2.c_int order by t1.c_key, t2.c_key limit 2;
-- result:
1	1
2	1
-- !result
select t1.c_key, t2.c_key from t2 left join [skew|t1.c_bigint(1,2,99999)] t1 on t1.c_bigint=t2.c_int order by t1.c_key, t2.c_key limit 2;
-- result:
1	1
2	1
-- !result
select t1.c_key, t2.c_key from t1 join [skew|t1.c_bigint(555,666,777)] t2 on t1.c_bigint=t2.c_int order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
select t1.c_key, t2.c_key from t2 join [skew|t1.c_bigint(555,666,777)] t1 on t1.c_bigint=t2.c_int order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
select t1.c_key, t2.c_key from t1 left join [skew|t1.c_bigint(555,666,777)] t2 on t1.c_bigint=t2.c_int order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
select t1.c_key, t2.c_key from t2 left join [skew|t1.c_bigint(555,666,777)] t1 on t1.c_bigint=t2.c_int order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
select t1.c_key, t2.c_key from t1 join [skew|t1.c_bigint(1,1234567,3)] t2 on t1.c_bigint=t2.c_int order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
select t1.c_key, t2.c_key from t2 join [skew|t1.c_bigint(1,1234567,3)] t1 on t1.c_bigint=t2.c_int order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
select t1.c_key, t2.c_key from t1 left join [skew|t1.c_bigint(1,1234567,3)] t2 on t1.c_bigint=t2.c_int order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
select t1.c_key, t2.c_key from t2 left join [skew|t1.c_bigint(1,1234567,3)] t1 on t1.c_bigint=t2.c_int order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
insert into t1(c_key, c_bigint) values (7,4);
-- result:
-- !result
insert into t2(c_key, c_int) values (4,9);
-- result:
-- !result
select t1.c_key, t2.c_key from t1 join [skew|t1.c_bigint(1,1234567,3,4)] t2 on t1.c_bigint=t2.c_int order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
select t1.c_key, t2.c_key from t2 join [skew|t1.c_bigint(1,1234567,3,4)] t1 on t1.c_bigint=t2.c_int order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
select t1.c_key, t2.c_key from t1 left join [skew|t1.c_bigint(1,1234567,3,4)] t2 on t1.c_bigint=t2.c_int order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
7	None
-- !result
select t1.c_key, t2.c_key from t2 left join [skew|t1.c_bigint(1,1234567,3,4)] t1 on t1.c_bigint=t2.c_int order by t1.c_key, t2.c_key;
-- result:
None	4
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
select t1.c_key, t2.c_key from t1 join [skew|t1.c_bigint(1,1234567,3,4)] t2 on t1.c_bigint=t2.c_int order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
select t1.c_key, t2.c_key from t2 join [skew|t1.c_bigint(1,1234567,3,4)] t1 on t1.c_bigint=t2.c_int order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
select t1.c_key, t2.c_key from t1 left join [skew|t1.c_bigint(1,1234567,3,4)] t2 on t1.c_bigint=t2.c_int order by t1.c_key, t2.c_key;
-- result:
1	1
2	1
3	1
4	2
5	2
6	3
7	None
-- !result
select t1.c_key, t2.c_key from t2 left join [skew|t1.c_bigint(1,1234567,3,4)] t1 on t1.c_bigint=t2.c_int order by t1.c_key, t2.c_key;
-- result:
None	4
1	1
2	1
3	1
4	2
5	2
6	3
-- !result
select sum(t1.c_key), t1.c_bigint from t1 join [skew|t1.c_bigint(1,2,99999)] t2 on t1.c_bigint=t2.c_int group by t1.c_bigint order by c_bigint limit 1;
-- result:
6	1
-- !result
select sum(t2.c_key), t2.c_bigint from t2 join [skew|t1.c_bigint(1,2,99999)] t1 on t1.c_bigint=t2.c_int group by t2.c_bigint;
-- result:
10	None
-- !result
select sum(t1.c_key), t1.c_bigint from t1 left join [skew|t1.c_bigint(1,2,99999)] t2 on t1.c_bigint=t2.c_int group by t1.c_bigint order by c_bigint limit 1;
-- result:
6	1
-- !result
select sum(t2.c_key), t2.c_bigint from t2 left join [skew|t1.c_bigint(1,2,99999)] t1 on t1.c_bigint=t2.c_int group by t2.c_bigint;
-- result:
14	None
-- !result
select sum(t1.c_key), t2.c_bigint from t1 join [skew|t1.c_bigint(1,2,99999)] t2 on t1.c_bigint=t2.c_int group by t2.c_bigint;
-- result:
21	None
-- !result
select sum(t2.c_key), t2.c_bigint from t2 join [skew|t1.c_bigint(1,2,99999)] t1 on t1.c_bigint=t2.c_int group by t2.c_bigint;
-- result:
10	None
-- !result
select sum(t1.c_key), t2.c_bigint from t1 left join [skew|t1.c_bigint(1,2,99999)] t2 on t1.c_bigint=t2.c_int group by t2.c_bigint;
-- result:
28	None
-- !result
select sum(t2.c_key), t2.c_bigint from t2 left join [skew|t1.c_bigint(1,2,99999)] t1 on t1.c_bigint=t2.c_int group by t2.c_bigint;
-- result:
14	None
-- !result
CREATE TABLE skew_t1 (
    c_key      INT NOT NULL,
    c_tinyint  TINYINT,
    c_smallint SMALLINT,
    c_int      INT,
    c_bigint   BIGINT,
    c_largeint LARGEINT,
    c_float    FLOAT,
    c_double   DOUBLE,
    c_decimal  DECIMAL(26,2),
    c_date     DATE,
    c_datetime DATETIME,
    c_string   STRING
)
DUPLICATE KEY(c_key)
DISTRIBUTED BY HASH(c_key) BUCKETS 1
PROPERTIES (
    "replication_num"="1"
);
-- result:
-- !result
INSERT INTO skew_t1(c_key, c_tinyint, c_smallint, c_int, c_bigint, c_largeint, c_float, c_double, c_decimal, c_date, c_datetime, c_string)
SELECT t.c_key, t.c_key % 100 as c_tinyint, t.c_key % 1000 as c_smallint, t.c_key % 10000 as c_int, t.c_key % 100000 as c_bigint, t.c_key % 1000000 as c_largeint, t.c_key % 10000000 as c_float, t.c_key % 100000000 as c_double, t.c_key % 1000000000 as c_decimal, t.c_key % 10000000000 as c_date, t.c_key % 100000000000 as c_datetime, t.c_key % 1000000000000 as c_string
FROM TABLE(generate_series(1, 4095*2)) t(c_key);
-- result:
-- !result
INSERT INTO t2(c_key, c_tinyint, c_smallint, c_int, c_bigint, c_largeint, c_float, c_double, c_decimal, c_date, c_datetime, c_string)
SELECT t.c_key, t.c_key % 100 as c_tinyint, t.c_key % 1000 as c_smallint, t.c_key % 10000 as c_int, t.c_key % 100000 as c_bigint, t.c_key % 1000000 as c_largeint, t.c_key % 10000000 as c_float, t.c_key % 100000000 as c_double, t.c_key % 1000000000 as c_decimal, t.c_key % 10000000000 as c_date, t.c_key % 100000000000 as c_datetime, t.c_key % 1000000000000 as c_string
FROM TABLE(generate_series(1, 4095*2)) t(c_key);
-- result:
-- !result
INSERT INTO skew_t1(c_key, c_tinyint, c_smallint, c_int, c_bigint, c_largeint, c_float, c_double, c_decimal, c_date, c_datetime, c_string)
SELECT t.c_key % 1, t.c_key % 1 as c_tinyint, t.c_key % 1 as c_smallint, t.c_key % 1 as c_int, t.c_key % 1 as c_bigint, t.c_key % 1 as c_largeint, t.c_key % 1 as c_float, t.c_key % 1 as c_double, t.c_key % 1 as c_decimal, t.c_key % 1 as c_date, t.c_key % 1 as c_datetime, t.c_key % 1 as c_string
FROM TABLE(generate_series(1, 4095*2)) t(c_key);
-- result:
-- !result
select count(1) from skew_t1 as t1 join [skew|t1.c_bigint(1,2,99999)] t2 on t1.c_bigint=t2.c_int;
-- result:
8193
-- !result
select count(1) from t2 join [skew|t1.c_bigint(1,2,99999)] skew_t1 as t1 on t1.c_bigint=t2.c_int;
-- result:
8193
-- !result
select count(1) from skew_t1 as t1 join [skew|t1.c_bigint(1,2,99999)] t2 on t1.c_bigint=t2.c_bigint;
-- result:
8190
-- !result
select count(1) from t2 join [skew|t1.c_bigint(1,2,99999)] skew_t1 as t1 on t1.c_bigint=t2.c_bigint;
-- result:
8190
-- !result
select count(1) from skew_t1 as t1 join [skew|t1.c_bigint(1,2,99999)] t2 on t1.c_smallint=t2.c_smallint;
-- result:
132750
-- !result
select count(1) from skew_t1 as t1 join [skew|t1.c_bigint(1,2,99999)] t2 on t1.c_int=t2.c_int;
-- result:
8193
-- !result
select count(1) from skew_t1 as t1 join [skew|t1.c_bigint(1,2,99999)] t2 on t1.c_float=t2.c_float;
-- result:
8190
-- !result
select count(1) from skew_t1 as t1 join [skew|t1.c_bigint(1,2,99999)] t2 on t1.c_double=t2.c_double;
-- result:
8190
-- !result
select count(1) from skew_t1 as t1 join [skew|t1.c_bigint(1,2,99999)] t2 on t1.c_decimal=t2.c_decimal;
-- result:
8190
-- !result
select count(1) from skew_t1 as t1 join [skew|t1.c_bigint(1,2,99999)] t2 on t1.c_date=t2.c_date;
-- result:
366
-- !result
select count(1) from skew_t1 as t1 join [skew|t1.c_bigint(1,2,99999)] t2 on t1.c_datetime=t2.c_datetime;
-- result:
366
-- !result
select count(1) from skew_t1 as t1 join [skew|t1.c_bigint(1,2,99999)] t2 on t1.c_string=t2.c_string;
-- result:
8190
-- !result
select count(1) from skew_t1 as t1 left join [skew|t1.c_bigint(1,2,99999)] t2 on t1.c_bigint=t2.c_int;
-- result:
16383
-- !result
select count(1) from t2 left join [skew|t1.c_bigint(1,2,99999)] skew_t1 as t1 on t1.c_bigint=t2.c_int;
-- result:
8194
-- !result
select count(1) from skew_t1 as t1 left join [skew|t1.c_bigint(1,2,99999)] t2 on t1.c_bigint=t2.c_bigint;
-- result:
16380
-- !result
select count(1) from t2 left join [skew|t1.c_bigint(1,2,99999)] skew_t1 as t1 on t1.c_bigint=t2.c_bigint;
-- result:
8194
-- !result
select count(1) from skew_t1 as t1 left join [skew|t1.c_bigint(1,2,99999)] t2 on t1.c_smallint=t2.c_smallint;
-- result:
132750
-- !result
select count(1) from skew_t1 as t1 left join [skew|t1.c_bigint(1,2,99999)] t2 on t1.c_int=t2.c_int;
-- result:
16383
-- !result
select count(1) from skew_t1 as t1 left join [skew|t1.c_bigint(1,2,99999)] t2 on t1.c_float=t2.c_float;
-- result:
16380
-- !result
select count(1) from skew_t1 as t1 left join [skew|t1.c_bigint(1,2,99999)] t2 on t1.c_double=t2.c_double;
-- result:
16380
-- !result
select count(1) from skew_t1 as t1 left join [skew|t1.c_bigint(1,2,99999)] t2 on t1.c_decimal=t2.c_decimal;
-- result:
16380
-- !result
select count(1) from skew_t1 as t1 left join [skew|t1.c_bigint(1,2,99999)] t2 on t1.c_date=t2.c_date;
-- result:
16380
-- !result
select count(1) from skew_t1 as t1 left join [skew|t1.c_bigint(1,2,99999)] t2 on t1.c_datetime=t2.c_datetime;
-- result:
16380
-- !result
select count(1) from skew_t1 as t1 left join [skew|t1.c_bigint(1,2,99999)] t2 on t1.c_string=t2.c_string;
-- result:
16380
-- !result
drop table if exists t_mcv_l;
-- result:
-- !result
drop table if exists t_mcv_r;
-- result:
-- !result
create table t_mcv_l (
    k bigint null,
    v int null
)
duplicate key(k)
distributed by hash(k) buckets 1
properties("replication_num"="1");
-- result:
-- !result
create table t_mcv_r (
    k bigint null,
    v int null
)
duplicate key(k)
distributed by hash(k) buckets 1
properties("replication_num"="1");
-- result:
-- !result
set enable_stats_to_optimize_skew_join = true;
-- result:
-- !result
set skew_join_use_mcv_count = 5;
-- result:
-- !result
set skew_join_data_skew_threshold = 0.1;
-- result:
-- !result
set skew_join_mcv_single_threshold = 0.05;
-- result:
-- !result
set skew_join_mcv_min_input_rows = 1000;
-- result:
-- !result
set broadcast_row_limit = 0;
-- result:
-- !result
insert into t_mcv_l select 1, 1 from table(generate_series(1, 5000));
-- result:
-- !result
insert into t_mcv_l select 2, 1 from table(generate_series(1, 2500));
-- result:
-- !result
insert into t_mcv_l select generate_series + 2, 1 from table(generate_series(1, 2500));
-- result:
-- !result
insert into t_mcv_r select (generate_series % 2502) + 1, 1 from table(generate_series(1, 20000));
-- result:
-- !result
[UC] analyze full table t_mcv_l;
-- result:
test_db_5f945d55a63b4408a30c60ccc09dd5c1.t_mcv_l	analyze	status	OK
-- !result
[UC] analyze full table t_mcv_r;
-- result:
test_db_5f945d55a63b4408a30c60ccc09dd5c1.t_mcv_r	analyze	status	OK
-- !result
[UC] analyze table t_mcv_l update histogram on k properties('histogram_sample_ratio' = '1.0', 'histogram_mcv_size' = '20');
-- result:
test_db_5f945d55a63b4408a30c60ccc09dd5c1.t_mcv_l	histogram	status	OK
-- !result
[UC] analyze table t_mcv_r update histogram on k properties('histogram_sample_ratio' = '1.0', 'histogram_mcv_size' = '20');
-- result:
test_db_5f945d55a63b4408a30c60ccc09dd5c1.t_mcv_r	histogram	status	OK
-- !result
function: assert_explain_contains("select count(*) from t_mcv_l join[shuffle] t_mcv_r on t_mcv_l.k = t_mcv_r.k", "SplitCastDataSink")
-- result:
None
-- !result
function: assert_explain_contains("select count(*) from t_mcv_l join[shuffle] t_mcv_r on t_mcv_l.k = t_mcv_r.k", "IN (1, 2)")
-- result:
None
-- !result
function: assert_explain_contains("with l as (select (cast(k as bigint) + 10) as k2, v from t_mcv_l), r as (select (cast(k as bigint) + 10) as k2, v from t_mcv_r) select count(*) from l join[shuffle] r on l.k2 = r.k2", "SplitCastDataSink", "IN (11, 12)")
-- result:
None
-- !result
set skew_join_data_skew_threshold = 0.9;
-- result:
-- !result
function: assert_explain_not_contains("select count(*) from t_mcv_l join[shuffle] t_mcv_r on t_mcv_l.k = t_mcv_r.k", "SplitCastDataSink")
-- result:
None
-- !result
set skew_join_data_skew_threshold = 0.1;
-- result:
-- !result
set skew_join_mcv_single_threshold = 0.3;
-- result:
-- !result
function: assert_explain_contains("select count(*) from t_mcv_l join[shuffle] t_mcv_r on t_mcv_l.k = t_mcv_r.k", "SplitCastDataSink", "IN (1)")
-- result:
None
-- !result
function: assert_explain_not_contains("select count(*) from t_mcv_l join[shuffle] t_mcv_r on t_mcv_l.k = t_mcv_r.k", "IN (1, 2)")
-- result:
None
-- !result
set skew_join_mcv_single_threshold = 0.05;
-- result:
-- !result
set skew_join_mcv_min_input_rows = 20000;
-- result:
-- !result
function: assert_explain_not_contains("select count(*) from t_mcv_l join[shuffle] t_mcv_r on t_mcv_l.k = t_mcv_r.k", "SplitCastDataSink")
-- result:
None
-- !result
set skew_join_mcv_min_input_rows = 1000;
-- result:
-- !result
drop table if exists t_mcv_l2;
-- result:
-- !result
drop table if exists t_mcv_r2;
-- result:
-- !result
create table t_mcv_l2 (
    k bigint null,
    v int null
)
duplicate key(k)
distributed by hash(k) buckets 1
properties("replication_num"="1");
-- result:
-- !result
create table t_mcv_r2 (
    k bigint null,
    v int null
)
duplicate key(k)
distributed by hash(k) buckets 1
properties("replication_num"="1");
-- result:
-- !result
insert into t_mcv_l2 select generate_series, 1 from table(generate_series(1, 10000));
-- result:
-- !result
insert into t_mcv_r2 select 1, 1 from table(generate_series(1, 8000));
-- result:
-- !result
insert into t_mcv_r2 select 2, 1 from table(generate_series(1, 4000));
-- result:
-- !result
insert into t_mcv_r2 select generate_series + 2, 1 from table(generate_series(1, 8000));
-- result:
-- !result
[UC] analyze full table t_mcv_l2;
-- result:
test_db_5f945d55a63b4408a30c60ccc09dd5c1.t_mcv_l2	analyze	status	OK
-- !result
[UC] analyze full table t_mcv_r2;
-- result:
test_db_5f945d55a63b4408a30c60ccc09dd5c1.t_mcv_r2	analyze	status	OK
-- !result
[UC] analyze table t_mcv_r2 update histogram on k properties('histogram_sample_ratio' = '1.0', 'histogram_mcv_size' = '20');
-- result:
test_db_5f945d55a63b4408a30c60ccc09dd5c1.t_mcv_r2	histogram	status	OK
-- !result
function: assert_explain_contains("select count(*) from t_mcv_l2 join[shuffle] t_mcv_r2 on t_mcv_l2.k = t_mcv_r2.k", "SplitCastDataSink", "IN (1, 2)")
-- result:
None
-- !result
function: assert_explain_not_contains("select count(*) from t_mcv_l2 left join[shuffle] t_mcv_r2 on t_mcv_l2.k = t_mcv_r2.k", "SplitCastDataSink")
-- result:
None
-- !result
drop table t_mcv_l2;
-- result:
-- !result
drop table t_mcv_r2;
-- result:
-- !result
drop table if exists t_null_l;
-- result:
-- !result
drop table if exists t_null_r;
-- result:
-- !result
create table t_null_l (
    k bigint null,
    v int null
)
duplicate key(k)
distributed by hash(k) buckets 1
properties("replication_num"="1");
-- result:
-- !result
create table t_null_r (
    k bigint null,
    v int null
)
duplicate key(k)
distributed by hash(k) buckets 1
properties("replication_num"="1");
-- result:
-- !result
insert into t_null_l select null, 1 from table(generate_series(1, 7000));
-- result:
-- !result
insert into t_null_l select 1, 1 from table(generate_series(1, 2000));
-- result:
-- !result
insert into t_null_l select 2, 1 from table(generate_series(1, 1000));
-- result:
-- !result
insert into t_null_r select (generate_series % 2000) + 1, 1 from table(generate_series(1, 10000));
-- result:
-- !result
[UC] analyze full table t_null_l;
-- result:
test_db_5f945d55a63b4408a30c60ccc09dd5c1.t_null_l	analyze	status	OK
-- !result
[UC] analyze full table t_null_r;
-- result:
test_db_5f945d55a63b4408a30c60ccc09dd5c1.t_null_r	analyze	status	OK
-- !result
[UC] analyze table t_null_l update histogram on k properties('histogram_sample_ratio' = '1.0', 'histogram_mcv_size' = '20');
-- result:
test_db_5f945d55a63b4408a30c60ccc09dd5c1.t_null_l	histogram	status	OK
-- !result
[UC] analyze table t_null_r update histogram on k properties('histogram_sample_ratio' = '1.0', 'histogram_mcv_size' = '20');
-- result:
test_db_5f945d55a63b4408a30c60ccc09dd5c1.t_null_r	histogram	status	OK
-- !result
function: assert_explain_contains("select count(*) from t_null_l left join[shuffle] t_null_r on t_null_l.k = t_null_r.k", "SplitCastDataSink", "([1: k, BIGINT, true] IN (1, 2)) OR ([1: k, BIGINT, true] IS NULL)")
-- result:
None
-- !result
drop table t_null_l;
-- result:
-- !result
drop table t_null_r;
-- result:
-- !result
drop table t_mcv_l;
-- result:
-- !result
drop table t_mcv_r;
-- result:
-- !result
drop table skew_t1;
-- result:
-- !result
drop table t1;
-- result:
-- !result
drop table t2;
-- result:
-- !result