-- name: test_join_with_exception @sequential
CREATE TABLE `t0` (
  `c0` int(11) NULL COMMENT "",
  `c1` varchar(20) NULL COMMENT "",
  `c2` varchar(200) NULL COMMENT "",
  `c3` int(11) NULL COMMENT ""
) ENGINE=OLAP
DUPLICATE KEY(`c0`, `c1`)
COMMENT "OLAP"
DISTRIBUTED BY HASH(`c0`, `c1`) BUCKETS 48
PROPERTIES (
"replication_num" = "1"
);
-- result:
-- !result
CREATE TABLE `t1` (
  `c0` int(11) NULL COMMENT "",
  `c1` varchar(20) NULL COMMENT "",
  `c2` varchar(200) NULL COMMENT "",
  `c3` int(11) NULL COMMENT ""
) ENGINE=OLAP
DUPLICATE KEY(`c0`, `c1`)
COMMENT "OLAP"
DISTRIBUTED BY HASH(`c0`, `c1`) BUCKETS 48
PROPERTIES (
"replication_num" = "1"
);
-- result:
-- !result
insert into t0 SELECT generate_series, generate_series, generate_series, generate_series FROM TABLE(generate_series(1,  40960));
-- result:
-- !result
insert into t0 values (null,null,null,null);
-- result:
-- !result
insert into t1 SELECT * FROM t0;
-- result:
-- !result
select count(l.c0), avg(l.c0), count(l.c1), count(l.c0), count(r.c1) from t0 l join [colocate] t1 r on l.c0 = r.c0 and l.c1 = r.c1;
-- result:
40960	20480.5	40960	40960	40960
-- !result
admin enable failpoint 'hash_join_append_bad_alloc';
-- result:
-- !result
[UC]select count(l.c0), avg(l.c0), count(l.c1), count(l.c0), count(r.c1) from t0 l join [colocate] t1 r on l.c0 = r.c0 and l.c1 = r.c1;
-- result:
E: (1064, 'Mem usage has exceed the limit of BE: BE:10004')
-- !result
admin disable failpoint 'hash_join_append_bad_alloc';
-- result:
-- !result
admin enable failpoint 'hash_join_build_bad_alloc';
-- result:
-- !result
[UC]select count(l.c0), avg(l.c0), count(l.c1), count(l.c0), count(r.c1) from t0 l join [colocate] t1 r on l.c0 = r.c0 and l.c1 = r.c1;
-- result:
E: (1064, 'Mem usage has exceed the limit of BE: BE:10004')
-- !result
admin disable failpoint 'hash_join_build_bad_alloc';
-- result:
-- !result