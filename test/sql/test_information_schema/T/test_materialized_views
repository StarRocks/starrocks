-- name: test_materialized_views

create database db_${uuid0};
use db_${uuid0};

CREATE TABLE ss( event_day DATE, pv BIGINT) DUPLICATE KEY(event_day) DISTRIBUTED BY HASH(event_day) BUCKETS 8 PROPERTIES("replication_num" = "1");
insert into ss values('2020-01-14', 1), ('2020-01-14', 3), ('2020-01-15', 2);

CREATE MATERIALIZED VIEW mv1 DISTRIBUTED BY hash(event_day) 
REFRESH DEFERRED MANUAL
AS SELECT event_day, sum(pv) as sum_pv FROM ss GROUP BY event_day;
[UC]REFRESH MATERIALIZED VIEW mv1 with sync mode ;

set enable_evaluate_schema_scan_rule=true;
[UC] select count(*) from information_schema.materialized_views;
select if (count(*) > 0, "OK", "FAILED") from information_schema.materialized_views;
set enable_evaluate_schema_scan_rule=false;
[UC] select count(*) from information_schema.materialized_views;
select if (count(*) > 0, "OK", "FAILED") from information_schema.materialized_views;

create database if not exists test_information_schema_materialized_views;
use test_information_schema_materialized_views;

[UC] select count(*) from information_schema.materialized_views;
select if (count(*) > 0, "OK", "FAILED") from information_schema.materialized_views;
set enable_evaluate_schema_scan_rule=false;
[UC] select count(*) from information_schema.materialized_views;
select if (count(*) > 0, "OK", "FAILED") from information_schema.materialized_views;

drop database if exists test_information_schema_materialized_views;
drop database db_${uuid0};