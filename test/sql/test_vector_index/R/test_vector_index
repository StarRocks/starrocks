-- name: test_create_vector_index
ADMIN SET FRONTEND CONFIG("enable_experimental_vector" = "true");
-- result:
-- !result
CREATE TABLE `t_test_vector_table` (
  `id` bigint(20) NOT NULL COMMENT "",
  `vector1` ARRAY<FLOAT> NOT NULL COMMENT "",
  `vector2` ARRAY<FLOAT> NOT NULL COMMENT "",
  INDEX index_vector1 (`vector1`) USING VECTOR ("metric_type" = "l2_distance", "is_vector_normed" = "false", "M" = "512", "index_type" = "hnsw", "dim"="5")
) ENGINE=OLAP
DUPLICATE KEY(`id`)
DISTRIBUTED BY HASH(`id`) BUCKETS 1
PROPERTIES (
"replication_num" = "1",
"enable_persistent_index" = "false",
"replicated_storage" = "false",
"compression" = "LZ4"
);
-- result:
-- !result
CREATE INDEX index_vector2 ON t_test_vector_table (vector2) USING VECTOR ("metric_type" = "l2_distance", "is_vector_normed" = "false", "index_type" = "ivfpq", "dim"="5", "nlist" = "256", "nbits"="10");
-- result:
-- !result
function: wait_alter_table_finish()
-- result:
None
-- !result
DROP INDEX index_vector2 ON t_test_vector_table;
-- result:
-- !result
function: wait_alter_table_finish()
-- result:
None
-- !result
ALTER TABLE t_test_vector_table add index index_vector2 (vector2) USING VECTOR ("metric_type" = "l2_distance", "is_vector_normed" = "false", "index_type" = "ivfpq", "dim"="5", "nlist" = "256", "nbits"="10");
-- result:
-- !result
function: wait_alter_table_finish()
-- result:
None
-- !result
ALTER TABLE t_test_vector_table drop index index_vector2;
-- result:
-- !result
function: wait_alter_table_finish()
-- result:
None
-- !result

DROP TABLE t_test_vector_table;
-- result:
-- !result

-- name: test_write_vector_index
CREATE TABLE `t_test_vector_table` (
  `id` bigint(20) NOT NULL COMMENT "",
  `vector1` ARRAY<FLOAT> NOT NULL COMMENT "",
  INDEX index_vector1 (`vector1`) USING VECTOR ("metric_type" = "l2_distance", "is_vector_normed" = "false", "M" = "512", "index_type" = "hnsw", "dim"="5")
) ENGINE=OLAP
DUPLICATE KEY(`id`)
DISTRIBUTED BY HASH(`id`) BUCKETS 1
PROPERTIES (
"replication_num" = "1",
"enable_persistent_index" = "false",
"replicated_storage" = "false",
"compression" = "LZ4"
);
-- result:
-- !result

insert into t_test_vector_table values(1, [1,2,3,4,5]);
-- result:
-- !result
insert into t_test_vector_table values(2, [-1,-2,-3,-4,-5]);
-- result:
-- !result
insert into t_test_vector_table values(3, [0,0,0,0,0]);
-- result:
-- !result

DROP TABLE t_test_vector_table;
-- result:
-- !result