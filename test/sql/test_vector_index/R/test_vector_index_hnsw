-- name: test_vector_index_hnsw @sequential
ADMIN SET FRONTEND CONFIG("enable_experimental_vector" = "true");
-- result:
-- !result
CREATE TABLE __row_util_base (
  k1 bigint NULL
) ENGINE=OLAP
DUPLICATE KEY(`k1`)
DISTRIBUTED BY HASH(`k1`) BUCKETS 32
PROPERTIES (
    "replication_num" = "1"
);
-- result:
-- !result
insert into __row_util_base select generate_series from TABLE(generate_series(0, 10000 - 1));
-- result:
-- !result
insert into __row_util_base select * from __row_util_base; -- 20000
insert into __row_util_base select * from __row_util_base; -- 40000
insert into __row_util_base select * from __row_util_base; -- 80000
insert into __row_util_base select * from __row_util_base; -- 160000
insert into __row_util_base select * from __row_util_base; -- 320000
insert into __row_util_base select * from __row_util_base; -- 640000

CREATE TABLE __row_util (
  idx bigint NULL
) ENGINE=OLAP
DUPLICATE KEY(`idx`)
DISTRIBUTED BY HASH(`idx`) BUCKETS 32
PROPERTIES (
    "replication_num" = "1"
);
-- result:
-- !result
insert into __row_util 
select 
    row_number() over() as idx
from __row_util_base;
-- result:
-- !result
CREATE TABLE t2 (
    id bigint(20) NOT NULL,
    v1 ARRAY<FLOAT> NOT NULL,
    v2 ARRAY<FLOAT> NOT NULL,
    i1 bigint(20) NOT NULL,
    INDEX index_vector (v1) USING VECTOR (
        "index_type" = "hnsw", 
        "dim"="5", 
        "metric_type" = "l2_distance", 
        "is_vector_normed" = "false", 
        "M" = "160", 
        "efconstruction" = "400")
) ENGINE=OLAP
DUPLICATE KEY(id)
DISTRIBUTED BY HASH(id) BUCKETS 64
PROPERTIES (
    "replication_num" = "1"
);
-- result:
-- !result
insert into t2 
select 
    idx,
    array_generate(10000, 10004),
    array_generate(10000, 10004),
    idx
from __row_util
order by idx 
limit 20;
-- result:
-- !result
with w1 as (
    select *, approx_l2_distance(v1, [10000, 10001, 10002, 10003, 10004]) as dis from t2
), w2 as (
    select * from w1
    order by dis limit 21
) select * from w2 order by dis, id;
-- result:
1	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	1	0.0
2	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	2	0.0
3	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	3	0.0
4	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	4	0.0
5	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	5	0.0
6	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	6	0.0
7	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	7	0.0
8	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	8	0.0
9	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	9	0.0
10	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	10	0.0
11	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	11	0.0
12	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	12	0.0
13	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	13	0.0
14	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	14	0.0
15	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	15	0.0
16	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	16	0.0
17	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	17	0.0
18	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	18	0.0
19	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	19	0.0
20	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	20	0.0
-- !result
with w1 as (
    select *, approx_l2_distance(v1, [1, 1, 1, 1, 1]) as dis from t2
)
select * from w1 
order by dis;
-- result:
9	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	9	500100000.0
16	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	16	500100000.0
15	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	15	500100000.0
13	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	13	500100000.0
20	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	20	500100000.0
12	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	12	500100000.0
2	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	2	500100000.0
7	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	7	500100000.0
14	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	14	500100000.0
10	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	10	500100000.0
19	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	19	500100000.0
11	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	11	500100000.0
18	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	18	500100000.0
8	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	8	500100000.0
17	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	17	500100000.0
1	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	1	500100000.0
3	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	3	500100000.0
5	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	5	500100000.0
4	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	4	500100000.0
6	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	6	500100000.0
-- !result
insert into t2 
select 
    idx + 20,
    array_repeat(idx, 5),
    array_repeat(idx, 5),
    idx + 20
from __row_util;
-- result:
-- !result
with w1 as (
    select *, approx_l2_distance(v1, [1, 1, 1, 1, 1]) as dis from t2
)
select * from w1 order by dis limit 10;
-- result:
21	[1,1,1,1,1]	[1,1,1,1,1]	21	0.0
22	[2,2,2,2,2]	[2,2,2,2,2]	22	5.0
23	[3,3,3,3,3]	[3,3,3,3,3]	23	20.0
24	[4,4,4,4,4]	[4,4,4,4,4]	24	45.0
25	[5,5,5,5,5]	[5,5,5,5,5]	25	80.0
26	[6,6,6,6,6]	[6,6,6,6,6]	26	125.0
27	[7,7,7,7,7]	[7,7,7,7,7]	27	180.0
28	[8,8,8,8,8]	[8,8,8,8,8]	28	245.0
29	[9,9,9,9,9]	[9,9,9,9,9]	29	320.0
30	[10,10,10,10,10]	[10,10,10,10,10]	30	405.0
-- !result
with w1 as (
    select *, approx_l2_distance(v1, [640064, 640064, 640064, 640064, 640064]) as dis from t2
)
select * from w1
order by dis limit 10;
-- result:
640020	[640000,640000,640000,640000,640000]	[640000,640000,640000,640000,640000]	640020	20480.0
640019	[639999,639999,639999,639999,639999]	[639999,639999,639999,639999,639999]	640019	21125.0
640018	[639998,639998,639998,639998,639998]	[639998,639998,639998,639998,639998]	640018	21780.0
640017	[639997,639997,639997,639997,639997]	[639997,639997,639997,639997,639997]	640017	22445.0
640016	[639996,639996,639996,639996,639996]	[639996,639996,639996,639996,639996]	640016	23120.0
640015	[639995,639995,639995,639995,639995]	[639995,639995,639995,639995,639995]	640015	23805.0
640014	[639994,639994,639994,639994,639994]	[639994,639994,639994,639994,639994]	640014	24500.0
640013	[639993,639993,639993,639993,639993]	[639993,639993,639993,639993,639993]	640013	25205.0
640012	[639992,639992,639992,639992,639992]	[639992,639992,639992,639992,639992]	640012	25920.0
640011	[639991,639991,639991,639991,639991]	[639991,639991,639991,639991,639991]	640011	26645.0
-- !result
with w1 as (
    select *, approx_l2_distance(v1, [1, 2, 3, 4, 5]) as dis from t2
)
select * from w1
order by dis limit 10;
-- result:
23	[3,3,3,3,3]	[3,3,3,3,3]	23	10.0
22	[2,2,2,2,2]	[2,2,2,2,2]	22	15.0
24	[4,4,4,4,4]	[4,4,4,4,4]	24	15.0
21	[1,1,1,1,1]	[1,1,1,1,1]	21	30.0
25	[5,5,5,5,5]	[5,5,5,5,5]	25	30.0
26	[6,6,6,6,6]	[6,6,6,6,6]	26	55.0
27	[7,7,7,7,7]	[7,7,7,7,7]	27	90.0
28	[8,8,8,8,8]	[8,8,8,8,8]	28	135.0
29	[9,9,9,9,9]	[9,9,9,9,9]	29	190.0
30	[10,10,10,10,10]	[10,10,10,10,10]	30	255.0
-- !result
with w1 as (
    select *, approx_l2_distance(v1, [10000, 10001, 10002, 10003, 10004]) as dis from t2
), w2 as (
    select * from w1
    order by dis limit 20
) select * from w2 order by dis, id;
-- result:
1	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	1	0.0
2	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	2	0.0
3	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	3	0.0
4	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	4	0.0
5	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	5	0.0
6	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	6	0.0
7	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	7	0.0
8	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	8	0.0
9	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	9	0.0
10	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	10	0.0
11	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	11	0.0
12	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	12	0.0
13	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	13	0.0
14	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	14	0.0
15	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	15	0.0
16	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	16	0.0
17	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	17	0.0
18	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	18	0.0
19	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	19	0.0
20	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	20	0.0
-- !result
with w1 as (
    select *, approx_l2_distance(v1, [1, 1, 1, 1, 1]) as dis from t2
)
select * from w1 
where dis <= 0
order by dis limit 10;
-- result:
21	[1,1,1,1,1]	[1,1,1,1,1]	21	0.0
-- !result
with w1 as (
    select *, approx_l2_distance(v1, [1, 1, 1, 1, 1]) as dis from t2
)
select * from w1 
where dis <= 100 and dis <= 1000
order by dis limit 10;
-- result:
21	[1,1,1,1,1]	[1,1,1,1,1]	21	0.0
22	[2,2,2,2,2]	[2,2,2,2,2]	22	5.0
23	[3,3,3,3,3]	[3,3,3,3,3]	23	20.0
24	[4,4,4,4,4]	[4,4,4,4,4]	24	45.0
25	[5,5,5,5,5]	[5,5,5,5,5]	25	80.0
-- !result
with w1 as (
    select *, approx_l2_distance(v1, [640064, 640064, 640064, 640064, 640064]) as dis from t2
)
select * from w1
where dis <= 100 and dis <= 1000
order by dis limit 10;
-- result:
-- !result
with w1 as (
    select *, approx_l2_distance(v1, [1, 2, 3, 4, 5]) as dis from t2
)
select * from w1
where dis <= 100 and dis <= 1000
order by dis limit 10;
-- result:
23	[3,3,3,3,3]	[3,3,3,3,3]	23	10.0
22	[2,2,2,2,2]	[2,2,2,2,2]	22	15.0
24	[4,4,4,4,4]	[4,4,4,4,4]	24	15.0
21	[1,1,1,1,1]	[1,1,1,1,1]	21	30.0
25	[5,5,5,5,5]	[5,5,5,5,5]	25	30.0
26	[6,6,6,6,6]	[6,6,6,6,6]	26	55.0
27	[7,7,7,7,7]	[7,7,7,7,7]	27	90.0
-- !result
with w1 as (
    select *, approx_l2_distance(v1, [10000, 10001, 10002, 10003, 10004]) as dis from t2
), w2 as (
    select * from w1
    where dis <= 100 and dis <= 1000
    order by dis limit 20
) select * from w2 order by dis, id;
-- result:
1	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	1	0.0
2	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	2	0.0
3	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	3	0.0
4	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	4	0.0
5	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	5	0.0
6	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	6	0.0
7	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	7	0.0
8	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	8	0.0
9	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	9	0.0
10	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	10	0.0
11	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	11	0.0
12	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	12	0.0
13	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	13	0.0
14	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	14	0.0
15	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	15	0.0
16	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	16	0.0
17	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	17	0.0
18	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	18	0.0
19	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	19	0.0
20	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	20	0.0
-- !result
with w1 as (
    select *, approx_l2_distance(v1, [1, 1, 1, 1, 1]) as dis from t2
)
select * from w1 
where dis >= 100 and dis <= 1000
order by dis limit 10;
-- result:
26	[6,6,6,6,6]	[6,6,6,6,6]	26	125.0
27	[7,7,7,7,7]	[7,7,7,7,7]	27	180.0
28	[8,8,8,8,8]	[8,8,8,8,8]	28	245.0
29	[9,9,9,9,9]	[9,9,9,9,9]	29	320.0
30	[10,10,10,10,10]	[10,10,10,10,10]	30	405.0
31	[11,11,11,11,11]	[11,11,11,11,11]	31	500.0
32	[12,12,12,12,12]	[12,12,12,12,12]	32	605.0
33	[13,13,13,13,13]	[13,13,13,13,13]	33	720.0
34	[14,14,14,14,14]	[14,14,14,14,14]	34	845.0
35	[15,15,15,15,15]	[15,15,15,15,15]	35	980.0
-- !result
with w1 as (
    select *, approx_l2_distance(v1, [1, 1, 1, 1, 1]) as dis from t2
)
select * from w1 
where dis <= 100 and id >= 0
order by dis limit 10;
-- result:
21	[1,1,1,1,1]	[1,1,1,1,1]	21	0.0
22	[2,2,2,2,2]	[2,2,2,2,2]	22	5.0
23	[3,3,3,3,3]	[3,3,3,3,3]	23	20.0
24	[4,4,4,4,4]	[4,4,4,4,4]	24	45.0
25	[5,5,5,5,5]	[5,5,5,5,5]	25	80.0
-- !result
with w1 as (
    select *, approx_l2_distance(v1, [1, 1, 1, 1, 1]) as dis from t2
)
select * from w1 
order by dis, id limit 10;
-- result:
21	[1,1,1,1,1]	[1,1,1,1,1]	21	0.0
22	[2,2,2,2,2]	[2,2,2,2,2]	22	5.0
23	[3,3,3,3,3]	[3,3,3,3,3]	23	20.0
24	[4,4,4,4,4]	[4,4,4,4,4]	24	45.0
25	[5,5,5,5,5]	[5,5,5,5,5]	25	80.0
26	[6,6,6,6,6]	[6,6,6,6,6]	26	125.0
27	[7,7,7,7,7]	[7,7,7,7,7]	27	180.0
28	[8,8,8,8,8]	[8,8,8,8,8]	28	245.0
29	[9,9,9,9,9]	[9,9,9,9,9]	29	320.0
30	[10,10,10,10,10]	[10,10,10,10,10]	30	405.0
-- !result
ADMIN SET FRONTEND CONFIG("enable_experimental_vector" = "false");
-- result:
-- !result
with w1 as (
    select *, approx_l2_distance(v1, [1, 1, 1, 1, 1]) as dis from t2
)
select * from w1 order by dis limit 10;
-- result:
21	[1,1,1,1,1]	[1,1,1,1,1]	21	0.0
22	[2,2,2,2,2]	[2,2,2,2,2]	22	5.0
23	[3,3,3,3,3]	[3,3,3,3,3]	23	20.0
24	[4,4,4,4,4]	[4,4,4,4,4]	24	45.0
25	[5,5,5,5,5]	[5,5,5,5,5]	25	80.0
26	[6,6,6,6,6]	[6,6,6,6,6]	26	125.0
27	[7,7,7,7,7]	[7,7,7,7,7]	27	180.0
28	[8,8,8,8,8]	[8,8,8,8,8]	28	245.0
29	[9,9,9,9,9]	[9,9,9,9,9]	29	320.0
30	[10,10,10,10,10]	[10,10,10,10,10]	30	405.0
-- !result
with w1 as (
    select *, approx_l2_distance(v1, [640064, 640064, 640064, 640064, 640064]) as dis from t2
)
select * from w1
order by dis limit 10;
-- result:
640020	[640000,640000,640000,640000,640000]	[640000,640000,640000,640000,640000]	640020	20480.0
640019	[639999,639999,639999,639999,639999]	[639999,639999,639999,639999,639999]	640019	21125.0
640018	[639998,639998,639998,639998,639998]	[639998,639998,639998,639998,639998]	640018	21780.0
640017	[639997,639997,639997,639997,639997]	[639997,639997,639997,639997,639997]	640017	22445.0
640016	[639996,639996,639996,639996,639996]	[639996,639996,639996,639996,639996]	640016	23120.0
640015	[639995,639995,639995,639995,639995]	[639995,639995,639995,639995,639995]	640015	23805.0
640014	[639994,639994,639994,639994,639994]	[639994,639994,639994,639994,639994]	640014	24500.0
640013	[639993,639993,639993,639993,639993]	[639993,639993,639993,639993,639993]	640013	25205.0
640012	[639992,639992,639992,639992,639992]	[639992,639992,639992,639992,639992]	640012	25920.0
640011	[639991,639991,639991,639991,639991]	[639991,639991,639991,639991,639991]	640011	26645.0
-- !result
with w1 as (
    select *, approx_l2_distance(v1, [1, 2, 3, 4, 5]) as dis from t2
)
select * from w1
order by dis limit 10;
-- result:
23	[3,3,3,3,3]	[3,3,3,3,3]	23	10.0
22	[2,2,2,2,2]	[2,2,2,2,2]	22	15.0
24	[4,4,4,4,4]	[4,4,4,4,4]	24	15.0
21	[1,1,1,1,1]	[1,1,1,1,1]	21	30.0
25	[5,5,5,5,5]	[5,5,5,5,5]	25	30.0
26	[6,6,6,6,6]	[6,6,6,6,6]	26	55.0
27	[7,7,7,7,7]	[7,7,7,7,7]	27	90.0
28	[8,8,8,8,8]	[8,8,8,8,8]	28	135.0
29	[9,9,9,9,9]	[9,9,9,9,9]	29	190.0
30	[10,10,10,10,10]	[10,10,10,10,10]	30	255.0
-- !result
with w1 as (
    select *, approx_l2_distance(v1, [10000, 10001, 10002, 10003, 10004]) as dis from t2
), w2 as (
    select * from w1
    order by dis limit 20
) select * from w2 order by dis, id;
-- result:
1	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	1	0.0
2	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	2	0.0
3	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	3	0.0
4	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	4	0.0
5	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	5	0.0
6	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	6	0.0
7	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	7	0.0
8	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	8	0.0
9	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	9	0.0
10	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	10	0.0
11	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	11	0.0
12	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	12	0.0
13	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	13	0.0
14	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	14	0.0
15	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	15	0.0
16	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	16	0.0
17	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	17	0.0
18	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	18	0.0
19	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	19	0.0
20	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	20	0.0
-- !result
with w1 as (
    select *, approx_l2_distance(v1, [1, 1, 1, 1, 1]) as dis from t2
)
select * from w1 
where dis <= 100 and dis <= 1000
order by dis limit 10;
-- result:
21	[1,1,1,1,1]	[1,1,1,1,1]	21	0.0
22	[2,2,2,2,2]	[2,2,2,2,2]	22	5.0
23	[3,3,3,3,3]	[3,3,3,3,3]	23	20.0
24	[4,4,4,4,4]	[4,4,4,4,4]	24	45.0
25	[5,5,5,5,5]	[5,5,5,5,5]	25	80.0
-- !result
with w1 as (
    select *, approx_l2_distance(v1, [640064, 640064, 640064, 640064, 640064]) as dis from t2
)
select * from w1
where dis <= 100 and dis <= 1000
order by dis limit 10;
-- result:
-- !result
with w1 as (
    select *, approx_l2_distance(v1, [1, 2, 3, 4, 5]) as dis from t2
)
select * from w1
where dis <= 100 and dis <= 1000
order by dis limit 10;
-- result:
23	[3,3,3,3,3]	[3,3,3,3,3]	23	10.0
22	[2,2,2,2,2]	[2,2,2,2,2]	22	15.0
24	[4,4,4,4,4]	[4,4,4,4,4]	24	15.0
21	[1,1,1,1,1]	[1,1,1,1,1]	21	30.0
25	[5,5,5,5,5]	[5,5,5,5,5]	25	30.0
26	[6,6,6,6,6]	[6,6,6,6,6]	26	55.0
27	[7,7,7,7,7]	[7,7,7,7,7]	27	90.0
-- !result
with w1 as (
    select *, approx_l2_distance(v1, [10000, 10001, 10002, 10003, 10004]) as dis from t2
), w2 as (
    select * from w1
    where dis <= 100 and dis <= 1000
    order by dis limit 20
) select * from w2 order by dis, id;
-- result:
1	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	1	0.0
2	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	2	0.0
3	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	3	0.0
4	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	4	0.0
5	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	5	0.0
6	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	6	0.0
7	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	7	0.0
8	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	8	0.0
9	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	9	0.0
10	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	10	0.0
11	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	11	0.0
12	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	12	0.0
13	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	13	0.0
14	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	14	0.0
15	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	15	0.0
16	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	16	0.0
17	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	17	0.0
18	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	18	0.0
19	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	19	0.0
20	[10000,10001,10002,10003,10004]	[10000,10001,10002,10003,10004]	20	0.0
-- !result
ADMIN SET FRONTEND CONFIG("enable_experimental_vector" = "false");
-- result:
-- !result