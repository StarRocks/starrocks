-- name: test_glm_join_iceberg_c1
create external catalog iceberg_sql_test_${uuid0} PROPERTIES ("type"="iceberg", "iceberg.catalog.type"="hive", "iceberg.catalog.hive.metastore.uris"="${iceberg_catalog_hive_metastore_uris}","enable_iceberg_metadata_cache"="true","aws.s3.access_key" = "${oss_ak}","aws.s3.secret_key" = "${oss_sk}","aws.s3.endpoint" = "${oss_endpoint}");
set enable_global_late_materialization = true;

use iceberg_sql_test_${uuid0}.iceberg_oss_db;
-- 1:1 join
select * from test_v3_t0 inner join test_v3_t1 on test_v3_t0.id = test_v3_t1.id order by test_v3_t0.id limit 5;
select * from test_v3_t0 inner join test_v3_t1 on test_v3_t0.id = test_v3_t1.id order by test_v3_t0.id desc limit 5;
select count(test_v3_t0.id),count(test_v3_t0.c0),count(test_v3_t0.c1),count(test_v3_t1.id),count(test_v3_t1.c0),count(test_v3_t1.c1) from test_v3_t0 inner join test_v3_t1 on test_v3_t0.id = test_v3_t1.id;
select count(test_v3_t0.id),count(test_v3_t0.c0),count(test_v3_t0.c1),count(test_v3_t1.id),count(test_v3_t1.c0),count(test_v3_t1.c1) from test_v3_t0 left outer join test_v3_t1 on test_v3_t0.id = test_v3_t1.id;
select count(test_v3_t0.id),count(test_v3_t0.c0),count(test_v3_t0.c1),count(test_v3_t1.id),count(test_v3_t1.c0),count(test_v3_t1.c1) from test_v3_t0 right outer join test_v3_t1 on test_v3_t0.id = test_v3_t1.id;
select count(test_v3_t0.id),count(test_v3_t0.c0),count(test_v3_t0.c1),count(test_v3_t1.id),count(test_v3_t1.c0),count(test_v3_t1.c1) from test_v3_t0 full outer join test_v3_t1 on test_v3_t0.id = test_v3_t1.id;

-- n:m join
select * from test_v3_t0 inner join test_v3_t1 on test_v3_t0.c1 = test_v3_t1.c1 order by 1,2,3,4,5,6 limit 5;
select count(test_v3_t0.id),count(test_v3_t0.c0),count(test_v3_t0.c1),count(test_v3_t1.id),count(test_v3_t1.c0),count(test_v3_t1.c1) from test_v3_t0 inner join test_v3_t1 on test_v3_t0.c1 = test_v3_t1.c1;
select count(test_v3_t0.id),count(test_v3_t0.c0),count(test_v3_t0.c1),count(test_v3_t1.id),count(test_v3_t1.c0),count(test_v3_t1.c1) from test_v3_t0 left outer join test_v3_t1 on test_v3_t0.c1 = test_v3_t1.c1;
select count(test_v3_t0.id),count(test_v3_t0.c0),count(test_v3_t0.c1),count(test_v3_t1.id),count(test_v3_t1.c0),count(test_v3_t1.c1) from test_v3_t0 right outer join test_v3_t1 on test_v3_t0.c1 = test_v3_t1.c1;
select count(test_v3_t0.id),count(test_v3_t0.c0),count(test_v3_t0.c1),count(test_v3_t1.id),count(test_v3_t1.c0),count(test_v3_t1.c1) from test_v3_t0 full outer join test_v3_t1 on test_v3_t0.c1 = test_v3_t1.c1;
select count(test_v3_t0.id),count(test_v3_t0.c0),count(test_v3_t0.c1),count(test_v3_t1.id),count(test_v3_t1.c0),count(test_v3_t1.c1) from test_v3_t0 full outer join test_v3_t1 on test_v3_t0.id > test_v3_t1.id;
select count(test_v3_t0.id),count(test_v3_t0.c0),count(test_v3_t0.c1),count(test_v3_t1.id),count(test_v3_t1.c0),count(test_v3_t1.c1) from test_v3_t0 full outer join test_v3_t1 on test_v3_t0.c1 > test_v3_t1.c1;

-- multiple join
select * from test_v3_t0 join test_v3_t1 join test_v3_t2 on test_v3_t0.id = test_v3_t1.id and test_v3_t0.c0 = test_v3_t2.c0 order by 1,2,3,4,5,6,7,8,9 limit 10;
select * from test_v3_t0 join test_v3_t1 join test_v3_t2 on test_v3_t0.id = test_v3_t1.id and test_v3_t0.id = test_v3_t2.id order by 1,2,3,4,5,6,7,8,9 limit 10; 

drop catalog iceberg_sql_test_${uuid0};
set catalog default_catalog;