-- name: test_logical_materialized_view3
drop table if exists test;
-- result:
[]
-- !result
CREATE TABLE `test` (
  `k1` tinyint(4) NULL DEFAULT "0",
  `k2` varchar(64) NULL DEFAULT "",
  `k3` bigint NULL DEFAULT "0",
  `k4` varchar(64) NULL DEFAULT ""
) ENGINE=OLAP
DUPLICATE KEY(`k1`)
DISTRIBUTED BY HASH(`k1`) BUCKETS 3
PROPERTIES (
"replication_num" = "1"
);
-- result:
[]
-- !result
drop table if exists target;
-- result:
[]
-- !result
CREATE TABLE `target` (
  `k1` tinyint(4) NULL DEFAULT "0",
  `k22` int NULL DEFAULT "0",
  `k33` bigint sum DEFAULT "0"
) ENGINE=OLAP
AGGREGATE KEY(`k1`, `k22`)
DISTRIBUTED BY RANDOM BUCKETS 3
PROPERTIES (
"replication_num" = "1"
);
-- result:
[]
-- !result
CREATE MATERIALIZED VIEW test_mv
to target
as
select k1, length(k2) as k22, sum(k3) as k33 from test where k1 > 3 group by k1, k22;
-- result:
[]
-- !result
insert into test values (2, 'a', 2, 'aa'), (3, 'bc', 3, 'fsd'), (24, 'sdd', 5, 'fsdf');
-- result:
[]
-- !result
select * from target;
-- result:
24	3	5
-- !result
insert into test values (32, 'bad', 2, 'aa'), (1, 'bc', 3, 'fsd'), (15, 'sdd', 5, 'fsdf');
-- result:
[]
-- !result
select * from target order by k1, k22, k33;
-- result:
15	3	5
24	3	5
32	3	2
-- !result
drop table test;
-- result:
[]
-- !result
drop table target;
-- result:
[]
-- !result
