---
displayed_sidebar: docs
---

# format

使用类似 printf 的格式说明符格式化字符串，允许通过结合格式字符串和可变参数来创建格式化输出。

此函数提供类似 printf 的全面字符串格式化功能，支持多种数据类型、位置参数、宽度和精度控制、对齐选项以及特殊格式化功能。在 SQL 查询中创建结构化输出、报告和格式化显示时特别有用。

## 语法

```Haskell
VARCHAR format(VARCHAR format, ...)
```

## 参数

- `format`：包含格式说明符的格式字符串。支持 VARCHAR。格式字符串可以包含字面文本和格式说明符。
- `...`：根据格式字符串进行格式化的可变数量的参数。支持的数据类型包括 VARCHAR、BIGINT/INTEGER/SMALLINT 和 DOUBLE/FLOAT。

## 返回值

返回一个 VARCHAR 值，表示根据格式规范格式化的字符串。

- 如果格式字符串为 NULL，则返回 NULL
- 如果任何参数为 NULL，它在输出中被视为空字符串
- 如果格式说明符的参数不足，缺失的参数用空字符串替换
- 如果格式说明符格式错误，则回退使用原始格式字符串

## 支持的格式说明符

### 基本转换说明符
- `%s`：字符串参数
- `%d` 或 `%i`：整数参数（十进制）
- `%f`：浮点参数

### 格式修饰符标志
- **对齐方式**：`-`（左对齐），默认为右对齐
- **零填充**：`0`（用于数值）
- **逗号分隔符**：`，`（用于数字分组）
- **宽度**：`<数字>`（最小字段宽度）
- **精度**：`.<数字>`（用于浮点精度或最大字符串长度）

### 位置参数
- `%n$s` 其中 n 是参数位置（基于 1）：使用第 n 个参数而不是下一个顺序参数

### 特殊字符
- `%%`：转义的百分号（字面 %）

## 使用说明

- 该函数遵循 printf 风格的格式化约定
- 如果格式化结果超过列大小限制，则会发生字符串截断
- 如果未指定，浮点精度默认为 6 位小数
- 整数格式化为十进制数字
- 对于位置参数，参数索引基于 1
- 函数自动处理支持数据类型的类型转换
- 格式错误的格式字符串回退到原始格式字符串

## 示例

示例 1：基本字符串格式化。

```sql
SELECT format('Hello %s!', 'World');
-- Hello World!

SELECT format('数字: %d, 字符串: %s', 42, 'test');
-- 数字: 42, 字符串: test

SELECT format('Pi: %.2f', 3.14159);
-- Pi: 3.14
```

示例 2：对齐和宽度控制。

```sql
SELECT format('%-10s', '左对齐');
-- 左对齐    （左对齐，10 个字符）

SELECT format('%10s', '右对齐');
--     右对齐 （右对齐，10 个字符）

SELECT format('%05d', 42);
-- 00042 （零填充整数）

SELECT format('%-15s %10s', '姓名:', '张三');
-- 姓名:                张三
```

示例 3：浮点精度。

```sql
SELECT format('%.0f', 3.14159);
-- 3

SELECT format('%.2f', 3.14159);
-- 3.14

SELECT format('%.5f', 3.14159);
-- 3.14159

SELECT format('%.10f', 3.14159);
-- 3.1415900000
```

示例 4：位置参数。

```sql
SELECT format('%2$s %3$s %1$s', 'a', 'b', 'c');
-- b c a

SELECT format('%1$s %2$s %1$s', '重复', '一次');
-- 重复 一次 重复

SELECT format('%3$s %2$s %1$s', '第一', '第二', '第三');
-- 第三 第二 第一
```

示例 5：多种类型的复杂格式化。

```sql
SELECT format('数值: %-8.2f, 计数: %04d, 名称: %s', 2.3456789, 42, '测试');
-- 数值: 2.35    , 计数: 0042, 名称: 测试

SELECT format('用户 %s 有 %d 积分 (完成度 %.1f%%)', '小明', 150, 75.5);
-- 用户 小明 有 150 积分 (完成度 75.5%)
```

示例 6：处理特殊字符和边缘情况。

```sql
SELECT format('百分比: 50%% 完成');
-- 百分比: 50% 完成

SELECT format('%s', NULL);
-- （空字符串）

SELECT format(NULL, 'test');
-- NULL

SELECT format('%s %s', '只有一个参数');
-- 只有一个参数 （第二个参数缺失，输出空字符串）
```

示例 7：使用动态格式字符串的表数据格式化。

```sql
-- 创建包含格式规范的示例表
CREATE TABLE format_test (
    format_str VARCHAR(100),
    arg1 VARCHAR(50),
    arg2 VARCHAR(50),
    arg3 VARCHAR(50)
);

INSERT INTO format_test VALUES 
('%s %s', '你好', '世界', NULL),
('%d %s', '123', '测试', NULL),
('%3$s %1$s', '第一', NULL, '第三'),
('Pi: %.2f', '3.14159', NULL, NULL);

SELECT 
    format_str,
    format(format_str, arg1, arg2, arg3) as formatted_result
FROM format_test;

-- 预期输出:
-- +-------------+-------------------+
-- | format_str  | formatted_result  |
-- +-------------+-------------------+
-- | %s %s       | 你好 世界         |
-- | %d %s       | 123 测试          |
-- | %3$s %1$s   | 第三 第一         |
-- | Pi: %.2f    | Pi: 3.14          |
-- +-------------+-------------------+
```

示例 8：带逗号的数字格式化。

```sql
SELECT format('%,.2f', 1234567.89);
-- 1,234,567.89

SELECT format('%,d', 1000000);
-- 1,000,000

SELECT format('销售额: $%,.2f', 2500000.75);
-- 销售额: $2,500,000.75
```

## Keyword

FORMAT