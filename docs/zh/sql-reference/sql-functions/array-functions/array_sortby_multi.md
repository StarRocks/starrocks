---
displayed_sidebar: "Chinese"
---

# array_sortby_multi


该函数的作用是根据多个数组列（如 array1、array2、array3 等）的值对 array0 进行排序。排序规则如下：

1. 首先比较 array1 的对应元素；
2. 如果相同，则比较 array2 的对应元素；
3. 依此类推，直到最后一个数组列。

注意：

* 参与排序的数组元素必须是可排序类型或者 JSON 类型。
* 所有参与排序的数组元素大小必须与原始数组保持一致（NULL 除外）。

示例说明：

给定以下四个数组：

```
array0 = [1, 2, 3, 4, 5]
array1 = [6, 5, 5, 5, 4]
array2 = ["d", "b", "a", "b", "4"]
array3 = ["2023-01-01", "2023-01-04", "2023-01-03", "2023-01-05", "2023-01-02"]
```

排序步骤：
1. 比较 array1：

* array1 排序后的索引顺序是 [4, 2, 3, 1, 0]，因为 4 < 5 < 5 < 5 < 6。

2. 对于 array1 中相同的元素 [5, 5, 5]，比较 array2：

* array2 中 [a, b, b] 排序后的顺序是 [2, 3, 4]，因为 a < b = b。

3. 对于 array1 和 array2 中相同的元素 [b, b]，比较 array3：

* array3 中 [2023-01-04, 2023-01-05] 排序后的顺序是 [2, 4]，因为 2023-01-04 < 2023-01-05。

最终对数值array0的排序结果

```
array0：[5, 3, 2, 4, 1]
```

## 语法

```Haskell
array_sortby_multi(array0, array1, [array2, array3...])
```

对表中的每一行，按照多个数组列（array1、array2、array3 等）的值对 array0 进行排序。排序规则是：首先比较 array1 的对应元素，如果相同则比较 array2 的对应元素，依此类推，直到最后一个数组列

## 参数说明

- `array0`：需要排序的数组，支持的数据类型为 ARRAY，或者 `null`。数组中的元素必须为可排序的元素。
- `array1, [array2, array3...]`：用于排序的键值数组，支持的数据类型为 ARRAY，或者 `null`。


## 返回值说明

返回的数据类型为 ARRAY。

## 注意事项

- 只支持升序排序。
- 如果需要降序排列，可以对排序后的结果，调用 [reverse()](../string-functions/reverse.md) 函数。
- `null` 值会排在最前面。
- 返回数组中的元素类型和输入数组中的元素类型一致，`null` 属性一致。
- 如果用于排序的键值数组或表达式为 `null`，数据保持不变。
- 排序涉及的两个数组的元素个数必须一致，否则返回报错。

## 示例

下面的示例使用如下数据表。

```SQL
CREATE TABLE test_array_sortby_muliti (
    id INT(11) not null,
    array_col1 ARRAY<INT>,
    array_col2 ARRAY<DOUBLE>,
    array_col3 ARRAY<VARCHAR(20)>,
    array_col4 ARRAY<DATE>
) ENGINE=OLAP
DUPLICATE KEY(id)
COMMENT "OLAP"
DISTRIBUTED BY HASH(id)
PROPERTIES (
    "replication_num" = "1",
    "storage_format" = "DEFAULT",
    "enable_persistent_index" = "false",
    "compression" = "LZ4"
);

INSERT INTO test_array_sortby_muliti VALUES
(1, [4, 3, 5], [1.1, 2.2, 2.2], ['a', 'b', 'c'], ['2023-01-01', '2023-01-02', '2023-01-03']),
(2, [6, 7, 8], [6.6, 5.5, 6.6], ['d', 'e', 'd'], ['2023-01-04', '2023-01-05', '2023-01-06']),
(3, NULL, [7.7, 8.8, 8.8], ['g', 'h', 'h'], ['2023-01-07', '2023-01-08', '2023-01-09']),
(4, [9, 10, 11], NULL, ['k', 'k', 'j'], ['2023-01-10', '2023-01-12', '2023-01-11']),
(5, [12, 13, 14], [10.10, 11.11, 11.11], NULL, ['2023-01-13', '2023-01-14', '2023-01-15']),
(6, [15, 16, 17], [14.14, 13.13, 14.14], ['m', 'o', 'o'], NULL),
(7, [18, 19, 20], [16.16, 16.16, 18.18], ['p', 'p', 'r'], ['2023-01-16', NULL, '2023-01-18']),
(8, [21, 22, 23], [19.19, 20.20, 19.19], ['a', 't', 'a'], ['2023-01-19', '2023-01-20', '2023-01-21']),
(9, [24, 25, 26], NULL, ['y', 'y', 'z'], ['2023-01-25', '2023-01-24', '2023-01-26']),
(10, [24, 25, 26], NULL, ['y', 'y', 'z'], ['2023-01-25', NULL, '2023-01-26']);


select * from test_array_sortby_muliti order by id asc;
+------+------------+---------------------+---------------+------------------------------------------+
| id   | array_col1 | array_col2          | array_col3    | array_col4                               |
+------+------------+---------------------+---------------+------------------------------------------+
|    1 | [4,3,5]    | [1.1,2.2,2.2]       | ["a","b","c"] | ["2023-01-01","2023-01-02","2023-01-03"] |
|    2 | [6,7,8]    | [6.6,5.5,6.6]       | ["d","e","d"] | ["2023-01-04","2023-01-05","2023-01-06"] |
|    3 | NULL       | [7.7,8.8,8.8]       | ["g","h","h"] | ["2023-01-07","2023-01-08","2023-01-09"] |
|    4 | [9,10,11]  | NULL                | ["k","k","j"] | ["2023-01-10","2023-01-12","2023-01-11"] |
|    5 | [12,13,14] | [10.1,11.11,11.11]  | NULL          | ["2023-01-13","2023-01-14","2023-01-15"] |
|    6 | [15,16,17] | [14.14,13.13,14.14] | ["m","o","o"] | NULL                                     |
|    7 | [18,19,20] | [16.16,16.16,18.18] | ["p","p","r"] | ["2023-01-16",null,"2023-01-18"]         |
|    8 | [21,22,23] | [19.19,20.2,19.19]  | ["a","t","a"] | ["2023-01-19","2023-01-20","2023-01-21"] |
|    9 | [24,25,26] | NULL                | ["y","y","z"] | ["2023-01-25","2023-01-24","2023-01-26"] |
|   10 | [24,25,26] | NULL                | ["y","y","z"] | ["2023-01-25",null,"2023-01-26"]         |
+------+------------+---------------------+---------------+------------------------------------------+
```

示例一：将数组 `array_col1` 按照 `array_col2` 的值进行升序排序。

```Plaintext
select id, array_col1, array_col2, array_sortby_multi(array_col1, array_col2) from test_array_sortby_muliti order by id asc;
+------+------------+---------------------+--------------------------------------------+
| id   | array_col1 | array_col2          | array_sortby_multi(array_col1, array_col2) |
+------+------------+---------------------+--------------------------------------------+
|    1 | [4,3,5]    | [1.1,2.2,2.2]       | [4,3,5]                                    |
|    2 | [6,7,8]    | [6.6,5.5,6.6]       | [7,6,8]                                    |
|    3 | NULL       | [7.7,8.8,8.8]       | NULL                                       |
|    4 | [9,10,11]  | NULL                | [9,10,11]                                  |
|    5 | [12,13,14] | [10.1,11.11,11.11]  | [12,13,14]                                 |
|    6 | [15,16,17] | [14.14,13.13,14.14] | [16,15,17]                                 |
|    7 | [18,19,20] | [16.16,16.16,18.18] | [18,19,20]                                 |
|    8 | [21,22,23] | [19.19,20.2,19.19]  | [21,23,22]                                 |
|    9 | [24,25,26] | NULL                | [24,25,26]                                 |
|   10 | [24,25,26] | NULL                | [24,25,26]                                 |
+------+------------+---------------------+--------------------------------------------+
```

示例二：将数组 `array_col1` 按照 `array_col2` , `array_col3`的值进行升序排序。

```Plaintext
select id, array_col1, array_col2, array_col3, array_sortby_multi(array_col1, array_col2, array_col3) from test_array_sortby_muliti order by id asc;
+------+------------+---------------------+---------------+--------------------------------------------------------+
| id   | array_col1 | array_col2          | array_col3    | array_sortby_multi(array_col1, array_col2, array_col3) |
+------+------------+---------------------+---------------+--------------------------------------------------------+
|    1 | [4,3,5]    | [1.1,2.2,2.2]       | ["a","b","c"] | [4,3,5]                                                |
|    2 | [6,7,8]    | [6.6,5.5,6.6]       | ["d","e","d"] | [7,6,8]                                                |
|    3 | NULL       | [7.7,8.8,8.8]       | ["g","h","h"] | NULL                                                   |
|    4 | [9,10,11]  | NULL                | ["k","k","j"] | [11,9,10]                                              |
|    5 | [12,13,14] | [10.1,11.11,11.11]  | NULL          | [12,13,14]                                             |
|    6 | [15,16,17] | [14.14,13.13,14.14] | ["m","o","o"] | [16,15,17]                                             |
|    7 | [18,19,20] | [16.16,16.16,18.18] | ["p","p","r"] | [18,19,20]                                             |
|    8 | [21,22,23] | [19.19,20.2,19.19]  | ["a","t","a"] | [21,23,22]                                             |
|    9 | [24,25,26] | NULL                | ["y","y","z"] | [24,25,26]                                             |
|   10 | [24,25,26] | NULL                | ["y","y","z"] | [24,25,26]                                             |
+------+------------+---------------------+---------------+--------------------------------------------------------+
```

示例三：将数组 `array_col1` 按照 `array_col2` , `array_col3`, `array_col4`的值进行升序排序。

```SQL
select id, array_col1, array_col2, array_col3, array_col4, array_sortby_multi(array_col1, array_col2, array_col3, array_col4) from test_array_sortby_muliti order by id asc;
+------+------------+---------------------+---------------+------------------------------------------+--------------------------------------------------------------------+
| id   | array_col1 | array_col2          | array_col3    | array_col4                               | array_sortby_multi(array_col1, array_col2, array_col3, array_col4) |
+------+------------+---------------------+---------------+------------------------------------------+--------------------------------------------------------------------+
|    1 | [4,3,5]    | [1.1,2.2,2.2]       | ["a","b","c"] | ["2023-01-01","2023-01-02","2023-01-03"] | [4,3,5]                                                            |
|    2 | [6,7,8]    | [6.6,5.5,6.6]       | ["d","e","d"] | ["2023-01-04","2023-01-05","2023-01-06"] | [7,6,8]                                                            |
|    3 | NULL       | [7.7,8.8,8.8]       | ["g","h","h"] | ["2023-01-07","2023-01-08","2023-01-09"] | NULL                                                               |
|    4 | [9,10,11]  | NULL                | ["k","k","j"] | ["2023-01-10","2023-01-12","2023-01-11"] | [11,9,10]                                                          |
|    5 | [12,13,14] | [10.1,11.11,11.11]  | NULL          | ["2023-01-13","2023-01-14","2023-01-15"] | [12,13,14]                                                         |
|    6 | [15,16,17] | [14.14,13.13,14.14] | ["m","o","o"] | NULL                                     | [16,15,17]                                                         |
|    7 | [18,19,20] | [16.16,16.16,18.18] | ["p","p","r"] | ["2023-01-16",null,"2023-01-18"]         | [19,18,20]                                                         |
|    8 | [21,22,23] | [19.19,20.2,19.19]  | ["a","t","a"] | ["2023-01-19","2023-01-20","2023-01-21"] | [21,23,22]                                                         |
|    9 | [24,25,26] | NULL                | ["y","y","z"] | ["2023-01-25","2023-01-24","2023-01-26"] | [25,24,26]                                                         |
|   10 | [24,25,26] | NULL                | ["y","y","z"] | ["2023-01-25",null,"2023-01-26"]         | [25,24,26]                                                         |
+------+------------+---------------------+---------------+------------------------------------------+--------------------------------------------------------------------+
```

