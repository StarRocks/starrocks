---
displayed_sidebar: docs
---

# User-defined variables

このトピックでは、ユーザー定義変数の宣言と使用方法について説明します。

StarRocks 2.5以降のバージョンでは、ユーザー定義変数をサポートしています。これらの変数は、後のSQL文で参照される特定の値を保存するために使用され、SQL文の記述を簡素化し、重複した計算を避けることができます。

## 使用上の注意

- ユーザー定義変数は、ユーザーによって作成され、セッション内に存在する変数です。これは、他のユーザーによって宣言されたユーザー定義変数にアクセスできないことを意味し、セッションが閉じられるとこれらの変数は失効します。
- StarRocksは、SHOW文を使用して既存のユーザー定義変数を表示することをサポートしていません。
- 次のタイプの値は、ユーザー定義変数として宣言することはできません: BITMAP, HLL, PERCENTILE, および ARRAY。JSONタイプのユーザー定義変数は、保存のためにSTRINGタイプに変換されます。

## ユーザー定義変数の宣言

### 構文

```Plain
SET @var_name = expr [, ...];
```

> **NOTE**
>
> - すべての変数は、単一のアットマーク (@) を前に付ける必要があります。
> - 複数の変数を同じSET文で宣言することができ、カンマ (`,`) で区切る必要があります。
> - 同じ変数を複数回宣言することができます。新しく宣言された値は元の値を上書きします。
> - 宣言されていない変数が使用された場合、その変数の値はデフォルトで `NULL` であり、NULLタイプはSTRINGです。

### パラメータ

| **Parameter** | **Required** | **Description**                                              |
| ------------- | ------------ | ------------------------------------------------------------ |
| var_name      | Yes          | ユーザー定義変数の名前。命名規則は次のとおりです:<ul><li>名前には、文字、数字 (0-9)、およびアンダースコア (\_) を含めることができます。</li><li>名前は64文字を超えることはできません。</li></ul>文字列をユーザー定義変数として宣言することができます。例: @'my-var', @"my-var", および @\`my-var\`。STRINGタイプのユーザー定義変数には、文字、数字、アンダースコア (_) 以外の文字、例えばピリオド (.) を含めることができます。 |
| expr          | Yes          | ユーザー定義変数の値。このパラメータには、数値 (例: 43) または複雑な式 (例: SELECT文によって返される値) を指定できます。変数のデータタイプは、式によって返される結果のデータタイプと同じです。 |

### 例

例 1: 数値をユーザー定義変数として宣言します。

```SQL
SET @var = 43;
```

例 2: SELECTクエリによって返される値をユーザー定義変数として宣言します。

```SQL
SET @var = (SELECT SUM(v1) FROM test);
```

例 3: 同じSET文で複数のユーザー定義変数を宣言します。

```SQL
SET @v1=1, @v2=2;
```

## SQLでのユーザー定義変数の使用

- SQL文の記述を簡素化します。例えば、次のSELECT文を実行すると、StarRocksは `@var` を `1` として解析します。

  ```Plain
  SET @var = 1;
  SELECT @var, v1 from test;
  ```

- 重複した計算を避けます。例えば、次のSELECT文を実行すると、StarRocksは `@var` を `select sum(c1) from tbl` コマンドによって返される結果として解析します。

  ```Plain
  SET @var = (select sum(c1) from tbl);
  SELECT @var, v1 from test;
  ```