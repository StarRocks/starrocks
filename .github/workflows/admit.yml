name: Trigger Jobs

on:
  pull_request_target:
    types: [synchronize, labeled, reopened]

jobs:
  Trigger-Admit-Test:
    runs-on: ubuntu-latest
    steps:  
      - name: PR comment with reactions
        uses: thollander/actions-comment-pull-request@v1
        with:
          message: |
            run starrocks_admit_test
#         pr_number:
          GITHUB_TOKEN: ${{ secrets.PAT }}
        
      - name: Trigger admit job
        if: contains(github.event.pull_request.labels.*.name, 'Approved')
        uses: jabbukka/jenkins-trigger@main
        with:
          url: http://39.101.206.100:8090/
          job_name: starrocks_admit_test
          user_name: starrocks
          api_token:  112bc1b04f326123e6668f931a7d26f7dd #${{ secrets.JENKINS_TOKEN}}
          parameter: '{ "GITHUB_PR_NUMBER": "${{ env.GITHUB_PR_NUMBER }}", "GITHUB_PR_TARGET_BRANCH": "${{ env.GITHUB_PR_TARGET_BRANCH}}" }'
          wait: "true"
          timeout: "3600"
        env:
          GITHUB_PR_NUMBER: ${{github.event.pull_request.number}}
          GITHUB_PR_TARGET_BRANCH: ${{ github.event.pull_request.base.ref }}
